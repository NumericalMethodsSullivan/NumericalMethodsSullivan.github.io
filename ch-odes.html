<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Ordinary Differential Equations | Numerical Methods</title>
  <meta name="description" content="Inquiry Based Numerical Methods" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Ordinary Differential Equations | Numerical Methods" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Inquiry Based Numerical Methods" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Ordinary Differential Equations | Numerical Methods" />
  
  <meta name="twitter:description" content="Inquiry Based Numerical Methods" />
  

<meta name="author" content="Eric Sullivan" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ch-linearalgebra.html"/>
<link rel="next" href="ch-pdes.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<script src="libs/elevate-section-attrs-2.0/elevate-section-attrs.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Front Matter</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#resources"><i class="fa fa-check"></i>Resources</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#preface"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#creative-commons"><i class="fa fa-check"></i>Creative Commons</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#to-the-student"><i class="fa fa-check"></i>To The Student</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#the-inquiry-based-approach"><i class="fa fa-check"></i>The Inquiry-Based Approach</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#to-the-instructor"><i class="fa fa-check"></i>To the Instructor</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#the-inquiry-based-approach-1"><i class="fa fa-check"></i>The Inquiry-Based Approach</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#the-projects"><i class="fa fa-check"></i>The Projects</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#coding"><i class="fa fa-check"></i>Coding</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#pacing"><i class="fa fa-check"></i>Pacing</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#other-considerations"><i class="fa fa-check"></i>Other Considerations:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="ch-intro.html"><a href="ch-intro.html"><i class="fa fa-check"></i><b>1</b> Preliminary Topics</a>
<ul>
<li class="chapter" data-level="1.1" data-path="ch-intro.html"><a href="ch-intro.html#what-is-numerical-analysis"><i class="fa fa-check"></i><b>1.1</b> What Is Numerical Analysis?</a></li>
<li class="chapter" data-level="1.2" data-path="ch-intro.html"><a href="ch-intro.html#arithmetic-in-base-2"><i class="fa fa-check"></i><b>1.2</b> Arithmetic in Base 2</a></li>
<li class="chapter" data-level="1.3" data-path="ch-intro.html"><a href="ch-intro.html#floating-point-arithmetic"><i class="fa fa-check"></i><b>1.3</b> Floating Point Arithmetic</a></li>
<li class="chapter" data-level="1.4" data-path="ch-intro.html"><a href="ch-intro.html#sec:Taylor"><i class="fa fa-check"></i><b>1.4</b> Approximating Functions</a></li>
<li class="chapter" data-level="1.5" data-path="ch-intro.html"><a href="ch-intro.html#approximation-error-with-taylor-series"><i class="fa fa-check"></i><b>1.5</b> Approximation Error with Taylor Series</a></li>
<li class="chapter" data-level="1.6" data-path="ch-intro.html"><a href="ch-intro.html#exercises"><i class="fa fa-check"></i><b>1.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="ch-intro.html"><a href="ch-intro.html#coding-exercises"><i class="fa fa-check"></i><b>1.6.1</b> Coding Exercises</a></li>
<li class="chapter" data-level="1.6.2" data-path="ch-intro.html"><a href="ch-intro.html#applying-what-youve-learned"><i class="fa fa-check"></i><b>1.6.2</b> Applying What You’ve Learned</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="ch-algebra.html"><a href="ch-algebra.html"><i class="fa fa-check"></i><b>2</b> Algebra</a>
<ul>
<li class="chapter" data-level="2.1" data-path="ch-algebra.html"><a href="ch-algebra.html#intro-to-numerical-root-finding"><i class="fa fa-check"></i><b>2.1</b> Intro to Numerical Root Finding</a></li>
<li class="chapter" data-level="2.2" data-path="ch-algebra.html"><a href="ch-algebra.html#the-bisection-method"><i class="fa fa-check"></i><b>2.2</b> The Bisection Method</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="ch-algebra.html"><a href="ch-algebra.html#intuition-and-implementation"><i class="fa fa-check"></i><b>2.2.1</b> Intuition and Implementation</a></li>
<li class="chapter" data-level="2.2.2" data-path="ch-algebra.html"><a href="ch-algebra.html#analysis"><i class="fa fa-check"></i><b>2.2.2</b> Analysis</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="ch-algebra.html"><a href="ch-algebra.html#the-regula-falsi-method"><i class="fa fa-check"></i><b>2.3</b> The Regula Falsi Method</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="ch-algebra.html"><a href="ch-algebra.html#intuition-and-implementation-1"><i class="fa fa-check"></i><b>2.3.1</b> Intuition and Implementation</a></li>
<li class="chapter" data-level="2.3.2" data-path="ch-algebra.html"><a href="ch-algebra.html#analysis-1"><i class="fa fa-check"></i><b>2.3.2</b> Analysis</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="ch-algebra.html"><a href="ch-algebra.html#newtons-method"><i class="fa fa-check"></i><b>2.4</b> Newton’s Method</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="ch-algebra.html"><a href="ch-algebra.html#intuition-and-implementation-2"><i class="fa fa-check"></i><b>2.4.1</b> Intuition and Implementation</a></li>
<li class="chapter" data-level="2.4.2" data-path="ch-algebra.html"><a href="ch-algebra.html#analysis-2"><i class="fa fa-check"></i><b>2.4.2</b> Analysis</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="ch-algebra.html"><a href="ch-algebra.html#the-secant-method"><i class="fa fa-check"></i><b>2.5</b> The Secant Method</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="ch-algebra.html"><a href="ch-algebra.html#intuition-and-implementation-3"><i class="fa fa-check"></i><b>2.5.1</b> Intuition and Implementation</a></li>
<li class="chapter" data-level="2.5.2" data-path="ch-algebra.html"><a href="ch-algebra.html#analysis-3"><i class="fa fa-check"></i><b>2.5.2</b> Analysis</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="ch-algebra.html"><a href="ch-algebra.html#exercises-1"><i class="fa fa-check"></i><b>2.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="ch-algebra.html"><a href="ch-algebra.html#algorithm-summaries"><i class="fa fa-check"></i><b>2.6.1</b> Algorithm Summaries</a></li>
<li class="chapter" data-level="2.6.2" data-path="ch-algebra.html"><a href="ch-algebra.html#applying-what-youve-learned-1"><i class="fa fa-check"></i><b>2.6.2</b> Applying What You’ve Learned</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="ch-algebra.html"><a href="ch-algebra.html#projects"><i class="fa fa-check"></i><b>2.7</b> Projects</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="ch-algebra.html"><a href="ch-algebra.html#basins-of-attraction"><i class="fa fa-check"></i><b>2.7.1</b> Basins of Attraction</a></li>
<li class="chapter" data-level="2.7.2" data-path="ch-algebra.html"><a href="ch-algebra.html#artillery"><i class="fa fa-check"></i><b>2.7.2</b> Artillery</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ch-calculus.html"><a href="ch-calculus.html"><i class="fa fa-check"></i><b>3</b> Calculus</a>
<ul>
<li class="chapter" data-level="3.1" data-path="ch-calculus.html"><a href="ch-calculus.html#intro-to-numerical-calculus"><i class="fa fa-check"></i><b>3.1</b> Intro to Numerical Calculus</a></li>
<li class="chapter" data-level="3.2" data-path="ch-calculus.html"><a href="ch-calculus.html#differentiation"><i class="fa fa-check"></i><b>3.2</b> Differentiation</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="ch-calculus.html"><a href="ch-calculus.html#the-first-derivative"><i class="fa fa-check"></i><b>3.2.1</b> The First Derivative</a></li>
<li class="chapter" data-level="3.2.2" data-path="ch-calculus.html"><a href="ch-calculus.html#error-analysis"><i class="fa fa-check"></i><b>3.2.2</b> Error Analysis</a></li>
<li class="chapter" data-level="3.2.3" data-path="ch-calculus.html"><a href="ch-calculus.html#efficient-coding"><i class="fa fa-check"></i><b>3.2.3</b> Efficient Coding</a></li>
<li class="chapter" data-level="3.2.4" data-path="ch-calculus.html"><a href="ch-calculus.html#a-better-first-derivative"><i class="fa fa-check"></i><b>3.2.4</b> A Better First Derivative</a></li>
<li class="chapter" data-level="3.2.5" data-path="ch-calculus.html"><a href="ch-calculus.html#the-second-derivative"><i class="fa fa-check"></i><b>3.2.5</b> The Second Derivative</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="ch-calculus.html"><a href="ch-calculus.html#integration"><i class="fa fa-check"></i><b>3.3</b> Integration</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="ch-calculus.html"><a href="ch-calculus.html#riemann-sums"><i class="fa fa-check"></i><b>3.3.1</b> Riemann Sums</a></li>
<li class="chapter" data-level="3.3.2" data-path="ch-calculus.html"><a href="ch-calculus.html#trapezoidal-rule"><i class="fa fa-check"></i><b>3.3.2</b> Trapezoidal Rule</a></li>
<li class="chapter" data-level="3.3.3" data-path="ch-calculus.html"><a href="ch-calculus.html#simpsons-rule"><i class="fa fa-check"></i><b>3.3.3</b> Simpsons Rule</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="ch-calculus.html"><a href="ch-calculus.html#optimization"><i class="fa fa-check"></i><b>3.4</b> Optimization</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="ch-calculus.html"><a href="ch-calculus.html#single-variable-optimization"><i class="fa fa-check"></i><b>3.4.1</b> Single Variable Optimization</a></li>
<li class="chapter" data-level="3.4.2" data-path="ch-calculus.html"><a href="ch-calculus.html#multivariable-optimization"><i class="fa fa-check"></i><b>3.4.2</b> Multivariable Optimization</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="ch-calculus.html"><a href="ch-calculus.html#calculus-with-numpy-and-scipy"><i class="fa fa-check"></i><b>3.5</b> Calculus with <code>numpy</code> and <code>scipy</code></a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="ch-calculus.html"><a href="ch-calculus.html#differentiation-1"><i class="fa fa-check"></i><b>3.5.1</b> Differentiation</a></li>
<li class="chapter" data-level="3.5.2" data-path="ch-calculus.html"><a href="ch-calculus.html#integration-1"><i class="fa fa-check"></i><b>3.5.2</b> Integration</a></li>
<li class="chapter" data-level="3.5.3" data-path="ch-calculus.html"><a href="ch-calculus.html#optimization-1"><i class="fa fa-check"></i><b>3.5.3</b> Optimization</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="ch-calculus.html"><a href="ch-calculus.html#least-squares-curve-fitting"><i class="fa fa-check"></i><b>3.6</b> Least Squares Curve Fitting</a></li>
<li class="chapter" data-level="3.7" data-path="ch-calculus.html"><a href="ch-calculus.html#exercises-2"><i class="fa fa-check"></i><b>3.7</b> Exercises</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="ch-calculus.html"><a href="ch-calculus.html#algorithm-summaries-1"><i class="fa fa-check"></i><b>3.7.1</b> Algorithm Summaries</a></li>
<li class="chapter" data-level="3.7.2" data-path="ch-calculus.html"><a href="ch-calculus.html#applying-what-youve-learned-2"><i class="fa fa-check"></i><b>3.7.2</b> Applying What You’ve Learned</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="ch-calculus.html"><a href="ch-calculus.html#projects-1"><i class="fa fa-check"></i><b>3.8</b> Projects</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="ch-calculus.html"><a href="ch-calculus.html#galaxy-integration"><i class="fa fa-check"></i><b>3.8.1</b> Galaxy Integration</a></li>
<li class="chapter" data-level="3.8.2" data-path="ch-calculus.html"><a href="ch-calculus.html#higher-order-integration"><i class="fa fa-check"></i><b>3.8.2</b> Higher Order Integration</a></li>
<li class="chapter" data-level="3.8.3" data-path="ch-calculus.html"><a href="ch-calculus.html#dam-integration"><i class="fa fa-check"></i><b>3.8.3</b> Dam Integration</a></li>
<li class="chapter" data-level="3.8.4" data-path="ch-calculus.html"><a href="ch-calculus.html#edge-detection-in-images"><i class="fa fa-check"></i><b>3.8.4</b> Edge Detection in Images</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ch-linearalgebra.html"><a href="ch-linearalgebra.html"><i class="fa fa-check"></i><b>4</b> Linear Algebra</a>
<ul>
<li class="chapter" data-level="4.1" data-path="ch-linearalgebra.html"><a href="ch-linearalgebra.html#intro-to-numerical-linear-algebra"><i class="fa fa-check"></i><b>4.1</b> Intro to Numerical Linear Algebra</a></li>
<li class="chapter" data-level="4.2" data-path="ch-linearalgebra.html"><a href="ch-linearalgebra.html#vectors-and-matrices-in-python"><i class="fa fa-check"></i><b>4.2</b> Vectors and Matrices in Python</a></li>
<li class="chapter" data-level="4.3" data-path="ch-linearalgebra.html"><a href="ch-linearalgebra.html#matrix-and-vector-operations"><i class="fa fa-check"></i><b>4.3</b> Matrix and Vector Operations</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="ch-linearalgebra.html"><a href="ch-linearalgebra.html#the-dot-product"><i class="fa fa-check"></i><b>4.3.1</b> The Dot Product</a></li>
<li class="chapter" data-level="4.3.2" data-path="ch-linearalgebra.html"><a href="ch-linearalgebra.html#matrix-multiplication"><i class="fa fa-check"></i><b>4.3.2</b> Matrix Multiplication</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="ch-linearalgebra.html"><a href="ch-linearalgebra.html#the-lu-factorization"><i class="fa fa-check"></i><b>4.4</b> The LU Factorization</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="ch-linearalgebra.html"><a href="ch-linearalgebra.html#a-recap-of-row-reduction"><i class="fa fa-check"></i><b>4.4.1</b> A Recap of Row Reduction</a></li>
<li class="chapter" data-level="4.4.2" data-path="ch-linearalgebra.html"><a href="ch-linearalgebra.html#the-lu-decomposition"><i class="fa fa-check"></i><b>4.4.2</b> The LU Decomposition</a></li>
<li class="chapter" data-level="4.4.3" data-path="ch-linearalgebra.html"><a href="ch-linearalgebra.html#solving-triangular-systems"><i class="fa fa-check"></i><b>4.4.3</b> Solving Triangular Systems</a></li>
<li class="chapter" data-level="4.4.4" data-path="ch-linearalgebra.html"><a href="ch-linearalgebra.html#solving-systems-with-lu"><i class="fa fa-check"></i><b>4.4.4</b> Solving Systems with LU</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="ch-linearalgebra.html"><a href="ch-linearalgebra.html#the-qr-factorization"><i class="fa fa-check"></i><b>4.5</b> The QR Factorization</a></li>
<li class="chapter" data-level="4.6" data-path="ch-linearalgebra.html"><a href="ch-linearalgebra.html#over-determined-systems-and-curve-fitting"><i class="fa fa-check"></i><b>4.6</b> Over Determined Systems and Curve Fitting</a></li>
<li class="chapter" data-level="4.7" data-path="ch-linearalgebra.html"><a href="ch-linearalgebra.html#the-eigenvalue-eigenvector-problem"><i class="fa fa-check"></i><b>4.7</b> The Eigenvalue-Eigenvector Problem</a></li>
<li class="chapter" data-level="4.8" data-path="ch-linearalgebra.html"><a href="ch-linearalgebra.html#exercises-3"><i class="fa fa-check"></i><b>4.8</b> Exercises</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="ch-linearalgebra.html"><a href="ch-linearalgebra.html#algorithm-summaries-2"><i class="fa fa-check"></i><b>4.8.1</b> Algorithm Summaries</a></li>
<li class="chapter" data-level="4.8.2" data-path="ch-linearalgebra.html"><a href="ch-linearalgebra.html#applying-what-youve-learned-3"><i class="fa fa-check"></i><b>4.8.2</b> Applying What You’ve Learned</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="ch-linearalgebra.html"><a href="ch-linearalgebra.html#projects-2"><i class="fa fa-check"></i><b>4.9</b> Projects</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="ch-linearalgebra.html"><a href="ch-linearalgebra.html#the-google-page-rank-algorithm"><i class="fa fa-check"></i><b>4.9.1</b> The Google Page Rank Algorithm</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="ch-odes.html"><a href="ch-odes.html"><i class="fa fa-check"></i><b>5</b> Ordinary Differential Equations</a>
<ul>
<li class="chapter" data-level="5.1" data-path="ch-odes.html"><a href="ch-odes.html#intro-to-numerical-odes"><i class="fa fa-check"></i><b>5.1</b> Intro to Numerical ODEs</a></li>
<li class="chapter" data-level="5.2" data-path="ch-odes.html"><a href="ch-odes.html#recalling-the-basics-of-odes"><i class="fa fa-check"></i><b>5.2</b> Recalling the Basics of ODEs</a></li>
<li class="chapter" data-level="5.3" data-path="ch-odes.html"><a href="ch-odes.html#eulers-method"><i class="fa fa-check"></i><b>5.3</b> Euler’s Method</a></li>
<li class="chapter" data-level="5.4" data-path="ch-odes.html"><a href="ch-odes.html#the-midpoint-method"><i class="fa fa-check"></i><b>5.4</b> The Midpoint Method</a></li>
<li class="chapter" data-level="5.5" data-path="ch-odes.html"><a href="ch-odes.html#the-runge-kutta-4-method"><i class="fa fa-check"></i><b>5.5</b> The Runge-Kutta 4 Method</a></li>
<li class="chapter" data-level="5.6" data-path="ch-odes.html"><a href="ch-odes.html#animating-ode-solutions"><i class="fa fa-check"></i><b>5.6</b> Animating ODE Solutions</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="ch-odes.html"><a href="ch-odes.html#ipywidgets.interactive"><i class="fa fa-check"></i><b>5.6.1</b> <code>ipywidgets.interactive</code></a></li>
<li class="chapter" data-level="5.6.2" data-path="ch-odes.html"><a href="ch-odes.html#matplotlib.animation"><i class="fa fa-check"></i><b>5.6.2</b> <code>matplotlib.animation</code></a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="ch-odes.html"><a href="ch-odes.html#the-backwards-euler-method"><i class="fa fa-check"></i><b>5.7</b> The Backwards Euler Method</a></li>
<li class="chapter" data-level="5.8" data-path="ch-odes.html"><a href="ch-odes.html#fitting-ode-models-to-data"><i class="fa fa-check"></i><b>5.8</b> Fitting ODE Models to Data</a></li>
<li class="chapter" data-level="5.9" data-path="ch-odes.html"><a href="ch-odes.html#exercises-4"><i class="fa fa-check"></i><b>5.9</b> Exercises</a>
<ul>
<li class="chapter" data-level="5.9.1" data-path="ch-odes.html"><a href="ch-odes.html#algorithm-summaries-3"><i class="fa fa-check"></i><b>5.9.1</b> Algorithm Summaries</a></li>
<li class="chapter" data-level="5.9.2" data-path="ch-odes.html"><a href="ch-odes.html#applying-what-youve-learned-4"><i class="fa fa-check"></i><b>5.9.2</b> Applying What You’ve Learned</a></li>
</ul></li>
<li class="chapter" data-level="5.10" data-path="ch-odes.html"><a href="ch-odes.html#projects-3"><i class="fa fa-check"></i><b>5.10</b> Projects</a>
<ul>
<li class="chapter" data-level="5.10.1" data-path="ch-odes.html"><a href="ch-odes.html#the-covid-19-pandemic"><i class="fa fa-check"></i><b>5.10.1</b> The COVID-19 Pandemic</a></li>
<li class="chapter" data-level="5.10.2" data-path="ch-odes.html"><a href="ch-odes.html#pain-management"><i class="fa fa-check"></i><b>5.10.2</b> Pain Management</a></li>
<li class="chapter" data-level="5.10.3" data-path="ch-odes.html"><a href="ch-odes.html#the-h1n1-virus"><i class="fa fa-check"></i><b>5.10.3</b> The H1N1 Virus</a></li>
<li class="chapter" data-level="5.10.4" data-path="ch-odes.html"><a href="ch-odes.html#the-artillery-problem"><i class="fa fa-check"></i><b>5.10.4</b> The Artillery Problem</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ch-pdes.html"><a href="ch-pdes.html"><i class="fa fa-check"></i><b>6</b> Partial Differential Equations</a>
<ul>
<li class="chapter" data-level="6.1" data-path="ch-pdes.html"><a href="ch-pdes.html#intro-to-pdes"><i class="fa fa-check"></i><b>6.1</b> Intro to PDEs</a></li>
<li class="chapter" data-level="6.2" data-path="ch-pdes.html"><a href="ch-pdes.html#solutions-to-pdes"><i class="fa fa-check"></i><b>6.2</b> Solutions to PDEs</a></li>
<li class="chapter" data-level="6.3" data-path="ch-pdes.html"><a href="ch-pdes.html#boundary-conditions"><i class="fa fa-check"></i><b>6.3</b> Boundary Conditions</a></li>
<li class="chapter" data-level="6.4" data-path="ch-pdes.html"><a href="ch-pdes.html#the-heat-equation"><i class="fa fa-check"></i><b>6.4</b> The Heat Equation</a></li>
<li class="chapter" data-level="6.5" data-path="ch-pdes.html"><a href="ch-pdes.html#stability-of-the-heat-equation-solution"><i class="fa fa-check"></i><b>6.5</b> Stability of the Heat Equation Solution</a></li>
<li class="chapter" data-level="6.6" data-path="ch-pdes.html"><a href="ch-pdes.html#the-wave-equation"><i class="fa fa-check"></i><b>6.6</b> The Wave Equation</a></li>
<li class="chapter" data-level="6.7" data-path="ch-pdes.html"><a href="ch-pdes.html#traveling-waves"><i class="fa fa-check"></i><b>6.7</b> Traveling Waves</a></li>
<li class="chapter" data-level="6.8" data-path="ch-pdes.html"><a href="ch-pdes.html#the-laplace-and-poisson-equations"><i class="fa fa-check"></i><b>6.8</b> The Laplace and Poisson Equations</a></li>
<li class="chapter" data-level="6.9" data-path="ch-pdes.html"><a href="ch-pdes.html#exercises-5"><i class="fa fa-check"></i><b>6.9</b> Exercises</a>
<ul>
<li class="chapter" data-level="6.9.1" data-path="ch-pdes.html"><a href="ch-pdes.html#algorithm-summaries-4"><i class="fa fa-check"></i><b>6.9.1</b> Algorithm Summaries</a></li>
<li class="chapter" data-level="6.9.2" data-path="ch-pdes.html"><a href="ch-pdes.html#applying-what-youve-learned-5"><i class="fa fa-check"></i><b>6.9.2</b> Applying What You’ve Learned</a></li>
</ul></li>
<li class="chapter" data-level="6.10" data-path="ch-pdes.html"><a href="ch-pdes.html#projects-4"><i class="fa fa-check"></i><b>6.10</b> Projects</a>
<ul>
<li class="chapter" data-level="6.10.1" data-path="ch-pdes.html"><a href="ch-pdes.html#hunting-and-diffusion"><i class="fa fa-check"></i><b>6.10.1</b> Hunting and Diffusion</a></li>
<li class="chapter" data-level="6.10.2" data-path="ch-pdes.html"><a href="ch-pdes.html#heating-adobe-houses"><i class="fa fa-check"></i><b>6.10.2</b> Heating Adobe Houses</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="ch-python.html"><a href="ch-python.html"><i class="fa fa-check"></i><b>A</b> Introduction to Python</a>
<ul>
<li class="chapter" data-level="A.1" data-path="ch-python.html"><a href="ch-python.html#why-python"><i class="fa fa-check"></i><b>A.1</b> Why Python?</a></li>
<li class="chapter" data-level="A.2" data-path="ch-python.html"><a href="ch-python.html#getting-started"><i class="fa fa-check"></i><b>A.2</b> Getting Started</a></li>
<li class="chapter" data-level="A.3" data-path="ch-python.html"><a href="ch-python.html#hello-world"><i class="fa fa-check"></i><b>A.3</b> Hello, World!</a></li>
<li class="chapter" data-level="A.4" data-path="ch-python.html"><a href="ch-python.html#python-programming-basics"><i class="fa fa-check"></i><b>A.4</b> Python Programming Basics</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="ch-python.html"><a href="ch-python.html#variables"><i class="fa fa-check"></i><b>A.4.1</b> Variables</a></li>
<li class="chapter" data-level="A.4.2" data-path="ch-python.html"><a href="ch-python.html#indexing-and-lists"><i class="fa fa-check"></i><b>A.4.2</b> Indexing and Lists</a></li>
<li class="chapter" data-level="A.4.3" data-path="ch-python.html"><a href="ch-python.html#list-operations"><i class="fa fa-check"></i><b>A.4.3</b> List Operations</a></li>
<li class="chapter" data-level="A.4.4" data-path="ch-python.html"><a href="ch-python.html#tuples"><i class="fa fa-check"></i><b>A.4.4</b> Tuples</a></li>
<li class="chapter" data-level="A.4.5" data-path="ch-python.html"><a href="ch-python.html#control-flow-loops-and-if-statements"><i class="fa fa-check"></i><b>A.4.5</b> Control Flow: Loops and If Statements</a></li>
<li class="chapter" data-level="A.4.6" data-path="ch-python.html"><a href="ch-python.html#functions"><i class="fa fa-check"></i><b>A.4.6</b> Functions</a></li>
<li class="chapter" data-level="A.4.7" data-path="ch-python.html"><a href="ch-python.html#lambda-functions"><i class="fa fa-check"></i><b>A.4.7</b> Lambda Functions</a></li>
<li class="chapter" data-level="A.4.8" data-path="ch-python.html"><a href="ch-python.html#packages"><i class="fa fa-check"></i><b>A.4.8</b> Packages</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="ch-python.html"><a href="ch-python.html#numerical-python-with-numpy"><i class="fa fa-check"></i><b>A.5</b> Numerical Python with <code>numpy</code></a>
<ul>
<li class="chapter" data-level="A.5.1" data-path="ch-python.html"><a href="ch-python.html#numpy-arrays-array-operations-and-matrix-operations"><i class="fa fa-check"></i><b>A.5.1</b> Numpy Arrays, Array Operations, and Matrix Operations</a></li>
<li class="chapter" data-level="A.5.2" data-path="ch-python.html"><a href="ch-python.html#arange-linspace-zeros-ones-and-meshgrid"><i class="fa fa-check"></i><b>A.5.2</b> <code>arange, linspace, zeros, ones</code>, and <code>meshgrid</code></a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="ch-python.html"><a href="ch-python.html#plotting-with-matplotlib"><i class="fa fa-check"></i><b>A.6</b> Plotting with <code>matplotlib</code></a>
<ul>
<li class="chapter" data-level="A.6.1" data-path="ch-python.html"><a href="ch-python.html#basics-with-plt.plot"><i class="fa fa-check"></i><b>A.6.1</b> Basics with <code>plt.plot()</code></a></li>
<li class="chapter" data-level="A.6.2" data-path="ch-python.html"><a href="ch-python.html#subplots"><i class="fa fa-check"></i><b>A.6.2</b> Subplots</a></li>
<li class="chapter" data-level="A.6.3" data-path="ch-python.html"><a href="ch-python.html#logarithmic-scaling-with-semilogy-semilogx-and-loglog"><i class="fa fa-check"></i><b>A.6.3</b> Logarithmic Scaling with <code>semilogy</code>, <code>semilogx</code>, and <code>loglog</code></a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="ch-python.html"><a href="ch-python.html#symbolic-python-with-sympy"><i class="fa fa-check"></i><b>A.7</b> Symbolic Python with <code>sympy</code></a>
<ul>
<li class="chapter" data-level="A.7.1" data-path="ch-python.html"><a href="ch-python.html#symbolic-variables-with-symbols"><i class="fa fa-check"></i><b>A.7.1</b> Symbolic Variables with <code>symbols</code></a></li>
<li class="chapter" data-level="A.7.2" data-path="ch-python.html"><a href="ch-python.html#symbolic-algebra"><i class="fa fa-check"></i><b>A.7.2</b> Symbolic Algebra</a></li>
<li class="chapter" data-level="A.7.3" data-path="ch-python.html"><a href="ch-python.html#symbolic-function-evaluation"><i class="fa fa-check"></i><b>A.7.3</b> Symbolic Function Evaluation</a></li>
<li class="chapter" data-level="A.7.4" data-path="ch-python.html"><a href="ch-python.html#symbolic-calculus"><i class="fa fa-check"></i><b>A.7.4</b> Symbolic Calculus</a></li>
<li class="chapter" data-level="A.7.5" data-path="ch-python.html"><a href="ch-python.html#solving-equations-symbolically"><i class="fa fa-check"></i><b>A.7.5</b> Solving Equations Symbolically</a></li>
<li class="chapter" data-level="A.7.6" data-path="ch-python.html"><a href="ch-python.html#symbolic-plotting"><i class="fa fa-check"></i><b>A.7.6</b> Symbolic Plotting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="ch-writing.html"><a href="ch-writing.html"><i class="fa fa-check"></i><b>B</b> Mathematical Writing</a>
<ul>
<li class="chapter" data-level="B.1" data-path="ch-writing.html"><a href="ch-writing.html#the-paper"><i class="fa fa-check"></i><b>B.1</b> The Paper</a></li>
<li class="chapter" data-level="B.2" data-path="ch-writing.html"><a href="ch-writing.html#figures-and-tables"><i class="fa fa-check"></i><b>B.2</b> Figures and Tables</a></li>
<li class="chapter" data-level="B.3" data-path="ch-writing.html"><a href="ch-writing.html#writing-style"><i class="fa fa-check"></i><b>B.3</b> Writing Style</a></li>
<li class="chapter" data-level="B.4" data-path="ch-writing.html"><a href="ch-writing.html#tips-for-writing-clear-math"><i class="fa fa-check"></i><b>B.4</b> Tips For Writing Clear Math</a>
<ul>
<li class="chapter" data-level="B.4.1" data-path="ch-writing.html"><a href="ch-writing.html#audience"><i class="fa fa-check"></i><b>B.4.1</b> Audience</a></li>
<li class="chapter" data-level="B.4.2" data-path="ch-writing.html"><a href="ch-writing.html#how-to-make-mathematics-readable-10-things-to-do"><i class="fa fa-check"></i><b>B.4.2</b> How To Make Mathematics Readable – 10 Things To Do</a></li>
<li class="chapter" data-level="B.4.3" data-path="ch-writing.html"><a href="ch-writing.html#some-writing-tips"><i class="fa fa-check"></i><b>B.4.3</b> Some Writing Tips</a></li>
<li class="chapter" data-level="B.4.4" data-path="ch-writing.html"><a href="ch-writing.html#mathematical-vocabulary"><i class="fa fa-check"></i><b>B.4.4</b> Mathematical Vocabulary</a></li>
</ul></li>
<li class="chapter" data-level="B.5" data-path="ch-writing.html"><a href="ch-writing.html#sensitivity-analysis"><i class="fa fa-check"></i><b>B.5</b> Sensitivity Analysis</a>
<ul>
<li class="chapter" data-level="B.5.1" data-path="ch-writing.html"><a href="ch-writing.html#example-of-sensitivity-analysis"><i class="fa fa-check"></i><b>B.5.1</b> Example of Sensitivity Analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="C" data-path="ch-extras.html"><a href="ch-extras.html"><i class="fa fa-check"></i><b>C</b> Optional Material</a>
<ul>
<li class="chapter" data-level="C.1" data-path="ch-extras.html"><a href="ch-extras.html#interpolation"><i class="fa fa-check"></i><b>C.1</b> Interpolation</a>
<ul>
<li class="chapter" data-level="C.1.1" data-path="ch-extras.html"><a href="ch-extras.html#vandermonde-interpolation"><i class="fa fa-check"></i><b>C.1.1</b> Vandermonde Interpolation</a></li>
<li class="chapter" data-level="C.1.2" data-path="ch-extras.html"><a href="ch-extras.html#lagrange-interpolation"><i class="fa fa-check"></i><b>C.1.2</b> Lagrange Interpolation</a></li>
<li class="chapter" data-level="C.1.3" data-path="ch-extras.html"><a href="ch-extras.html#chebyshev-points"><i class="fa fa-check"></i><b>C.1.3</b> Chebyshev Points</a></li>
</ul></li>
<li class="chapter" data-level="C.2" data-path="ch-extras.html"><a href="ch-extras.html#sec:mv_newton"><i class="fa fa-check"></i><b>C.2</b> Multi-Dimensional Newton’s Method</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Numerical Methods</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ch:odes" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Ordinary Differential Equations</h1>
<div id="intro-to-numerical-odes" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Intro to Numerical ODEs</h2>
<blockquote>
<p><em>“The mathematical discipline of differential equations furnishes the
explanation of all those elementary manifestations of nature which
involve time.”</em><br />
–<a href="https://en.wikipedia.org/wiki/Sophus_Lie">Norwegian Mathematician Sophus
Lie</a></p>
</blockquote>
<p>Ordinary Differential Equations (ODEs) arise in all manner of contexts, but the most prevalent and frequently cited are from physics and engineering. The applications of Newton’s Second Law, for example, give differential equations relating position, velocity, and acceleration. Newton’s second law is the equation <span class="math inline">\(F = ma\)</span> where <span class="math inline">\(F\)</span> is a force acting on a body, <span class="math inline">\(m\)</span> is the mass of the body, and <span class="math inline">\(a\)</span> is the acceleration. From Calculus recall that <span class="math inline">\(a = v&#39; = s&#39;&#39;\)</span>, so Newton’s second law can be rephrased as <span class="math inline">\(F = mv&#39;\)</span>, a differential equation with velocity as the unknown, or <span class="math inline">\(F = ms&#39;&#39;\)</span>, a second order differential equation with position as the unknown. Some of the cases where we use Newton’s second law have nice analytic solutions, such as the motion of an object on a frictionless surface under constant force. However, many of these cases are highly idealized and not reflective of true reality. It doesn’t take much to cause the differential equation(s) resulting from Newton’s second law to be terribly hard, or maybe impossible, to solve. Just add some friction, perhaps allow multiple bodies to interact, or consider the forces that act differently on multiple length scales. A famous example is the <a href="https://en.wikipedia.org/wiki/Three-body_problem">three body problem</a> where gravitational forces drive the motion of three celestial bodies. The resulting differential equations have no analytic solution and the only way to show how the positions of the bodies evolve in time is with a numerical approximation … And that’s just 3 celestial bodies! Imagine how complicated the differential equations get trying to model our solar system (or our galaxy)!</p>
<p>Other examples of ODEs that are impossible to solve analytically are</p>
<ul>
<li>The motion of a pendulum where the angle from equilibrium is allowed to be large or the pendulum is allowed to swing over the top (e.g. <a href="https://en.wikipedia.org/wiki/Pendulum_(mathematics)#Simple_gravity_pendulum">the nonlinear pendulum</a>).</li>
<li>Systems of differential equations that model nonlinear predator-prey interactions (e.g. <a href="https://en.wikipedia.org/wiki/Lotka%E2%80%93Volterra_equations">the Lotka-Voltera equations</a>).</li>
<li>Some types of damped oscillations in electric circuits (e.g. <a href="https://en.wikipedia.org/wiki/Van_der_Pol_oscillator">the Van der Pol oscillator</a>).</li>
<li>… and many others.</li>
</ul>
<p>The impossibility of solving a differential equation stems partly from the impossibility of integrating most functions. If we were to just randomly choose functions to integrate we would find that the vast majority do not have antiderivatives. The story in ODEs is the same: pick any combination of a function, its derivatives, and other forcing functions and you will find that there is no way to arrive at an analytic solution involving the regular operations and functions of mathematics: linear combinations, powers, roots, trigonometric functions, logarithms, etc. There are theorems from differential equations that will guarantee the existence and uniqueness of solutions to many differential equations, but just knowing that the solution exists isn’t enough to actually go and find it. Numerical techniques give us an avenue to at least approximate these solutions.</p>
<p>So what <em>is</em> a numerical solution to a differential equation?<br />
When solving a differential equation with analytic techniques the goal is to come up with a function. In a numerical solution the goal is typically to divide the domain (typically the domain is time) for the solution function into a fine partition, just like we did with numerical differentiation and integration, and then to approximate the solution to the differential equation at each point in that partition. Hence, the end result will be a list of approximate solution values associated with each time. In the strictest sense a list of approximate solutions on a partition <em>is</em> actually a function (a relation between input and output), but this isn’t a function in terms of sines, powers, roots, logarithms, etc. The best way to deliver a numerical solution is just to make a plot. Your intuition of what the plot should look like based on the context of the problem is one of the best tools for you to check your work.</p>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-416" class="exercise"><strong>Exercise 5.1  </strong></span>Sketch a plot of the function that would model each of the following
scenarios.</p>
<ol style="list-style-type: lower-alpha">
<li><p>A population of an endangered species is slowly dying off. The rate
at which the population decreases is proportional to the amount of
population that is presently there. What does the population as a
function of time look like for this species?</p></li>
<li><p>Consider a mass hanging from a spring that is suspended vertically from the ceiling. If the mass is given an initial upward <em>bump</em> and then left alone, what will the position of the mass relative to its equilibrium state be as a function of time?</p></li>
<li><p>A pollutant has entered a tributary for a certain reservoir, and a
small concentration leaks into the water over a long period of time.
The reservoir is dam controlled so the rate of release is well known
and relatively constant. What does the function modeling the amount
of pollutant look like as time goes on?</p></li>
<li><p>A drug is eliminated from the body via natural metabolism. Assume
that there is some initial amount of drug in the body. What does the
function modeling the amount of drug in the system look like over
time?</p></li>
</ol>
</div>
<hr />
<p>Now let’s formalize the conversation about differential equations, analytic solutions, and numerical solutions.</p>

<div class="definition">
<span id="def:unnamed-chunk-417" class="definition"><strong>Definition 5.1  (Differential Equation)  </strong></span>A <strong>differential equation</strong> is an equation that relates the derivative
(or derivatives) of an unknown function to itself.
</div>
<hr />

<div class="definition">
<span id="def:unnamed-chunk-418" class="definition"><strong>Definition 5.2  (Solution to a Differential Equations)  </strong></span>A <strong>solution to a differential equation</strong> (also called an <strong>analytic solution</strong>) is a function which, when substituted into the differential equation, creates a true statement.
</div>
<hr />

<div class="example">
<p><span id="exm:unnamed-chunk-419" class="example"><strong>Example 5.1  </strong></span>The function <span class="math inline">\(x(t) = 3e^{-0.25t}\)</span> is a solution to the differential equation <span class="math inline">\(x&#39; = -0.25x\)</span> with initial condition <span class="math inline">\(x(0) = 3\)</span>. We can verify this by substituting <span class="math inline">\(x(t)\)</span> into the differential equation:
<span class="math display">\[\begin{aligned} 
\frac{d}{dt} \left( x(t) \right) &amp;\stackrel{?}{=} -0.25 x(t)\\
\implies \frac{d}{dt} \left( 3e^{-0.25t} \right) &amp;\stackrel{?}{=} -0.25 \left( 3e^{-0.25t} \right) \\
\implies -0.25 \left( 3e^{-0.25t} \right) &amp;\stackrel{\checkmark}{=} -0.25 \left( 3e^{-0.25t} \right)
\end{aligned}
\]</span>
Furthermore, <span class="math inline">\(x(0) = 3e^{-0.25 \cdot 0} = 3e^0 = 3 \checkmark\)</span>. Hence, the function <span class="math inline">\(x(t) = 3e^{-0.25t}\)</span> is indeed a solution to the differential equation <span class="math inline">\(x&#39;=-0.25x\)</span> with <span class="math inline">\(x(0) = 3\)</span>.</p>
</div>
<hr />

<div class="definition">
<span id="def:unnamed-chunk-420" class="definition"><strong>Definition 5.3  (Numerical Solution to a Differential Equation)  </strong></span>A <strong>numerical solution to a differential equation</strong> is a list of ordered pairs that gives a point-wise approximation to the actual solution.
</div>
<hr />
<p>In this chapter we will examine some of the more common ways to create approximations of solutions to differential equations. Moreover, we will lean heavily on Taylor Series to give us ways to accurately measure the order of the errors that we make in the process.</p>
<div style="page-break-after: always;"></div>
</div>
<div id="recalling-the-basics-of-odes" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Recalling the Basics of ODEs</h2>
<p>You should be familiar with the basics of differential equations from previous classes, but just in case you’re a bit rusty, this section gives a very brief review of some of the basics.</p>
<p>Solving differential equations analytically is a subject unto itself, but it is worth our time here to revisit some of the basic techniques for solving differential equations. It should be noted that if an analytic solution exits then there is no reason to do any of the numerical techniques that we will discuss in this chapter – if you have an exact analytic solution then why on earth would you then approximate the solution!? The fact of the matter is, however, that the techniques for finding analytic solutions to differential equations are rather limited relative to the wild zoo of possible ODEs, and when the differential equations get complicated we will only have numerical approximations to lean back on. However, when we build approximation methods we will test them on differential equations for which we have the answer. So let’s get started with some review.</p>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-421" class="exercise"><strong>Exercise 5.2  </strong></span>Identify which of the following problems are <em>differential</em> equations
and which are <em>algebraic</em> equations. (Do not try to solve any of these equations)</p>
<ol style="list-style-type: lower-alpha">
<li><span class="math inline">\(x^2 + 5x = 7x^3 - 2\)</span></li>
<li><span class="math inline">\(x&#39;&#39; + 5x = 7x&#39;&#39;&#39; - 2\)</span></li>
<li><span class="math inline">\(x&#39; + 5 = -3x\)</span></li>
<li><span class="math inline">\(x&#39;&#39;x&#39;x = 8\)</span></li>
<li><span class="math inline">\(x^2 \cdot x = 8\)</span></li>
</ol>
</div>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-422" class="exercise"><strong>Exercise 5.3  </strong></span>Consider the differential equation <span class="math inline">\(x&#39; = 3x\)</span> with an initial condition <span class="math inline">\(x(0) = 4\)</span>. Which of the following functions is a solution to this differential equation, and what is the value of the constant in the function?</p>
<ol style="list-style-type: lower-alpha">
<li><span class="math inline">\(x(t) = C \sin(3 t)\)</span></li>
<li><span class="math inline">\(x(t) = C e^{3t}\)</span></li>
<li><span class="math inline">\(x(t) = C t^3\)</span></li>
<li><span class="math inline">\(x(t) = t^3 + C\)</span></li>
<li><span class="math inline">\(x(t) = e^{3t} + C\)</span></li>
<li><span class="math inline">\(x(t) = \sin(3t) + C\)</span></li>
</ol>
</div>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-423" class="exercise"><strong>Exercise 5.4  </strong></span>Consider the differential equation <span class="math inline">\(x&#39; = 3x + t\)</span> with an initial condition <span class="math inline">\(x(0) = 4\)</span>. Which of the following functions is a solution to this differential equation, and what are the values of the constants?</p>
<ol style="list-style-type: lower-alpha">
<li><span class="math inline">\(x(t) = C_0 \sin(\sqrt{3} t) + C_1 t + C_2\)</span></li>
<li><span class="math inline">\(x(t) = C_0 e^{3t} + C_1 t + C_2\)</span></li>
<li><span class="math inline">\(x(t) = C_0 t^3 + C_1 t + C_2\)</span></li>
<li><span class="math inline">\(x(t) = C_3 t^3 + C_2 t^2 + C_1 t + C_0\)</span></li>
<li><span class="math inline">\(x(t) = e^{3t} + C_1 t + C_2\)</span></li>
<li><span class="math inline">\(x(t) = \sin(3t) + C_1 t + C_2\)</span></li>
</ol>
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-424" class="exercise"><strong>Exercise 5.5  </strong></span>Prove that the function <span class="math inline">\(x(t) = -\frac{1}{2} \cos(2t) + \frac{7}{2}\)</span> solves the differential equation <span class="math inline">\(x&#39; = \sin(2t)\)</span> with the initial condition <span class="math inline">\(x(0) =3\)</span>.
</div>
<hr />
<p>Next we can recall one of the easiest techniques of solving ODEs by hand: separation of variables. We review separation here since we will often choose very easy (i.e. separable) differential equations to check our numerical work.</p>

<div class="theorem">
<span id="thm:unnamed-chunk-425" class="theorem"><strong>Theorem 5.1  (Separation of Variables)  </strong></span>To solve a differential equation of the form
<span class="math display">\[\frac{dx}{dt} = f(x) g(t)\]</span> we can separate the variables and rewrite
the problem as <span class="math display">\[\int \frac{dx}{f(x)} = \int g(t) dt.\]</span> Integrating both
sides and solving for <span class="math inline">\(x(t)\)</span> gives the solution.
</div>

<div class="proof">
<p> <span class="proof"><em>Proof. </em></span> If <span class="math inline">\(\frac{dx}{dt} = f(x) g(t)\)</span> then we can first divide both sides by <span class="math inline">\(f(x)\)</span> (assuming that it is nonzero) and integrate both sides of the equation with respect to <span class="math inline">\(t\)</span> to get<br />
<span class="math display">\[ \int \frac{1}{f(x)} \frac{dx}{dt} dt = \int g(t) dt. \]</span>
The expression <span class="math inline">\(\frac{dx}{dt} dt\)</span> in the left-hand integral is the definition of the differential <span class="math inline">\(dx\)</span> so the integral equation can be rewritten as
<span class="math display">\[ \int \frac{1}{f(x)} dx = \int g(t) dt. \]</span></p>
Note that it may be quite challenging to actually integrate the functions resulting from separation of variables.
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-427" class="exercise"><strong>Exercise 5.6  </strong></span>Use separation of variables to solve the differential equation <span class="math display">\[\frac{dx}{dt} = x\sin(t)\]</span> with the initial condition <span class="math inline">\(x(0) = 1\)</span>.
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-428" class="exercise"><strong>Exercise 5.7  </strong></span>Solve the differential equation <span class="math inline">\(x&#39; = -2x + 12\)</span> with <span class="math inline">\(x(0) = 2\)</span> using separation of variables.
</div>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-429" class="exercise"><strong>Exercise 5.8  </strong></span>Consider the differential equation <span class="math display">\[\frac{dx}{dt} = -\frac{1}{4} x + 4\]</span> with the initial condition <span class="math inline">\(x(0) = 7\)</span>.</p>
<ol style="list-style-type: lower-alpha">
<li>Solve the differential equation using separation of variables.</li>
<li>Substitute your solution into the differential equation and verify
that you are indeed correct in your work in part (a).</li>
</ol>
</div>
<hr />
<p>There are MANY other techniques for solving differential equations, but a full discussion of all of those techniques is beyond the scope of this book. For the remainder of this chapter we will focus on finding <em>approximate</em> solutions to differential equations. It will be handy, however, to be able to check our work on problems where an analytic solution is available. Techniques you should remind yourself of are:</p>
<ul>
<li>The method of undetermined coefficients for first- and second-order linear differential equations.</li>
<li>The method of integrating factors.</li>
<li>The eigenvalue-eigenvector method for solving linear systems of differential equations.</li>
</ul>
<hr />
<div style="page-break-after: always;"></div>
</div>
<div id="eulers-method" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Euler’s Method</h2>

<div class="exercise">
<p><span id="exr:euler-motivation" class="exercise"><strong>Exercise 5.9  </strong></span>Consider the differential equation <span class="math inline">\(x&#39; = -0.5x\)</span> with the initial condition <span class="math inline">\(x(0) = 6\)</span>.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Since we know that <span class="math inline">\(x(0) = 6\)</span> and we know that <span class="math inline">\(x&#39;(0) = -0.5 \cdot x(0)\)</span> we can approximate the value of <span class="math inline">\(x\)</span> at some future time step. Let’s go 1 unit forward in time. That is, approximate <span class="math inline">\(x(1)\)</span> knowing that <span class="math inline">\(x(0) = 6\)</span> and <span class="math inline">\(x&#39;(0) = -3\)</span>.<br />
Hint: We know a value, a slope, and the size of the step that we would like to move in the <span class="math inline">\(t\)</span> direction.
<span class="math display">\[x(1) \approx \underline{\hspace{1in}}\]</span></p></li>
<li><p>Use your answer from part (a) for time <span class="math inline">\(t=1\)</span> to approximate the <span class="math inline">\(x\)</span> value at time <span class="math inline">\(t=2\)</span>. Then use that value to approximate the value at time <span class="math inline">\(t=3\)</span>. Repeat the process to approximate the value of <span class="math inline">\(x\)</span> at times <span class="math inline">\(t=2, 3, 4, 5, \ldots, 10\)</span>. Record your answers in the table below. Then find the analytic solution to this differential equation and record the <span class="math inline">\(x\)</span> values at the appropriate times.</p></li>
</ol>
<table>
<thead>
<tr class="header">
<th><span class="math inline">\(t\)</span></th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>10</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Approximation of <span class="math inline">\(x(t)\)</span></td>
<td>6</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>Exact value of <span class="math inline">\(x(t)\)</span></td>
<td>6</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ol start="3" style="list-style-type: lower-alpha">
<li><p>The “approximations of <span class="math inline">\(x\)</span>” that you found in part (b) are a <strong>numerical approximation</strong> of the solution to the differentialequation. You should notice that your numerical solution is pretty far off from the actual solution for most values of <span class="math inline">\(t\)</span>. Why? What could be the sources of this error and how could we fix it? Once you have an idea of how to fix it, put your idea into action and devise some measurement of error to analyze your results.</p></li>
<li><p>In Figure <a href="ch-odes.html#fig:euler-slope1">5.1</a> you will see a slope field and the exact solution to the differential equation <span class="math inline">\(x&#39; = -0.5x\)</span> with <span class="math inline">\(x(0) = 6\)</span>. Mark your approximate solutions at times <span class="math inline">\(t=1\)</span>, <span class="math inline">\(t=2\)</span>, <span class="math inline">\(\ldots\)</span>, <span class="math inline">\(t=10\)</span> on the plot and connect them with straight lines.</p>
<ol style="list-style-type: lower-roman">
<li>Why are we using straight lines to connect the points?</li>
<li>What do you notice about your approximate solutions?<br />
</li>
<li>Why is it helpful to have the slope field in the background on this plot?</li>
</ol></li>
</ol>
</div>
<div class="figure" style="text-align: center"><span id="fig:euler-slope1"></span>
<img src="images/Ch05_EulerSlope1.png" alt="Plot your approximate solution on top of the slope field and the exact solution." width="75%" />
<p class="caption">
Figure 5.1: Plot your approximate solution on top of the slope field and the exact solution.
</p>
</div>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-430" class="exercise"><strong>Exercise 5.10  </strong></span>In Figure <a href="ch-odes.html#fig:euler-slope2">5.2</a> you see the analytic solution at <span class="math inline">\(x(0)=5\)</span> and a slope field for an unknown differential equation.</p>
<ol style="list-style-type: lower-alpha">
<li>Use the slope field and a step size of <span class="math inline">\(\Delta t=1\)</span> to plot approximate solution values at <span class="math inline">\(t=1\)</span>, <span class="math inline">\(t=2\)</span>, <span class="math inline">\(\ldots\)</span>, <span class="math inline">\(t=10\)</span>. Connect your points with straight lines. The collection of line segments that you just drew is an aproximation to the solution of the unknown differential equation.</li>
<li>Use the slope field and a step size of <span class="math inline">\(\Delta t = 0.5\)</span> to plot approximate solution avlues at <span class="math inline">\(t=0.5\)</span>, <span class="math inline">\(t=1\)</span>, <span class="math inline">\(t=1.5\)</span>, <span class="math inline">\(\ldots\)</span>, <span class="math inline">\(t=10\)</span>. Again, connect your points with straight lines to get an approximation of the solution to the unknown differential equation.</li>
<li>If you could take <span class="math inline">\(\Delta t\)</span> to be very very small, what difference would you see graphically between the exact solution and your collection of line segments? Why?</li>
</ol>
</div>
<div class="figure" style="text-align: center"><span id="fig:euler-slope2"></span>
<img src="images/Ch05_EulerSlope2.png" alt="Plot your approximate solution on top of the slope field and the exact solution." width="75%" />
<p class="caption">
Figure 5.2: Plot your approximate solution on top of the slope field and the exact solution.
</p>
</div>
<hr />
<p>The notion of approximating solutions to differential equations is simple in principle:</p>
<ul>
<li>make a discrete approximation to the derivative and</li>
<li>step forward through time as a difference equation.</li>
</ul>
<p>The challenging part is making the approximation to the derivative(s). There are many methods for approximating derivatives, and that is exactly where we’ll start.</p>
<hr />

<div class="definition">
<span id="def:unnamed-chunk-431" class="definition"><strong>Definition 5.4  (Euler’s Method)  </strong></span>Euler’s Method is a technique for approximating the
solution to the differential equation <span class="math inline">\(x&#39;(t) = f(t,x(t))\)</span>. Recall from Problem <a href="ch-calculus.html#exr:num-diff-first-order">3.11</a> that the first derivative of a function can be discretized as
<span class="math display">\[x&#39;(t) = \frac{x(t+h) - x(t)}{h} + \mathcal{O}(h)\]</span> where <span class="math inline">\(h = \Delta t\)</span> is the step size (or the size of each partition in the domain), so the differential
equation <span class="math inline">\(x&#39;(t) = f(t,x(t))\)</span> becomes
<span class="math display">\[\frac{x(t+h) - x(t)}{h} \approx f(t,x(t)).\]</span> Rewriting as a difference
equation, letting <span class="math inline">\(x_{n+1} = x(t_n+h)\)</span> and <span class="math inline">\(x_n = x(t_n)\)</span>, we get
<span class="math display">\[\begin{aligned}
        x_{n+1} = x_n + h f(t_n,x_n)
        \label{eqn:Eulers_method}
    \end{aligned}\]</span>
</div>
<hr />
<p>A way to think about Euler’s method is that at a given point, the slope is approximated by the value of the right-hand side of the differential equation and then we step forward <span class="math inline">\(h\)</span> units in time following that slope. Figure <a href="ch-odes.html#fig:Euler">5.3</a> shows a depiction of the idea. Notice in the figure that in regions of high curvature Euler’s method will overshoot the exact solution to the differential equation. However, taking the limit as <span class="math inline">\(h\)</span> tends to <span class="math inline">\(0\)</span> theoretically gives the exact solution at the trade off of needing infinite computational resources.</p>
<div class="figure" style="text-align: center"><span id="fig:Euler"></span>
<img src="images/Ch05_Euler.png" alt="Numerical solutions to a differential equation using Euler's method." width="70%" />
<p class="caption">
Figure 5.3: Numerical solutions to a differential equation using Euler’s method.
</p>
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-432" class="exercise"><strong>Exercise 5.11  </strong></span>Why would Euler’s method overshoot the exact solution in regions where the solution exhibits high curvature?
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-433" class="exercise"><strong>Exercise 5.12  </strong></span>Write code to implement Euler’s method for initial value problems. Your
function should accept as input a Python function <span class="math inline">\(f(t,x)\)</span>, an initial condition, a start time, an end time, and the value of <span class="math inline">\(h = \Delta t\)</span>. The output should be vectors for <span class="math inline">\(t\)</span> and <span class="math inline">\(x\)</span> that you can easily plot to show the numerical solution. The code below will get you started.
</div>
<div class="sourceCode" id="cb122"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb122-1"><a href="ch-odes.html#cb122-1"></a><span class="kw">def</span> euler1d(f,x0,t0,tmax,dt):</span>
<span id="cb122-2"><a href="ch-odes.html#cb122-2"></a>    t <span class="op">=</span> <span class="co"># set up the domain based on t0, tmax, and dt</span></span>
<span id="cb122-3"><a href="ch-odes.html#cb122-3"></a>    <span class="co"># next set up an array for x that is the same size a t</span></span>
<span id="cb122-4"><a href="ch-odes.html#cb122-4"></a>    x <span class="op">=</span> np.zeros_like(t)</span>
<span id="cb122-5"><a href="ch-odes.html#cb122-5"></a>    x[<span class="dv">0</span>] <span class="op">=</span> <span class="co"># fill in the initial condition</span></span>
<span id="cb122-6"><a href="ch-odes.html#cb122-6"></a>    <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>( ??? ): <span class="co"># think about how far we should loop</span></span>
<span id="cb122-7"><a href="ch-odes.html#cb122-7"></a>        x[n<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> <span class="co"># advance the solution forward in time with Euler</span></span>
<span id="cb122-8"><a href="ch-odes.html#cb122-8"></a>    <span class="cf">return</span> t, x</span></code></pre></div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-435" class="exercise"><strong>Exercise 5.13  </strong></span>Test your code from the previous exercise on a first order differential equation where you know the answer. Then test your code on the differential equation
<span class="math display">\[x&#39; = -\frac{1}{3}x+\sin(t) \quad \text{where} \quad x(0) = 1.\]</span>
The partial code below should get you started.
</div>
<div class="sourceCode" id="cb123"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb123-1"><a href="ch-odes.html#cb123-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb123-2"><a href="ch-odes.html#cb123-2"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb123-3"><a href="ch-odes.html#cb123-3"></a><span class="co"># put the f(t,x) function on the next line </span></span>
<span id="cb123-4"><a href="ch-odes.html#cb123-4"></a><span class="co"># (be sure to specify t even if it doesn&#39;t show up in your ODE)</span></span>
<span id="cb123-5"><a href="ch-odes.html#cb123-5"></a>f <span class="op">=</span> <span class="kw">lambda</span> t, x: <span class="co"># your function goes here</span></span>
<span id="cb123-6"><a href="ch-odes.html#cb123-6"></a>x0 <span class="op">=</span> <span class="co"># initial condition</span></span>
<span id="cb123-7"><a href="ch-odes.html#cb123-7"></a>t0 <span class="op">=</span> <span class="co"># initial time</span></span>
<span id="cb123-8"><a href="ch-odes.html#cb123-8"></a>tmax <span class="op">=</span> <span class="co"># final time (your choice)</span></span>
<span id="cb123-9"><a href="ch-odes.html#cb123-9"></a>dt <span class="op">=</span> <span class="co"># Delta t (your choice, but make it small)</span></span>
<span id="cb123-10"><a href="ch-odes.html#cb123-10"></a>t, x <span class="op">=</span> euler1d(f,x0,t0,tmax,dt)</span>
<span id="cb123-11"><a href="ch-odes.html#cb123-11"></a>plt.plot(t,x,<span class="st">&#39;b-&#39;</span>)</span>
<span id="cb123-12"><a href="ch-odes.html#cb123-12"></a>plt.grid()</span>
<span id="cb123-13"><a href="ch-odes.html#cb123-13"></a>plt.show()</span></code></pre></div>
<hr />

<div class="exercise">
<p><span id="exr:ode-error-analysis" class="exercise"><strong>Exercise 5.14  </strong></span>The differential equation
<span class="math inline">\(x&#39; = -\frac{1}{3}x + \sin(t)\)</span> with <span class="math inline">\(x(0) = 1\)</span> has an analytic solution
<span class="math display">\[x(t) = \frac{1}{10} \left( 19 e^{-t/3} + 3\sin(t) - 9\cos(t) \right).\]</span>
The goal of this problem will be to compare the maximum error on the
interval <span class="math inline">\(t \in  [0,5]\)</span> for various values of <span class="math inline">\(\Delta t\)</span> in your Euler solver.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Write code that gives the maximum point-wise error between your
numerical solution and the analytic solution given a value of
<span class="math inline">\(\Delta t\)</span>.</p></li>
<li><p>Using your code from part (a), build a plot with the value of
<span class="math inline">\(\Delta t\)</span> on the horizontal axis and the value of the
associated error on the vertical axis. You should use a log-log
plot. Obviously you will need to run your code many times at many
different values of <span class="math inline">\(\Delta t\)</span> to build your data set.</p></li>
<li><p>In general, if you were to cut your value of <span class="math inline">\(\Delta t\)</span> in half,
what would that do to the value of the error? What about dividing
<span class="math inline">\(\Delta t\)</span> by 10? 100? 1000?</p></li>
</ol>
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-437" class="exercise"><strong>Exercise 5.15  </strong></span>Shelby solved a first order ODE <span class="math inline">\(x&#39; = f(t,x)\)</span> using Euler’s method with a step size of <span class="math inline">\(dt = 0.1\)</span> on a domain <span class="math inline">\(t \in [0,3]\)</span>. To test her code she used a differential equation where she new the exact analytic solution and she found the maximum absolute error on the interval to be <span class="math inline">\(0.15\)</span>. Jackson then solves the exact same differential equation, on the same interval, with the same initial condition using Euler’s method and a step size of <span class="math inline">\(dt = 0.01\)</span>. What is Jackson’s expected maximum absolute error?
</div>
<hr />

<div class="theorem">
<span id="thm:unnamed-chunk-438" class="theorem"><strong>Theorem 5.2  </strong></span>Euler’s method is a first order method for approximating the solution to the differential equation <span class="math inline">\(x&#39; = f(t,x)\)</span>. Hence, if the step size <span class="math inline">\(h\)</span> of the partition of the domain were to be divided by some positive constant <span class="math inline">\(M\)</span> then the maximum absolute error between the numerical solution and the exact solution would ???<br />
(Complete the last sentence.)
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-439" class="exercise"><strong>Exercise 5.16  </strong></span>If we want to numerically solve the first order differential equation <span class="math inline">\(x&#39; = f(t,x)\)</span> on the interval <span class="math inline">\(t \in [0,1]\)</span> with Euler’s method so that we realize a maximum absolute error of <span class="math inline">\(10^{-8}\)</span> between the numerical solution and the exact solution, then how many points do we need to subdivide the interval <span class="math inline">\([0,1]\)</span> into?
</div>
<hr />

<div class="exercise">
<p><span id="exr:euler-multi-dimensional" class="exercise"><strong>Exercise 5.17  </strong></span>If a mass is hanging from a spring then Newton’s second law, <span class="math inline">\(\sum F=ma\)</span>, gives us the differential equation <span class="math inline">\(mx&#39;&#39; = F_{restoring} + F_{damping}\)</span> where <span class="math inline">\(x\)</span> is the displacement of the mass from equilibrium, <span class="math inline">\(m\)</span> is the mass of the object hanging from the spring, <span class="math inline">\(F_{restoring}\)</span> is the force pulling the mass back to equilibrium, and <span class="math inline">\(F_{damping}\)</span> is the force due to friction or air resistance that slows the mass down.</p>
<ol style="list-style-type: lower-alpha">
<li>Which of the following is a good candidate for a restoring force in a spring? Defend your answer.
<ol style="list-style-type: lower-roman">
<li><span class="math inline">\(F_{restoring} = kx\)</span>: The restoring force is proportional to the displacement away from equilibrium.</li>
<li><span class="math inline">\(F_{restoring} = kx&#39;\)</span>: The restoring force is proportional to the velocity of the mass.</li>
<li><span class="math inline">\(F_{restoring} = kx&#39;&#39;\)</span>: The restoring force is proportional to the acceleration of the mass.</li>
</ol></li>
<li>Which of the following is a good candidate for a damping force in a spring? Defend your answer.
<ol style="list-style-type: lower-roman">
<li><span class="math inline">\(F_{damping} = bx\)</span>: The damping force is proportional to the displacement away from equilibrium.</li>
<li><span class="math inline">\(F_{damping} = bx&#39;\)</span>: The damping force is proportional to the velocity of the mass.</li>
<li><span class="math inline">\(F_{damping} = bx&#39;&#39;\)</span>: The damping force is proportional to the acceleration of the mass.</li>
</ol></li>
<li>Put your answers to parts (a) and (b) together and simplify to form a second-order differential equation for position:
<span class="math display">\[ \underline{\hspace{0.25in}} x&#39;&#39; + \underline{\hspace{0.25in}} x&#39; + \underline{\hspace{0.25in}} x = 0 \]</span></li>
<li>If we want to solve a second order differential equation numerically we need to convert it to first order differential equations (Euler’s method is only designed to deal with first order differential equations, not second order). To do so we can introduce a new variable, <span class="math inline">\(x_1\)</span>, such that <span class="math inline">\(x_1 = x&#39;\)</span>. For the sake of notational consistency we define <span class="math inline">\(x_0 = x\)</span>. The result is a system of first-order differential equations.
<span class="math display">\[\begin{aligned} x_0&#39; &amp;= x_1 \\ x_1&#39; &amp;= \underline{\hspace{2in}} \end{aligned}\]</span></li>
<li>The code and Euler’s method algorithm that we’ve created thus far in this chapter are only designed to work with a single differential equation instead of a system, so we need to make some modifications. We can discretize the system of differential equations using Euler’s method so that
<span class="math display">\[ \boldsymbol{x}&#39; = F(t,\boldsymbol{x}) \]</span>
where <span class="math inline">\(F\)</span> is a function that accepts a vector of inputs, plus time, and returns a vector of outputs. In the context of this particular problem,
<span class="math display">\[ F(t,\boldsymbol{x}) = \begin{pmatrix} x_0&#39; \\ x_1&#39; \end{pmatrix} = \begin{pmatrix} x_1 \\ \underline{\hspace{1in}} \end{pmatrix} \]</span></li>
<li>We now need to discretize the derivatives in the system. As with 1D Euler’s method, we will use a first-order approximation of the first derivative so that
<span class="math display">\[ \frac{\boldsymbol{x}_{n+1} - \boldsymbol{x}_n }{h} = F(t_n,\boldsymbol{x}_n) + \mathcal{O}(h). \]</span>
Rearranging and solving for <span class="math inline">\(\boldsymbol{x}_{n+1}\)</span> gives
<span class="math display">\[ \boldsymbol{x}_{n+1} = \underline{\hspace{0.5in}} + h F( \underline{\hspace{0.25in}} , \underline{\hspace{0.25in}}). \]</span></li>
<li>We now have a choice about how we’re going to code this new 2D version of Euler’s method. We could just include one more input function and one more input initial condition into the <code>euler()</code> function so that the Python function call is <code>euler(f0,f1,x0,x1,t0,tmax,dt)</code> where <code>f0</code> and <code>f1</code> are the two right-hand sides of the system, and <code>x0</code> and <code>x1</code> are the two initial conditions. Alternatively, we could rethink our <code>euler()</code> function so that it accepts an array of functions and an array of initial conditions so that the Python function call is <code>euler(F,X,t0,tmax,dt)</code> where <code>F</code> is a Python array of functions and <code>X</code> is a Python array of initial conditions. Discuss the pros and cons of each approach.<br />
</li>
<li>The following Python function and associated script will implement the vector version of Euler’s method. Complete the code and then use it to solve the system of equations from part (d). Use a mass of <span class="math inline">\(m=2\)</span>kg, a damping force of <span class="math inline">\(b=40\)</span>kg/s, and a spring constant of <span class="math inline">\(k=128\)</span>N/m. Consider an initial position of <span class="math inline">\(x=0\)</span>m (equilibrium) and an initial velocity of <span class="math inline">\(x_1 = 0.6\)</span>m/s. Show two plots: a plot that shows both position and velocity vs time and a second plot, called a phase plot, that shows position vs velocity.</li>
</ol>
</div>
<div class="sourceCode" id="cb124"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb124-1"><a href="ch-odes.html#cb124-1"></a><span class="kw">def</span> euler(F,x0,t0,tmax,dt):</span>
<span id="cb124-2"><a href="ch-odes.html#cb124-2"></a>    t <span class="op">=</span> <span class="co"># same code as before to set up a vector for time</span></span>
<span id="cb124-3"><a href="ch-odes.html#cb124-3"></a>    <span class="co"># Next we set up x so that it is an array where the columns </span></span>
<span id="cb124-4"><a href="ch-odes.html#cb124-4"></a>    <span class="co"># are the different dimensions of the problem.  For example, </span></span>
<span id="cb124-5"><a href="ch-odes.html#cb124-5"></a>    <span class="co"># in this problem there will be 2 columns and len(t) rows</span></span>
<span id="cb124-6"><a href="ch-odes.html#cb124-6"></a>    x <span class="op">=</span> np.zeros( (<span class="bu">len</span>(t), <span class="bu">len</span>(x0)) ) </span>
<span id="cb124-7"><a href="ch-odes.html#cb124-7"></a>    x[<span class="dv">0</span>,:] <span class="op">=</span> x0 <span class="co"># store the initial condition in the first row</span></span>
<span id="cb124-8"><a href="ch-odes.html#cb124-8"></a>    <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(t)<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb124-9"><a href="ch-odes.html#cb124-9"></a>        x[n<span class="op">+</span><span class="dv">1</span>,:] <span class="op">=</span> x[ ??? , ??? ] <span class="op">+</span> dt<span class="op">*</span>F(t[ ??? ], x[ ??? , ??? ])</span>
<span id="cb124-10"><a href="ch-odes.html#cb124-10"></a>    <span class="cf">return</span> t, x</span></code></pre></div>
<p>To use the <code>euler()</code> function defined above we can use the following code. Fill in the code for this system of differential equations with this problem.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb125-1"><a href="ch-odes.html#cb125-1"></a>F <span class="op">=</span> <span class="kw">lambda</span> t, x: np.array([ x[<span class="dv">1</span>] , ??? ])</span>
<span id="cb125-2"><a href="ch-odes.html#cb125-2"></a>x0 <span class="op">=</span> [ ??? , ??? ] <span class="co"># initial conditions</span></span>
<span id="cb125-3"><a href="ch-odes.html#cb125-3"></a>t0 <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb125-4"><a href="ch-odes.html#cb125-4"></a>tmax <span class="op">=</span> <span class="dv">5</span> <span class="co"># pick something reasonable here</span></span>
<span id="cb125-5"><a href="ch-odes.html#cb125-5"></a>dt <span class="op">=</span> <span class="fl">0.01</span> <span class="co"># your choice.  pick something small</span></span>
<span id="cb125-6"><a href="ch-odes.html#cb125-6"></a>t, x <span class="op">=</span> euler(F,x0,t0,tmax,dt)</span>
<span id="cb125-7"><a href="ch-odes.html#cb125-7"></a><span class="co"># Next we plot the solutions against time </span></span>
<span id="cb125-8"><a href="ch-odes.html#cb125-8"></a>plt.plot(t,x[ ??? , ???],<span class="st">&#39;b-&#39;</span>,t,x[ ??? , ???],<span class="st">&#39;r--&#39;</span>)</span>
<span id="cb125-9"><a href="ch-odes.html#cb125-9"></a>plt.grid()</span>
<span id="cb125-10"><a href="ch-odes.html#cb125-10"></a>plt.title(<span class="st">&#39;Time Evolution of Position and Velocity&#39;</span>)</span>
<span id="cb125-11"><a href="ch-odes.html#cb125-11"></a>plt.legend([<span class="st">&#39;which legend entry here&#39;</span>,<span class="st">&#39;which legend entry here&#39;</span>])</span>
<span id="cb125-12"><a href="ch-odes.html#cb125-12"></a>plt.xlabel(<span class="st">&#39;time&#39;</span>)</span>
<span id="cb125-13"><a href="ch-odes.html#cb125-13"></a>plt.ylabel(<span class="st">&#39;position and velocity&#39;</span>)</span>
<span id="cb125-14"><a href="ch-odes.html#cb125-14"></a>plt.show()</span>
<span id="cb125-15"><a href="ch-odes.html#cb125-15"></a><span class="co"># Then we plot one solution against the other for a phase plot</span></span>
<span id="cb125-16"><a href="ch-odes.html#cb125-16"></a><span class="co"># In a phase plot time is implicit (not one of the axes)</span></span>
<span id="cb125-17"><a href="ch-odes.html#cb125-17"></a>plt.plot(x[ ??? , ???], x[ ??? , ???], <span class="st">&#39;k--&#39;</span>)</span>
<span id="cb125-18"><a href="ch-odes.html#cb125-18"></a>plt.grid()</span>
<span id="cb125-19"><a href="ch-odes.html#cb125-19"></a>plt.title(<span class="st">&#39;Phase Plot&#39;</span>)</span>
<span id="cb125-20"><a href="ch-odes.html#cb125-20"></a>plt.xlabel(<span class="st">&#39;???&#39;</span>)</span>
<span id="cb125-21"><a href="ch-odes.html#cb125-21"></a>plt.ylabel(<span class="st">&#39;???&#39;</span>)</span>
<span id="cb125-22"><a href="ch-odes.html#cb125-22"></a>plt.show()</span></code></pre></div>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-442" class="exercise"><strong>Exercise 5.18  </strong></span>Consider a collection of two connected mass-spring oscillators where there is a mass hanging from a fixture and a second mass is connected directly to the first (hanging vertically). For simplicity in this problem we will neglect damping. Let <span class="math inline">\(k_0\)</span> and <span class="math inline">\(k_1\)</span> be the spring constants for the two springs, respectively. Also let <span class="math inline">\(m_0\)</span> and <span class="math inline">\(m_1\)</span> be the respective masses. For simplicity in this problem we will take <span class="math inline">\(m_0 = m_1 = m\)</span>.</p>
<ol style="list-style-type: lower-alpha">
<li>Draw a picture of the physical setup described. Let <span class="math inline">\(x_0\)</span> be the position of mass 0 relative to its equilibrium. Let <span class="math inline">\(x_1\)</span> be the position of mass 1 relative to its equilibrium. Label the coordinate systems for the two springs on your picture.</li>
<li>Give a thorough explanation for why the following second order differential equation models the position of the first mass
<span class="math display">\[ m x_0&#39;&#39; = -k_0 x_0 - k_1 (x_0 - x_1).  \]</span></li>
<li>Using similar logic from part (b), write a second order differential equation for the position of the second mass
<span class="math display">\[ m x_1&#39;&#39; = \underline{\hspace{2in}} \]</span></li>
<li>We now have a system of two second order differential equations. We can convert this to four first order differential equations by introducing two new variables: <span class="math inline">\(x_2 = x_0&#39;\)</span> and <span class="math inline">\(x_3 = x_1&#39;\)</span>. Write the full system of first order differential equations.</li>
<li>Use your vector-based <code>euler()</code> function to numerically solve the system of equations in several different physical scenarios. There are four variables so you will need to think carefully about which plots are the most explanatory. Also, if may be easiest to take <span class="math inline">\(k_0 = 1\)</span> and then take <span class="math inline">\(k_1\)</span> as the stiffness of spring 1 relative to spring 0 (e.g. if <span class="math inline">\(k_1 = 1\)</span> then the springs are the same stiffness, if <span class="math inline">\(k_1 = 0.5\)</span> then spring 1 is half as stiff, etc). To start with choose <span class="math inline">\(m=m_0 = m_1 = 1\)</span>kg.</li>
</ol>
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-443" class="exercise"><strong>Exercise 5.19  </strong></span>Extend the previous exercise to that there are three masses hanging in a chain.
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-444" class="exercise"><strong>Exercise 5.20  </strong></span>If the speed of the mass in the mass-spring oscillator is <em>fast enough</em> then the damping force will no longer just be proportional to the velocity. Instead, at higher speeds the drag force is proportional to the square of the velocity. You can think of this as a bungee jumper jumping off of a bridge. Modify the single mass-spring oscillator equation to allow for nonlinear quadratic damping. Solve the system numerically under several different physical conditions (stiff spring, non-stiff spring, high damping, low damping, different initial conditions, etc).
</div>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-445" class="exercise"><strong>Exercise 5.21  (A Lotka-Volterra Model)  </strong></span>Test your code from the previous problems on the following system of differential equations by showing a time evolution plot (time on <span class="math inline">\(x_0\)</span> and populations on <span class="math inline">\(x_1\)</span>) as well as a phase plot (<span class="math inline">\(x_0\)</span> on the <span class="math inline">\(x\)</span> and <span class="math inline">\(x_1\)</span> on the <span class="math inline">\(y\)</span> with time understood implicitly):<br />
<strong>The Lotka-Volterra Predator-Prey Model:</strong><br />
Let <span class="math inline">\(x_0(t)\)</span> denote the number of rabbits (prey) and <span class="math inline">\(x_1(t)\)</span> denote the
number of foxes (predator) at time <span class="math inline">\(t\)</span>. The relationship between the
species can be modeled by the classic 1920’s Lotka-Volterra Model:
<span class="math display">\[\left\{ \begin{array}{ll} x_0&#39; &amp;= \alpha x_0 - \beta x_0 x_1 \\ x_1&#39; &amp;= \delta x_0 x_1 - \gamma x_1 \end{array} \right.\]</span>
where <span class="math inline">\(\alpha, \beta, \gamma,\)</span> and
<span class="math inline">\(\delta\)</span> are positive constants. For this problems take
<span class="math inline">\(\alpha \approx 1.1\)</span>, <span class="math inline">\(\beta \approx 0.4\)</span>, <span class="math inline">\(\gamma \approx 0.1\)</span>, and
<span class="math inline">\(\delta \approx 0.4\)</span>.</p>
<ol style="list-style-type: lower-alpha">
<li>First rewrite the system of ODEs in the form <span class="math inline">\(\boldsymbol{x}&#39; = F(t,\boldsymbol{x})\)</span> so you can use your <code>euler()</code> code.<br />
</li>
<li>Modify your code from the previous problem so that it works for this problem. Use <code>tmax = 200</code> and an appropriately small time step. Start with initial conditions <span class="math inline">\(x_0(0)=20\)</span> rabbits and <span class="math inline">\(x_1(0)=1\)</span> fox.</li>
<li>Create the time evolution plot. What does this plot tell you in context?</li>
<li>Create a phase plot. What does this plot tell you in context?<br />
</li>
<li>If you cut your time step in half, what do you see in the two plots? Why? What is Euler’s method doing here?</li>
</ol>
</div>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-446" class="exercise"><strong>Exercise 5.22  (The SIR Model)  </strong></span>A classic model for predicting the spread of a virus or a disease is the SIR Model. In these models, <span class="math inline">\(S\)</span> stands for the proportion of the population which is susceptible to the virus, <span class="math inline">\(I\)</span> is the proportion of the population that is currently infected with the virus, and <span class="math inline">\(R\)</span> is the proportion of the population that has recovered from the virus. The idea behind the model is that</p>
<ul>
<li>Susceptible people become infected by hanving interaction with the infected people. Hence, the rate of change of the susceptible people is proportional to the number of interactions that can occur between the <span class="math inline">\(S\)</span> and the <span class="math inline">\(I\)</span> populations.<br />
<span class="math display">\[ S&#39; = -\alpha SI \]</span></li>
<li>The infected population gains people from the interactions with the susceptible people, but at the same time, infected people recover at a predictable rate.
<span class="math display">\[ I&#39; = \alpha SI - \beta I \]</span></li>
<li>The people in the recovered class are then immune to the virus, so the recovered class <span class="math inline">\(R\)</span> only gains people from the recoveries from the <span class="math inline">\(I\)</span> class.
<span class="math display">\[ R&#39; = \beta I \]</span></li>
</ul>
<ol style="list-style-type: lower-alpha">
<li>Explain the minus sign in the <span class="math inline">\(S&#39;\)</span> equation in the context of the spread of a virus.</li>
<li>Explain the product <span class="math inline">\(SI\)</span> in the <span class="math inline">\(S&#39;\)</span> equation in the context of the spread of a virus.</li>
<li>Find a numerical solution to the system of equations using your <code>euler()</code> function. Use the parameters <span class="math inline">\(\alpha = 0.4\)</span> and <span class="math inline">\(\beta = 0.04\)</span> with initial conditions <span class="math inline">\(S(0) = 0.99\)</span>, <span class="math inline">\(I(0) = 0.01\)</span>, and <span class="math inline">\(R(0) = 0\)</span>. Explain all three curves in context.</li>
</ol>
</div>
<hr />
<div style="page-break-after: always;"></div>
</div>
<div id="the-midpoint-method" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> The Midpoint Method</h2>
<p>Now we get to improve upon Euler’s method. There is a long history of wonderful improvements to the classic Euler’s method – some that work in special cases, some that resolve areas where the error is going to be high, and some that are great for general purpose numerical solutions to ODEs with relatively high accuracy. In this section we’ll make a simple modification to Euler’s method that has a surprisingly great payoff in the error rate.</p>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-447" class="exercise"><strong>Exercise 5.23  </strong></span>In Euler’s method, if we are at the point <span class="math inline">\(t_n\)</span> then we approximate the slope <span class="math inline">\(x&#39;(t_n) = f(t_n,x_n)\)</span> and use the slope to propagate forward one time step. As you have seen, this method can lead to an overshooting of the exact solution in regions of high curvature. It would be nice to be able to look into the future and get a better approximation of the slope so that we didn’t miss upcoming curvature. If you could build such a method that looks in to the future, finds a slope in the future, and then uses that slope (instead of the slope from Euler’s method) to advance forward in time, how far into the future would you look? Why?
</div>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-448" class="exercise"><strong>Exercise 5.24  </strong></span>Let’s return to the simple differential equation <span class="math inline">\(x&#39; = -0.5x\)</span> with
<span class="math inline">\(x(0) = 6\)</span> that we saw in Exercise <a href="ch-odes.html#exr:euler-motivation">5.9</a>. Now we’ll propose a slightly different method for approximating the solution.</p>
<ol style="list-style-type: lower-alpha">
<li>At <span class="math inline">\(t=0\)</span> we know that <span class="math inline">\(x(0)=6\)</span>. If we use the slope at time <span class="math inline">\(t=0\)</span> to step forward in time then we will get the Euler approximation of the solution. Consider this alternative approach:</li>
</ol>
<ul>
<li>Use the slope at time <span class="math inline">\(t=0\)</span> and move <em>half</em> a step forward.</li>
<li>Find the slope at the half-way point</li>
<li>Then use the slope from the half way point to go a full step forward from time <span class="math inline">\(t=0\)</span>.</li>
</ul>
<p>Perhaps a bit confusing …let’s build this idea together:</p>
<ul>
<li>What is the slope at time <span class="math inline">\(t=0\)</span>? <span class="math inline">\(x&#39;(0) = \underline{\hspace{0.5in}}\)</span></li>
<li>Use this slope to step a half step forward and find the <span class="math inline">\(x\)</span> value: <span class="math inline">\(x(0.5) \approx \underline{\hspace{0.5in}}\)</span></li>
<li>Now use the differential equation to find the slope at time <span class="math inline">\(t=0.5\)</span>. <span class="math inline">\(x&#39;(0.5) = \underline{\hspace{0.5in}}\)</span></li>
<li>Now take your answer from the previous step, and go one full step forward from time <span class="math inline">\(t=0\)</span>. What <span class="math inline">\(x\)</span> value do you end up with?</li>
<li>Your answers to the previous bullets should be: <span class="math inline">\(x&#39;(0) = -3\)</span>, <span class="math inline">\(x(0.5) \approx 4.5\)</span>, <span class="math inline">\(x&#39;(0.5) = -2.25\)</span>, so if we take a full step forward with slope <span class="math inline">\(m=-2.25\)</span> starting from <span class="math inline">\(t=0\)</span> we get <span class="math inline">\(x(1) \approx 3.75\)</span>.</li>
</ul>
<ol start="2" style="list-style-type: lower-alpha">
<li>Repeat the process outlined in part (a) to approximate the solution to the differential equation at times <span class="math inline">\(t=2, 3, \ldots, 10\)</span>. Also record the exact answer at each of these times.</li>
</ol>
<table>
<thead>
<tr class="header">
<th><span class="math inline">\(t\)</span></th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>10</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Approximation of <span class="math inline">\(x(t)\)</span></td>
<td>6</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>Exact value of <span class="math inline">\(x(t)\)</span></td>
<td>6</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ol start="3" style="list-style-type: lower-alpha">
<li><p>Draw a clear picture of what this method is doing in order to approximate the slope at each individual step.</p></li>
<li><p>How does your approximation compare to the Euler approximation that you found in Exercise <a href="ch-odes.html#exr:euler-motivation">5.9</a>?</p></li>
</ol>
</div>
<hr />

<div class="definition">
<p><span id="def:midpoint" class="definition"><strong>Definition 5.5  (The Midpoint Method)  </strong></span>The midpoint method is defined by first taking a half step with Euler’s method to approximate a solution at time <span class="math inline">\(t_{n+1/2}\)</span> There is not grid point at <span class="math inline">\(t_{n+1/2}\)</span> so we define this as $ t_{n+1/2} = (t_n + t_{n+1})/2$. We then take a full step using the value of <span class="math inline">\(f\)</span> at <span class="math inline">\(t_{n+1/2}\)</span> and the approximate <span class="math inline">\(x_{n+1/2}\)</span>.
<span class="math display">\[\begin{aligned}
        x_{n+1/2} &amp;= x_n + \frac{h}{2} f(t_n,x_n) \\
        x_{n+1} &amp;= x_n + h f(t_{n+1/2},x_{n+1/2})
    \end{aligned}\]</span>
Note: Indexing by <span class="math inline">\(1/2\)</span> in a computer is nonsense. Instead, we implement the midpoint method with: <span class="math display">\[\begin{aligned}
        m_n &amp;= f(t_n,x_n) \\
        x_{temp} &amp;= x_n + \frac{h}{2} m_n \\
        x_{n+1} &amp;= x_n + h f\left( t_n + \frac{\Delta t}{2}, x_{temp}\right)
    \end{aligned}\]</span></p>
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-449" class="exercise"><strong>Exercise 5.25  </strong></span>Complete the code below to implement the midpoint method in one dimension.
</div>
<div class="sourceCode" id="cb126"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb126-1"><a href="ch-odes.html#cb126-1"></a><span class="kw">def</span> midpoint1d(f,x0,t0,tmax,dt):</span>
<span id="cb126-2"><a href="ch-odes.html#cb126-2"></a>    t <span class="op">=</span> <span class="co"># build the times</span></span>
<span id="cb126-3"><a href="ch-odes.html#cb126-3"></a>    x <span class="op">=</span> <span class="co"># build an array for the x values</span></span>
<span id="cb126-4"><a href="ch-odes.html#cb126-4"></a>    x[<span class="dv">0</span>] <span class="op">=</span> <span class="co"># build the initial condition</span></span>
<span id="cb126-5"><a href="ch-odes.html#cb126-5"></a>    <span class="co"># On the next line: be careful about how far you&#39;re looping</span></span>
<span id="cb126-6"><a href="ch-odes.html#cb126-6"></a>    <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>( ??? ): </span>
<span id="cb126-7"><a href="ch-odes.html#cb126-7"></a>        <span class="co"># The interesting part of the code goes here.</span></span>
<span id="cb126-8"><a href="ch-odes.html#cb126-8"></a>    <span class="cf">return</span> t, x</span></code></pre></div>
<p>Test your code on several differential equations where you know the solution (just to be sure that it is working).</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb127-1"><a href="ch-odes.html#cb127-1"></a>f <span class="op">=</span> <span class="kw">lambda</span> t, x: <span class="co"># your ODE right hand side goes here</span></span>
<span id="cb127-2"><a href="ch-odes.html#cb127-2"></a>x0 <span class="op">=</span> <span class="co"># initial condition</span></span>
<span id="cb127-3"><a href="ch-odes.html#cb127-3"></a>t0 <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb127-4"><a href="ch-odes.html#cb127-4"></a>tmax <span class="op">=</span> <span class="co"># ending time (up to you)</span></span>
<span id="cb127-5"><a href="ch-odes.html#cb127-5"></a>dt <span class="op">=</span> <span class="co"># pick something small</span></span>
<span id="cb127-6"><a href="ch-odes.html#cb127-6"></a>t, x <span class="op">=</span> midpoint1d( ??? , ??? , ??? , ??? , ??? )</span>
<span id="cb127-7"><a href="ch-odes.html#cb127-7"></a>plt.plot( ??? , ??? , ??? )</span>
<span id="cb127-8"><a href="ch-odes.html#cb127-8"></a>plt.grid()</span>
<span id="cb127-9"><a href="ch-odes.html#cb127-9"></a>plt.show()</span></code></pre></div>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-452" class="exercise"><strong>Exercise 5.26  </strong></span>The goal in building the midpoint method was to hopefully capture some of the upcoming curvature in the solution before we overshot it. Consider the differential equation <span class="math inline">\(x&#39; = -\frac{1}{3}x + \sin(t)\)</span> with initial condition <span class="math inline">\(x(0) = 1\)</span> on the domain <span class="math inline">\(t \in [0,4]\)</span>. First get a numerical solution with Euler’s method using <span class="math inline">\(\Delta t = 0.1\)</span>. Then get a numerical solution with the midpoint method using the same value for <span class="math inline">\(\Delta t\)</span>. Plot the two solutions on top of each other along with the exact solution
<span class="math display">\[ x(t) = \frac{1}{10} \left( 19e^{-t/3} + 3\sin(t) - 9\cos(t)  \right). \]</span>
What do you observe? What do you observe if you make <span class="math inline">\(\Delta t\)</span> a bit larger (like 0.2 or 0.3)? What do you observe if you make <span class="math inline">\(\Delta t\)</span> very very small (like 0.001 or 0.0001)?</p>
There are several key takeaways from this problem. Discuss.
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-453" class="exercise"><strong>Exercise 5.27  </strong></span>Repeat Exercise <a href="ch-odes.html#exr:ode-error-analysis">5.14</a> with the midpoint method. Compare your results to what you found with Euler’s method.
</div>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-454" class="exercise"><strong>Exercise 5.28  </strong></span>We have studied two methods thus far: Euler’s method and the Midpoint method. In Figure <a href="ch-odes.html#fig:Euler-Midpoint">5.4</a> we see a graphical depiction of how each method works on the differential equation <span class="math inline">\(y&#39; = y\)</span> with <span class="math inline">\(\Delta t = 1\)</span> and <span class="math inline">\(y(0) = 1\)</span>. The exact solution at <span class="math inline">\(t=1\)</span> is <span class="math inline">\(y(1) = e^1 \approx 2.718\)</span> and is shown in red in each figure. The methods can be summarized in the table below.</p>
Discuss what you observe as the pros and cons of each method based on the table and on the Figure.
</div>
<table>
<colgroup>
<col width="48%" />
<col width="51%" />
</colgroup>
<thead>
<tr class="header">
<th>Euler’s Method</th>
<th>Midpoint Method</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1. Get the slope at time <span class="math inline">\(t_n\)</span></td>
<td>1. Get the slope at time <span class="math inline">\(t_n\)</span></td>
</tr>
<tr class="even">
<td>2. Follow the slope for time <span class="math inline">\(\Delta t\)</span></td>
<td>2. Follow the slope for time <span class="math inline">\(\Delta t/2\)</span></td>
</tr>
<tr class="odd">
<td></td>
<td>3. Get the slope at the point <span class="math inline">\(t_n + \Delta t/2\)</span></td>
</tr>
<tr class="even">
<td></td>
<td>4. Follow the new slope from time <span class="math inline">\(t_n\)</span> for time <span class="math inline">\(\Delta t\)</span></td>
</tr>
</tbody>
</table>
<div class="figure" style="text-align: center"><span id="fig:Euler-Midpoint"></span>
<img src="images/Ch05_Midpoint.png" alt="Graphical depictions of two numerical methods: Euler (left) and Midpoint (right). The exact solution is shown in red." width="90%" />
<p class="caption">
Figure 5.4: Graphical depictions of two numerical methods: Euler (left) and Midpoint (right). The exact solution is shown in red.
</p>
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-455" class="exercise"><strong>Exercise 5.29  </strong></span>When might you want to use Euler’s method instead of the midpoint
method? When might you want to use the midpoint method instead of
Euler’s method?
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-456" class="exercise"><strong>Exercise 5.30  (Midpoint Method in Several Dimensions)  </strong></span>Modify your <code>euler()</code> code from Exercise <a href="ch-odes.html#exr:euler-multi-dimensional">5.17</a> so that you can use the midpoint method in as many dimensions as you like. You should only have to add one line of code and then be careful about the size of the arrays that are in play. Test your code on several problems. Compare and contrast what you see with your Euler solutions and with your Midpoint solutions.
</div>
<hr />
<div style="page-break-after: always;"></div>
</div>
<div id="the-runge-kutta-4-method" class="section level2" number="5.5">
<h2><span class="header-section-number">5.5</span> The Runge-Kutta 4 Method</h2>
<p>OK. Ready for some experimentation? We are going to build a few experiments that eventually lead us to a very powerful method for finding numerical solutions to first order differential equations.</p>

<div class="exercise">
<p><span id="exr:unnamed-chunk-457" class="exercise"><strong>Exercise 5.31  </strong></span>Let’s talk about the Midpoint Method for a moment. The geometric idea of the midpoint method is outlined in the bullets below. Draw a picture along with the bullets.</p>
<ul>
<li>You’re sitting at the point <span class="math inline">\((t_n,x_n)\)</span>.</li>
<li>The slope of the solution curve to the ODE where you’re standing is
<span class="math display">\[ \text{slope at the point $(t_n,x_n)$ is: } m_n = f(t_n,x_n) \]</span></li>
<li>You take a half a step forward using the slope where you’re standing. The new point, denoted <span class="math inline">\(x_{n+1/2}\)</span>, is given by
<span class="math display">\[ \text{location a half step forward is: } x_{n+1/2} = x_n + \frac{\Delta t}{2} m_n. \]</span></li>
<li>Now you’re standing at <span class="math inline">\((t_n + \frac{\Delta t}{2} , x_{n+1/2})\)</span> so there is a new slope here given by
<span class="math display">\[ \text{slope after a half of an Euler step is: } m_{n+1/2} = f(t_n+\Delta t/2,x_{n+1/2}). \]</span></li>
<li>Go back to the point <span class="math inline">\((t_n,x_n)\)</span> and step a full step forward using slope <span class="math inline">\(m_{n+1/2}\)</span>. Hence the new approximation is
<span class="math display">\[ x_{n+1} = x_n + \Delta t \cdot m_{n+1/2} \]</span></li>
</ul>
</div>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-458" class="exercise"><strong>Exercise 5.32  </strong></span>One of the troubles with the midpoint method is that it doesn’t actually use the information at the point <span class="math inline">\((t_n,x_n)\)</span>. Moreover, it doesn’t leverage a slope at the next time step <span class="math inline">\(t_{n+1}\)</span>. Let’s see what happens when we try a solution technique that combined the ideas of Euler and Midpoint as follows:</p>
<ul>
<li>The slope at the point <span class="math inline">\((t_n,x_n)\)</span> can be called <span class="math inline">\(m_n\)</span> and we find it by evaluating <span class="math inline">\(f(t_n,x_n)\)</span>.</li>
<li>The slope at the point <span class="math inline">\((t_{n+1/2}, x_{n+1/2})\)</span> can be called <span class="math inline">\(m_{n+1/2}\)</span> and we find it by evaluating <span class="math inline">\(f(t_{n+1/2}, x_{n+1/2})\)</span>.</li>
<li>We can now take a full step using slope <span class="math inline">\(m_{n+1/2}\)</span> to get the point <span class="math inline">\(x_{n+1}\)</span> and the slope there is <span class="math inline">\(m_{n+1} = f(t_{n+1}, x_{n+1})\)</span>.</li>
<li>Now we have three estimates of the slope that we can use to actually propagate forward from <span class="math inline">\((t_n,x_n)\)</span>:
<ul>
<li>We could just use <span class="math inline">\(m_n\)</span>. This is Euler’s method.</li>
<li>We could just use <span class="math inline">\(m_{n+1/2}\)</span>. This is the midpoint method.</li>
<li>We could use <span class="math inline">\(m_{n+1}\)</span>. Would this approach be any good?</li>
<li>We could use the average of the three slopes.</li>
<li>We could use a weighted average of the three slopes where some preference is given to some slopes over the others.</li>
</ul></li>
</ul>
In the code below you will find a function called <code>ode_test()</code> that you can use as a starting point to test our the last three ideas. After the function you will see several lines of code that test your method against the differential equation <span class="math inline">\(x&#39;(t) = -\frac{1}{3}x + \sin(t)\)</span> with <span class="math inline">\(x(0) = 1\)</span>. The plots that come out are our typical error plots with the step size on the horizontal axis and our maximum absolute error between the numerical solution and the exact solution on the vertical axis. Recall that the exact solution to this differential equation is
<span class="math display">\[ x(t) = \frac{1}{10} \left( 19 e^{-t/3} + 3\sin(t) - 9\cos(t) \right) \]</span>
</div>
<div class="sourceCode" id="cb128"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb128-1"><a href="ch-odes.html#cb128-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb128-2"><a href="ch-odes.html#cb128-2"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb128-3"><a href="ch-odes.html#cb128-3"></a></span>
<span id="cb128-4"><a href="ch-odes.html#cb128-4"></a><span class="co"># *********</span></span>
<span id="cb128-5"><a href="ch-odes.html#cb128-5"></a><span class="co"># You should copy your euler and midpoint functions here. </span></span>
<span id="cb128-6"><a href="ch-odes.html#cb128-6"></a><span class="co"># We will be comparing to these two existing methods.</span></span>
<span id="cb128-7"><a href="ch-odes.html#cb128-7"></a><span class="co"># *********</span></span>
<span id="cb128-8"><a href="ch-odes.html#cb128-8"></a></span>
<span id="cb128-9"><a href="ch-odes.html#cb128-9"></a><span class="kw">def</span> ode_test(f,x0,t0,tmax,dt):</span>
<span id="cb128-10"><a href="ch-odes.html#cb128-10"></a>    t <span class="op">=</span> np.arange(t0,tmax<span class="op">+</span>dt,dt) <span class="co"># set up the times</span></span>
<span id="cb128-11"><a href="ch-odes.html#cb128-11"></a>    x <span class="op">=</span> np.zeros(<span class="bu">len</span>(t)) <span class="co"># set up the x</span></span>
<span id="cb128-12"><a href="ch-odes.html#cb128-12"></a>    x[<span class="dv">0</span>] <span class="op">=</span> x0 <span class="co"># initial condition</span></span>
<span id="cb128-13"><a href="ch-odes.html#cb128-13"></a>    <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(t)<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb128-14"><a href="ch-odes.html#cb128-14"></a>        m_n <span class="op">=</span> f(t[n],x[n])</span>
<span id="cb128-15"><a href="ch-odes.html#cb128-15"></a>        x_n_plus_half <span class="op">=</span> x[n] <span class="op">+</span> (dt<span class="op">/</span><span class="dv">2</span>)<span class="op">*</span>m_n</span>
<span id="cb128-16"><a href="ch-odes.html#cb128-16"></a>        m_n_plus_half <span class="op">=</span> f( t[n]<span class="op">+</span>dt<span class="op">/</span><span class="dv">2</span> , x_n_plus_half )</span>
<span id="cb128-17"><a href="ch-odes.html#cb128-17"></a>        x_n_plus_1 <span class="op">=</span> x[n] <span class="op">+</span> dt <span class="op">*</span> m_n_plus_half</span>
<span id="cb128-18"><a href="ch-odes.html#cb128-18"></a>        m_n_plus_1 <span class="op">=</span> f(t[n]<span class="op">+</span>dt, x_n_plus_1 )</span>
<span id="cb128-19"><a href="ch-odes.html#cb128-19"></a>        estimate_of_slope <span class="op">=</span> <span class="co"># This is where you get to play</span></span>
<span id="cb128-20"><a href="ch-odes.html#cb128-20"></a>        x[n<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> x[n] <span class="op">+</span> dt <span class="op">*</span> estimate_of_slope</span>
<span id="cb128-21"><a href="ch-odes.html#cb128-21"></a>    <span class="cf">return</span> t, x</span>
<span id="cb128-22"><a href="ch-odes.html#cb128-22"></a></span>
<span id="cb128-23"><a href="ch-odes.html#cb128-23"></a></span>
<span id="cb128-24"><a href="ch-odes.html#cb128-24"></a>f <span class="op">=</span> <span class="kw">lambda</span> t, x: <span class="op">-</span>(<span class="dv">1</span><span class="op">/</span><span class="fl">3.0</span>)<span class="op">*</span>x <span class="op">+</span> np.sin(t)</span>
<span id="cb128-25"><a href="ch-odes.html#cb128-25"></a>exact <span class="op">=</span> <span class="kw">lambda</span> t: (<span class="dv">1</span><span class="op">/</span><span class="fl">10.0</span>)<span class="op">*</span>(<span class="dv">19</span><span class="op">*</span>np.exp(<span class="op">-</span>t<span class="op">/</span><span class="dv">3</span>) <span class="op">+</span> <span class="op">\</span></span>
<span id="cb128-26"><a href="ch-odes.html#cb128-26"></a>                  <span class="dv">3</span><span class="op">*</span>np.sin(t) <span class="op">-</span> <span class="op">\</span></span>
<span id="cb128-27"><a href="ch-odes.html#cb128-27"></a>                  <span class="dv">9</span><span class="op">*</span>np.cos(t))</span>
<span id="cb128-28"><a href="ch-odes.html#cb128-28"></a></span>
<span id="cb128-29"><a href="ch-odes.html#cb128-29"></a>x0 <span class="op">=</span> <span class="dv">1</span> <span class="co"># initial condition</span></span>
<span id="cb128-30"><a href="ch-odes.html#cb128-30"></a>t0 <span class="op">=</span> <span class="dv">0</span> <span class="co"># initial time</span></span>
<span id="cb128-31"><a href="ch-odes.html#cb128-31"></a>tmax <span class="op">=</span> <span class="dv">3</span> <span class="co"># max time</span></span>
<span id="cb128-32"><a href="ch-odes.html#cb128-32"></a><span class="co"># set up blank arrays to keep track of the maximum absolute errorrs</span></span>
<span id="cb128-33"><a href="ch-odes.html#cb128-33"></a>err_euler <span class="op">=</span> [] </span>
<span id="cb128-34"><a href="ch-odes.html#cb128-34"></a>err_midpoint <span class="op">=</span> []</span>
<span id="cb128-35"><a href="ch-odes.html#cb128-35"></a>err_ode_test <span class="op">=</span> []</span>
<span id="cb128-36"><a href="ch-odes.html#cb128-36"></a><span class="co"># Next give a list of Delta t values (what list did we give here)</span></span>
<span id="cb128-37"><a href="ch-odes.html#cb128-37"></a>H <span class="op">=</span> <span class="fl">10.0</span><span class="op">**</span>(<span class="op">-</span>np.arange(<span class="dv">1</span>,<span class="dv">7</span>,<span class="dv">1</span>)) </span>
<span id="cb128-38"><a href="ch-odes.html#cb128-38"></a><span class="cf">for</span> dt <span class="kw">in</span> H:</span>
<span id="cb128-39"><a href="ch-odes.html#cb128-39"></a>    <span class="co"># Build an euler approximation</span></span>
<span id="cb128-40"><a href="ch-odes.html#cb128-40"></a>    t, xeuler <span class="op">=</span> euler(f,x0,t0,tmax,dt) </span>
<span id="cb128-41"><a href="ch-odes.html#cb128-41"></a>    <span class="co"># Measure the max abs error</span></span>
<span id="cb128-42"><a href="ch-odes.html#cb128-42"></a>    err_euler.append( np.<span class="bu">max</span>( np.<span class="bu">abs</span>( xeuler <span class="op">-</span> exact(t) ) ) ) </span>
<span id="cb128-43"><a href="ch-odes.html#cb128-43"></a>    <span class="co"># Build a midpoint approximation</span></span>
<span id="cb128-44"><a href="ch-odes.html#cb128-44"></a>    t, xmidpoint <span class="op">=</span> midpoint(f,x0,t0,tmax,dt) </span>
<span id="cb128-45"><a href="ch-odes.html#cb128-45"></a>    <span class="co"># Measure the max abs error</span></span>
<span id="cb128-46"><a href="ch-odes.html#cb128-46"></a>    err_midpoint.append( np.<span class="bu">max</span>( np.<span class="bu">abs</span>( xmidpoint <span class="op">-</span> exact(t) ) ) ) </span>
<span id="cb128-47"><a href="ch-odes.html#cb128-47"></a>    <span class="co"># Build your new approximation</span></span>
<span id="cb128-48"><a href="ch-odes.html#cb128-48"></a>    t, xtest <span class="op">=</span> ode_test(f,x0,t0,tmax,dt) </span>
<span id="cb128-49"><a href="ch-odes.html#cb128-49"></a>    <span class="co"># Measure the max abs error</span></span>
<span id="cb128-50"><a href="ch-odes.html#cb128-50"></a>    err_ode_test.append( np.<span class="bu">max</span>( np.<span class="bu">abs</span>( xtest <span class="op">-</span> exact(t) ) ) ) </span>
<span id="cb128-51"><a href="ch-odes.html#cb128-51"></a></span>
<span id="cb128-52"><a href="ch-odes.html#cb128-52"></a><span class="co"># Finally, we make a loglog plot of the errors.  </span></span>
<span id="cb128-53"><a href="ch-odes.html#cb128-53"></a><span class="co"># Keep an eye on the slopes since they tell you the order of </span></span>
<span id="cb128-54"><a href="ch-odes.html#cb128-54"></a><span class="co"># the error for the method.</span></span>
<span id="cb128-55"><a href="ch-odes.html#cb128-55"></a>plt.loglog(H,err_euler,<span class="st">&#39;r*-&#39;</span>,</span>
<span id="cb128-56"><a href="ch-odes.html#cb128-56"></a>           H,err_midpoint,<span class="st">&#39;b*-&#39;</span>,</span>
<span id="cb128-57"><a href="ch-odes.html#cb128-57"></a>           H,err_ode_test,<span class="st">&#39;k*-&#39;</span>)</span>
<span id="cb128-58"><a href="ch-odes.html#cb128-58"></a>plt.grid()</span>
<span id="cb128-59"><a href="ch-odes.html#cb128-59"></a>plt.legend([<span class="st">&#39;euler&#39;</span>,<span class="st">&#39;midpoint&#39;</span>,<span class="st">&#39;test method&#39;</span>])</span>
<span id="cb128-60"><a href="ch-odes.html#cb128-60"></a>plt.show()</span></code></pre></div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-460" class="exercise"><strong>Exercise 5.33  </strong></span>In the previous exercise you should have found that an average of the three slopes did just a <em>little bit</em> better than the midpoint method but the order of the error (the slope in the loglog plot) stayed about the same. You should have also found that the weighted average
<span class="math display">\[ \text{estimate of slope} = \frac{m_n + 2m_{n+1/2} + m_{n+1}}{4} \]</span>
did just a little bit better than just a plain average. Why might this be? (If you haven’t tried this weighted average then go back and try it.) Do other weighted averages of this sort work better or worse? Does it appear that we can improve upon the order of the error (the slope in the loglog plot) using any of these methods?
</div>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-461" class="exercise"><strong>Exercise 5.34  </strong></span>OK. Let’s make one more modification. What if we built a fourth slope that resulted from stepping a half step forward using <span class="math inline">\(m_{n+1/2}\)</span>? We’ll call this <span class="math inline">\(m_{n+1/2}^*\)</span> since it is a new estimate of <span class="math inline">\(m_{n+1/2}\)</span>.
<span class="math display">\[ x_{n+1/2}^* = x_n + \frac{\Delta t}{2} m_{n+1/2} \]</span>
<span class="math display">\[ m_{n+1/2}^* = f(t_n + \Delta t/2, x_{n+1/2}^*) \]</span>
Then calculate <span class="math inline">\(m_{n+1}\)</span> using this new slope instead of what we did in the previous problem.</p>
<ol style="list-style-type: lower-alpha">
<li>Draw a picture showing where this slope was calculated.</li>
<li>Modify the code from above to include this fourth slope.<br />
</li>
<li>Experiment with several ideas about how to best combine the four slopes: <span class="math inline">\(m_n\)</span>, <span class="math inline">\(m_{n+1/2}\)</span>, <span class="math inline">\(m_{n+1/2}^*\)</span>, and <span class="math inline">\(m_{n+1}\)</span>.
<ul>
<li>Should we just take an average of the four slopes?</li>
<li>Should we give one or more of the slopes preferential treatment and do some sort of weighted average?</li>
<li>Should we do something else entirely?</li>
</ul></li>
</ol>
Remember that we are looking to improve the slope in the loglog plot since that indicates an improvement in the order of the error (the accuracy) of the method.
</div>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-462" class="exercise"><strong>Exercise 5.35  </strong></span>In the previous exercise you no doubt experimented with many different linear combinations of <span class="math inline">\(m_n\)</span>, <span class="math inline">\(m_{n+1/2}\)</span>, <span class="math inline">\(m_{n+1/2}^*\)</span>, and <span class="math inline">\(m_n\)</span>. Many of the resulting numerical ODE methods likely had the same order of accuracy (again, the order of the method is the slope in the error plot), but some may have been much better or much worse. Work with your team to fill in the following summary table of all of the methods that you devised. If you generated linear combinations that are not listed below then just add them to the list (we’ve only listed the most common ones here).</p>
<table>
<thead>
<tr class="header">
<th></th>
<th><span class="math inline">\(m_n\)</span></th>
<th><span class="math inline">\(m_{n+1/2}\)</span></th>
<th><span class="math inline">\(m_{n+1/2}^*\)</span></th>
<th><span class="math inline">\(m_n\)</span></th>
<th>Order of Error</th>
<th>Name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td><span class="math inline">\(\mathcal{O}(\Delta t)\)</span></td>
<td>Euler’s Method</td>
</tr>
<tr class="even">
<td>2</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td><span class="math inline">\(\mathcal{O}(\Delta t^2)\)</span></td>
<td>Midpoint Method</td>
</tr>
<tr class="odd">
<td>3</td>
<td>1/2</td>
<td>1/2</td>
<td>0</td>
<td>0</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>4</td>
<td>1/3</td>
<td>1/3</td>
<td>0</td>
<td>1/3</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>5</td>
<td>1/4</td>
<td>2/4</td>
<td>0</td>
<td>1/4</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>6</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>7</td>
<td>0</td>
<td>1/2</td>
<td>1/2</td>
<td>0</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>8</td>
<td>1/3</td>
<td>1/3</td>
<td>1/3</td>
<td>0</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>9</td>
<td>1/4</td>
<td>1/4</td>
<td>1/4</td>
<td>1/4</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>10</td>
<td>1/5</td>
<td>2/5</td>
<td>1/5</td>
<td>1/5</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>11</td>
<td>1/5</td>
<td>1/5</td>
<td>2/5</td>
<td>1/5</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>12</td>
<td>1/6</td>
<td>2/6</td>
<td>2/6</td>
<td>1/6</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>13</td>
<td>1/6</td>
<td>3/6</td>
<td>1/6</td>
<td>1/6</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>14</td>
<td>1/6</td>
<td>1/6</td>
<td>3/6</td>
<td>1/6</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>15</td>
<td>1/7</td>
<td>2/7</td>
<td>3/7</td>
<td>1/7</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>16</td>
<td>1/8</td>
<td>3/8</td>
<td>3/8</td>
<td>1/8</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>17</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>18</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-463" class="exercise"><strong>Exercise 5.36  </strong></span>In the previous exercise you should have found at least one of the many methods to be far superior to the others. State which linear combination of slopes seems to have done the trick, draw a picture of what this method does to numerically approximate the next slope for a numerical solution to an ODE, and clearly state what the order of the error means about this method.
</div>
<hr />

<div class="theorem">
<span id="thm:rk4" class="theorem"><strong>Theorem 5.3  (The Runge-Kutta 4 Method)  </strong></span>The Runge-Kutta 4 (RK4) method for approximating the solution to the differential equation <span class="math inline">\(x&#39; = f(t,x)\)</span> approximates the slope at the point <span class="math inline">\(t_n\)</span> by using the following weighted sum:
<span class="math display">\[ \text{estimated slope } = \frac{m_n + 2 m_{n+1/2} + 2 m_{n+1/2}^* + m_n}{6}. \]</span>
The order of the error in the RK4 method is <span class="math inline">\(\mathcal{O}(\Delta t^4)\)</span>.
</div>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-464" class="exercise"><strong>Exercise 5.37  </strong></span>In Theorem <a href="ch-odes.html#thm:rk4">5.3</a> we state the Runge-Kutta 4 method in terms of the estimates of the slope built up previously in this section. The notation that is commonly used in most numerical analysis sources is slightly different. Typically, the RK4 method is presented as follows:
<span class="math display">\[\begin{aligned} 
        k_1 &amp;= f(t_n, x_n) \\
        k_2 &amp;= f(t_n + \frac{h}{2}, x_n + \frac{h}{2} k_1) \\
        k_3 &amp;= f(t_n + \frac{h}{2}, x_n + \frac{h}{2} k_2) \\
        k_4 &amp;= f(t_n + h, x_n + h k_3) \\
        x_{n+1} &amp;= x_n + \frac{h}{6} \left( k_1 + 2 k_2 + 2 k_3 + k_4 \right)
\end{aligned}\]</span></p>
<ol style="list-style-type: lower-alpha">
<li>Show that indeed we have derived the same exact algorithm.<br />
</li>
<li>What is the advantage to posing the RK4 method in this way?</li>
<li>How many evaluations of the function <span class="math inline">\(f(t,x)\)</span> do we need to make at every time step of the RK4 method? Compare this Euler’s method and the midpoint method. Why is this important?</li>
</ol>
</div>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-465" class="exercise"><strong>Exercise 5.38  </strong></span>Jackson wants to solve the differential equation <span class="math inline">\(x&#39; = f(t,x)\)</span> on the domain <span class="math inline">\(t \in [0,1]\)</span> so that the maximum absolute error is less than <span class="math inline">\(10^{-8}\)</span>.</p>
<ol style="list-style-type: lower-alpha">
<li>What value of <span class="math inline">\(\Delta t\)</span> would Jackson need if he were using Euler’s method? How many function evaluations would Jackson’s Euler algorithm end up doing in order to achieve his desired level of accuracy.</li>
<li>What value of <span class="math inline">\(\Delta t\)</span> would Jackson need if he were using the midpoint method? How many function evaluations would Jackson’s midpoint algorithm end up doing in order to achieve his desired level of accuracy.</li>
<li>What value of <span class="math inline">\(\Delta t\)</span> would Jackson need if he were using the RK4 method? How many function evaluations would Jackson’s RK4 algorithm end up doing in order to achieve his desired level of accuracy.</li>
<li>Discuss the implications of what you found in parts (a) - (c) of this problem.</li>
</ol>
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-466" class="exercise"><strong>Exercise 5.39  </strong></span>It would nice, but it would be completely impractical, to have a numerical method compute the approximate solution so that the maximum absolute error is less than machine precision <span class="math inline">\(10^{-16}\)</span>. That is an impracticality since we can’t actually detect errors that small on a computer using double precision arithmetic. However, what if we wanted accuracy of <span class="math inline">\(10^{-15}\)</span> instead? Repeat the previous exercise with <span class="math inline">\(10^{-15}\)</span> as the goal for the maximum absolute error.
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-467" class="exercise"><strong>Exercise 5.40  </strong></span>Let’s step back for a second and just see what the RK4 method does from a nuts-and-bolts point of view. Consider the differential equation <span class="math inline">\(x&#39; = x\)</span> with initial condition <span class="math inline">\(x(0) = 1\)</span>. The solution to this differential equation is clearly <span class="math inline">\(x(t) = e^t\)</span>. For the same of simplicity, take <span class="math inline">\(\Delta t = 1\)</span> and perform 1 step of the RK4 method BY HAND to approximate the value <span class="math inline">\(x(1)\)</span>.
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-468" class="exercise"><strong>Exercise 5.41  </strong></span>Write a Python function that implements the Runge-Kutta 4 method in one dimension. Test the problem on several differential equations where you know the solution.
</div>
<div class="sourceCode" id="cb129"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb129-1"><a href="ch-odes.html#cb129-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb129-2"><a href="ch-odes.html#cb129-2"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb129-3"><a href="ch-odes.html#cb129-3"></a></span>
<span id="cb129-4"><a href="ch-odes.html#cb129-4"></a><span class="kw">def</span> rk41d(f,x0,t0,tmax,dt):</span>
<span id="cb129-5"><a href="ch-odes.html#cb129-5"></a>    t <span class="op">=</span> np.arange(t0,tmax<span class="op">+</span>dt,dt)</span>
<span id="cb129-6"><a href="ch-odes.html#cb129-6"></a>    x <span class="op">=</span> np.zeros_like(t)</span>
<span id="cb129-7"><a href="ch-odes.html#cb129-7"></a>    x[<span class="dv">0</span>] <span class="op">=</span> x0</span>
<span id="cb129-8"><a href="ch-odes.html#cb129-8"></a>    <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(t)<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb129-9"><a href="ch-odes.html#cb129-9"></a>        <span class="co"># the interesting bits of the code go here</span></span>
<span id="cb129-10"><a href="ch-odes.html#cb129-10"></a>    <span class="cf">return</span> t, x</span>
<span id="cb129-11"><a href="ch-odes.html#cb129-11"></a></span>
<span id="cb129-12"><a href="ch-odes.html#cb129-12"></a>f <span class="op">=</span> <span class="kw">lambda</span> t, x: <span class="op">-</span>(<span class="dv">1</span><span class="op">/</span><span class="fl">3.0</span>)<span class="op">*</span>x <span class="op">+</span> np.sin(t)</span>
<span id="cb129-13"><a href="ch-odes.html#cb129-13"></a>x0 <span class="op">=</span> <span class="co"># initial condition</span></span>
<span id="cb129-14"><a href="ch-odes.html#cb129-14"></a>t0 <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb129-15"><a href="ch-odes.html#cb129-15"></a>tmax <span class="op">=</span> <span class="co"># your choice</span></span>
<span id="cb129-16"><a href="ch-odes.html#cb129-16"></a>dt <span class="op">=</span> <span class="co"># pick something reasonable</span></span>
<span id="cb129-17"><a href="ch-odes.html#cb129-17"></a>t, x <span class="op">=</span> rk41d(f,x0,t0,tmax,dt)</span>
<span id="cb129-18"><a href="ch-odes.html#cb129-18"></a>plt.plot(t,x,<span class="st">&#39;b.-&#39;</span>)</span>
<span id="cb129-19"><a href="ch-odes.html#cb129-19"></a>plt.grid()</span>
<span id="cb129-20"><a href="ch-odes.html#cb129-20"></a>plt.show()</span></code></pre></div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-470" class="exercise"><strong>Exercise 5.42  (RK4 in Several Dimensions)  </strong></span>Modify your Runge-Kutta 4 code to work for any number of dimensions. You may want to start from your <code>euler()</code> and <code>midpoint()</code> functions that already do this. You’ll only need to make minor modifications from there. Then test your new generalized RK4 method on all of the same problems which you used to test your <code>euler()</code> and <code>midpoint()</code> functions.
</div>
<hr />
<div style="page-break-after: always;"></div>
</div>
<div id="animating-ode-solutions" class="section level2" number="5.6">
<h2><span class="header-section-number">5.6</span> Animating ODE Solutions</h2>
<p>Differential equations that depend on time are often best visualized when they are animated. This can also be said about any parameterized function, but in this present case we will focus on visualizing differential equations. There are several animation tools with python and we’ll demonstrate only two primary technique here:</p>
<ul>
<li><code>ipywidgets.interactive</code> is a tool that will produce an image with sliders that can be used to manually control an animation. The big advantage to <code>ipywidgets.iteractive</code> is that you can animate over several parameters, and hence use this tool as a playground for learning how parameters interact with each other.</li>
<li><code>matplotlib.animation</code> is a tool built directly into <code>matplotlib</code> that gives a playable animation (like a small movie). In this sort of animation we can only animate over one parameter or variable (like time), but this is most like what we would expect when animating a function that changes over time.</li>
</ul>
<p>The reader should take careful note that the tools described here are meant to be used in Google Colab. These tools may not work as expected in other instances of Python and you may have to do some playing around (and Googling) to get it to work properly on your Python installation. Moreover, the animations are not built directly into the book since this book is delivered in several formats (HTML, PDF, and print). Instead you will find links to Google Colab documents that have the contain the code and animations.</p>
<div id="ipywidgets.interactive" class="section level3" number="5.6.1">
<h3><span class="header-section-number">5.6.1</span> <code>ipywidgets.interactive</code></h3>
<p>Consider the differential equation <span class="math inline">\(x&#39; = f(t,x)\)</span> with <span class="math inline">\(x(0) = x_0\)</span>. We would like to build an animation of the numerical solution to this differential equation over the parameters <span class="math inline">\(t\)</span> but also over <span class="math inline">\(x_0\)</span> and <span class="math inline">\(\Delta t\)</span>. The following blocks of python code walk through this animation.</p>
<hr />

<div class="example">
<p><span id="exm:unnamed-chunk-471" class="example"><strong>Example 5.2  (ipywidgets.interactive)  </strong></span>Let’s say that we want to control the numerical solution to the differential equation <span class="math inline">\(x&#39; = -\frac{1}{3}x + \sin(t)\)</span> by manually altering the values of <span class="math inline">\(x(0) = x_0\)</span>, <span class="math inline">\(t_{max}\)</span>, and <span class="math inline">\(\Delta t\)</span>. In this case we will solve the differential equation using Euler’s method but note that our code could be easily modified to use other solvers.</p>
First we import all of the appropriate libraries. Of particular interest is the <code>ipywidgets.interactive</code> library. This allows for images to be interactive with the use of sliders. Moving the sliders will provide a nice way to animate a plot manually.
</div>
<div class="sourceCode" id="cb130"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb130-1"><a href="ch-odes.html#cb130-1"></a><span class="im">from</span> ipywidgets <span class="im">import</span> interactive</span>
<span id="cb130-2"><a href="ch-odes.html#cb130-2"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb130-3"><a href="ch-odes.html#cb130-3"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code></pre></div>
<p>In the next block of code we define our <code>euler()</code> solver. This particular step is only included because we are using Euler’s method to solve this specific problem. In general, include an functions or code that are going to be used to produce the data that you will be plotting. We will also introduce the function <code>f</code> and the parameter <code>t0</code> since we will not be animating over these parameters.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb131-1"><a href="ch-odes.html#cb131-1"></a><span class="kw">def</span> euler(f,x0,t0,tmax,dt):</span>
<span id="cb131-2"><a href="ch-odes.html#cb131-2"></a>  N <span class="op">=</span> <span class="bu">int</span>(np.floor((tmax<span class="op">-</span>t0)<span class="op">/</span>dt)<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb131-3"><a href="ch-odes.html#cb131-3"></a>  t <span class="op">=</span> np.linspace(t0,tmax,N<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb131-4"><a href="ch-odes.html#cb131-4"></a>  x <span class="op">=</span> np.zeros_like(t)</span>
<span id="cb131-5"><a href="ch-odes.html#cb131-5"></a>  x[<span class="dv">0</span>] <span class="op">=</span> x0</span>
<span id="cb131-6"><a href="ch-odes.html#cb131-6"></a>  <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(t)<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb131-7"><a href="ch-odes.html#cb131-7"></a>    x[n<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> x[n] <span class="op">+</span> dt<span class="op">*</span>f(t[n],x[n])</span>
<span id="cb131-8"><a href="ch-odes.html#cb131-8"></a>  <span class="cf">return</span> t, x</span>
<span id="cb131-9"><a href="ch-odes.html#cb131-9"></a></span>
<span id="cb131-10"><a href="ch-odes.html#cb131-10"></a>f <span class="op">=</span> <span class="kw">lambda</span> t, x: <span class="op">-</span>(<span class="dv">1</span><span class="op">/</span><span class="fl">3.0</span>)<span class="op">*</span>x <span class="op">+</span> np.sin(t)</span>
<span id="cb131-11"><a href="ch-odes.html#cb131-11"></a>t0 <span class="op">=</span> <span class="dv">0</span></span></code></pre></div>
<p>Next we build a function that accepts only the parameters that we want to animate over and produces only a plot. This function will be called later by the <code>ipywidgets.interactive</code> function every time we change one of the parameters so be sure that this is a clean and fast function to evaluate (keep the code simple).</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb132-1"><a href="ch-odes.html#cb132-1"></a><span class="kw">def</span> eulerAnimator(x0,tmax,dt):</span>
<span id="cb132-2"><a href="ch-odes.html#cb132-2"></a>    <span class="co"># call on the euler function to build the solution</span></span>
<span id="cb132-3"><a href="ch-odes.html#cb132-3"></a>    t, x <span class="op">=</span> euler(f,x0,t0,tmax,dt) </span>
<span id="cb132-4"><a href="ch-odes.html#cb132-4"></a>    plt.plot(t, x, <span class="st">&#39;b-&#39;</span>) <span class="co"># plot the solution</span></span>
<span id="cb132-5"><a href="ch-odes.html#cb132-5"></a>    plt.xlim(<span class="dv">0</span>,<span class="dv">30</span>)</span>
<span id="cb132-6"><a href="ch-odes.html#cb132-6"></a>    plt.ylim( np.<span class="bu">min</span>(x)<span class="op">-</span><span class="dv">1</span>, np.<span class="bu">max</span>(x)<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb132-7"><a href="ch-odes.html#cb132-7"></a>    plt.grid()</span>
<span id="cb132-8"><a href="ch-odes.html#cb132-8"></a>    plt.show() </span></code></pre></div>
<p>Now that we have everything set up we need to call on the <code>ipywidgets.interactive</code> command to turn the graphic into a visualization which can be controlled by sliders. In the code below we are allowing the initial condition to range between <span class="math inline">\(x_0 = -2\)</span> and <span class="math inline">\(x_0 = 5\)</span> in steps of <span class="math inline">\(0.5\)</span>, the time to range from <span class="math inline">\(t_{max}=1\)</span> to <span class="math inline">\(t_{max}=30\)</span> in steps of <span class="math inline">\(0.1\)</span>, and the time step to range from <span class="math inline">\(\Delta t = 0.01\)</span> to <span class="math inline">\(\Delta t = 0.75\)</span> in steps of <span class="math inline">\(0.005\)</span>.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb133-1"><a href="ch-odes.html#cb133-1"></a>interactive_plot <span class="op">=</span> interactive(eulerAnimator, </span>
<span id="cb133-2"><a href="ch-odes.html#cb133-2"></a>                               x0<span class="op">=</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">5</span>, <span class="fl">0.5</span>), </span>
<span id="cb133-3"><a href="ch-odes.html#cb133-3"></a>                               tmax<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">30</span>, <span class="fl">0.1</span>), </span>
<span id="cb133-4"><a href="ch-odes.html#cb133-4"></a>                               dt<span class="op">=</span>(<span class="fl">0.01</span>, <span class="fl">0.75</span>, <span class="fl">0.005</span>))</span>
<span id="cb133-5"><a href="ch-odes.html#cb133-5"></a>interactive_plot</span></code></pre></div>
<p>A static snapshot of the animation applet is shown in Figure <a href="ch-odes.html#fig:animation-snapshot">5.5</a>. When you build this animation you will have control over all three parameters. Like we mentioned before, this sort of animation can be a great playground for building insight into the interplay between parameters.</p>
<div class="figure" style="text-align: center"><span id="fig:animation-snapshot"></span>
<img src="images/Ch05_widgetsnapshot.png" alt="Snapshot of the ODE animation applet with ipywidgets." width="55%" />
<p class="caption">
Figure 5.5: Snapshot of the ODE animation applet with ipywidgets.
</p>
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-476" class="exercise"><strong>Exercise 5.43  </strong></span>Modify the previous exercise to use a different numerical solver (e.g. the midpoint method) instead of Euler’s method.
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-477" class="exercise"><strong>Exercise 5.44  </strong></span>Modify the animation routine above to simultaneously show the Euler, Midpoint, and RK4 solutions to a differential equation on top of each other. Animate over different values of <span class="math inline">\(\Delta t\)</span> for fixed values of <span class="math inline">\(x_0\)</span> and <span class="math inline">\(t_{max}\)</span>.
</div>
<hr />
</div>
<div id="matplotlib.animation" class="section level3" number="5.6.2">
<h3><span class="header-section-number">5.6.2</span> <code>matplotlib.animation</code></h3>
<p>The next animation package that we discuss is the <code>matplotlib.animation</code> package. This particular package is very similar to <code>ipywidgets.interactive</code>, but results only in a playable movie that is embedded within the Google Colab environment.</p>
<hr />

<div class="exercise">
<p><span id="exr:mplanimation" class="exercise"><strong>Exercise 5.45  </strong></span>Again we will consider the differential equation <span class="math inline">\(x&#39; = -\frac{1}{3}x + \sin(t)\)</span> but this time we will only be interested in an animation over time.</p>
We start the code by importing all of the necessary libraries. Take note that we import the <code>matplotlib.animation</code> and <code>matplotlib.rc</code> libraries in order to build the animation. We then import the <code>IPython.display.HTML</code> library to take care of embedding the player into the Google Colab environment.
</div>
<div class="sourceCode" id="cb134"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb134-1"><a href="ch-odes.html#cb134-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb134-2"><a href="ch-odes.html#cb134-2"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb134-3"><a href="ch-odes.html#cb134-3"></a><span class="im">from</span> matplotlib <span class="im">import</span> animation, rc</span>
<span id="cb134-4"><a href="ch-odes.html#cb134-4"></a><span class="im">from</span> IPython.display <span class="im">import</span> HTML</span></code></pre></div>
<p>Next we write all of the code necessary to build an Euler solution for the differential equation. Take note, of course, that much of this code is specific only to this problem and what we really need here is code that produces data for the animation.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb135-1"><a href="ch-odes.html#cb135-1"></a><span class="kw">def</span> euler(f,x0,t0,tmax,dt): <span class="co"># this is the Euler function</span></span>
<span id="cb135-2"><a href="ch-odes.html#cb135-2"></a>  N <span class="op">=</span> <span class="bu">int</span>(np.floor((tmax<span class="op">-</span>t0)<span class="op">/</span>dt)<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb135-3"><a href="ch-odes.html#cb135-3"></a>  t <span class="op">=</span> np.linspace(t0,tmax,N<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb135-4"><a href="ch-odes.html#cb135-4"></a>  x <span class="op">=</span> np.zeros_like(t)</span>
<span id="cb135-5"><a href="ch-odes.html#cb135-5"></a>  x[<span class="dv">0</span>] <span class="op">=</span> x0</span>
<span id="cb135-6"><a href="ch-odes.html#cb135-6"></a>  <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(t)<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb135-7"><a href="ch-odes.html#cb135-7"></a>    x[n<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> x[n] <span class="op">+</span> dt<span class="op">*</span>f(t[n],x[n])</span>
<span id="cb135-8"><a href="ch-odes.html#cb135-8"></a>  <span class="cf">return</span> t, x</span>
<span id="cb135-9"><a href="ch-odes.html#cb135-9"></a></span>
<span id="cb135-10"><a href="ch-odes.html#cb135-10"></a><span class="co"># Now we define the parameters for the Euler function</span></span>
<span id="cb135-11"><a href="ch-odes.html#cb135-11"></a>dt <span class="op">=</span> <span class="fl">1e-2</span></span>
<span id="cb135-12"><a href="ch-odes.html#cb135-12"></a>x0 <span class="op">=</span> <span class="dv">3</span> <span class="co"># initial condition</span></span>
<span id="cb135-13"><a href="ch-odes.html#cb135-13"></a>t0 <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb135-14"><a href="ch-odes.html#cb135-14"></a>tmax <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb135-15"><a href="ch-odes.html#cb135-15"></a>f <span class="op">=</span> <span class="kw">lambda</span> t, x: <span class="op">-</span>(<span class="dv">1</span><span class="op">/</span><span class="fl">3.0</span>)<span class="op">*</span>x <span class="op">+</span> np.sin(t)</span>
<span id="cb135-16"><a href="ch-odes.html#cb135-16"></a></span>
<span id="cb135-17"><a href="ch-odes.html#cb135-17"></a><span class="co"># Next we get the full Euler solution associate with these </span></span>
<span id="cb135-18"><a href="ch-odes.html#cb135-18"></a><span class="co"># parameters.  Be careful that you put this outside your </span></span>
<span id="cb135-19"><a href="ch-odes.html#cb135-19"></a><span class="co"># animation loop so that you don&#39;t build this over and over.</span></span>
<span id="cb135-20"><a href="ch-odes.html#cb135-20"></a>t, x <span class="op">=</span> euler(f,x0,t0,tmax,dt) </span></code></pre></div>
<p>Next we have to set up the figure that we are going to animate. This involves:</p>
<ul>
<li>setting up the axes,</li>
<li>building any features onto the axes that we want (e.g. a grid, axis labels, axis limits, etc)</li>
<li>and then we build a variable that we call <code>frame</code>.
<ul>
<li>The variable <code>frame</code> contains a blank plot with no data.<br />
</li>
<li>Notice that we define the line and marker styles here.</li>
<li>Also notice the comma in the definition of the <code>frame</code> variable. This is here since there are several Python objects inside <code>ax.plot()</code> and we only want to unpack the first one into <code>frame</code>.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb136"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb136-1"><a href="ch-odes.html#cb136-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb136-2"><a href="ch-odes.html#cb136-2"></a>plt.close()</span>
<span id="cb136-3"><a href="ch-odes.html#cb136-3"></a><span class="co"># Below we set up many of the global parameters for the plot.</span></span>
<span id="cb136-4"><a href="ch-odes.html#cb136-4"></a><span class="co"># Much of what we do here depends on what we are trying to animate.</span></span>
<span id="cb136-5"><a href="ch-odes.html#cb136-5"></a>ax.grid()</span>
<span id="cb136-6"><a href="ch-odes.html#cb136-6"></a>ax.set_xlabel(<span class="st">&#39;Time&#39;</span>)</span>
<span id="cb136-7"><a href="ch-odes.html#cb136-7"></a>ax.set_ylabel(<span class="st">&#39;Approximate Solution&#39;</span>)</span>
<span id="cb136-8"><a href="ch-odes.html#cb136-8"></a>ax.set_xlim(( t0, tmax)) </span>
<span id="cb136-9"><a href="ch-odes.html#cb136-9"></a>ax.set_ylim((np.<span class="bu">min</span>(x)<span class="op">-</span><span class="fl">0.5</span>, np.<span class="bu">max</span>(x)<span class="op">+</span><span class="fl">0.5</span>)) </span>
<span id="cb136-10"><a href="ch-odes.html#cb136-10"></a>frame, <span class="op">=</span> ax.plot([], [], linewidth<span class="op">=</span><span class="dv">2</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>) </span>
<span id="cb136-11"><a href="ch-odes.html#cb136-11"></a><span class="co"># notice we also set line and marker parameters here</span></span></code></pre></div>
<p>Now we build a function that accepts only the animation frame number, <code>N</code>, and adds appropriate elements to the plot defined by <code>frame</code>.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb137-1"><a href="ch-odes.html#cb137-1"></a><span class="kw">def</span> animator(N): <span class="co"># N is the animation frame number</span></span>
<span id="cb137-2"><a href="ch-odes.html#cb137-2"></a>  T <span class="op">=</span> t[:N] <span class="co"># get t data up to the frame number</span></span>
<span id="cb137-3"><a href="ch-odes.html#cb137-3"></a>  X <span class="op">=</span> x[:N] <span class="co"># get x data up to the frame number</span></span>
<span id="cb137-4"><a href="ch-odes.html#cb137-4"></a>  <span class="co"># display the current simulation time in the title</span></span>
<span id="cb137-5"><a href="ch-odes.html#cb137-5"></a>  ax.set_title(<span class="st">&#39;Time=&#39;</span><span class="op">+</span>t[N]) </span>
<span id="cb137-6"><a href="ch-odes.html#cb137-6"></a>  <span class="co"># put the data for the current frame into the varable &quot;frame&quot;</span></span>
<span id="cb137-7"><a href="ch-odes.html#cb137-7"></a>  frame(T,X) </span>
<span id="cb137-8"><a href="ch-odes.html#cb137-8"></a>  <span class="cf">return</span> (frame,)</span></code></pre></div>
<p>In the next block of code we define which frames we want to use in the animation and then we call upon the <code>matplotlib.animation</code> function to build the animation.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb138-1"><a href="ch-odes.html#cb138-1"></a><span class="co"># The Euler solution takes many very small time steps.  </span></span>
<span id="cb138-2"><a href="ch-odes.html#cb138-2"></a><span class="co"># To speed up the animation we view every 10th iteration.</span></span>
<span id="cb138-3"><a href="ch-odes.html#cb138-3"></a>PlotFrames <span class="op">=</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(t),<span class="dv">10</span>) </span>
<span id="cb138-4"><a href="ch-odes.html#cb138-4"></a>anim <span class="op">=</span> animation.FuncAnimation(fig, <span class="co"># call on the figure</span></span>
<span id="cb138-5"><a href="ch-odes.html#cb138-5"></a><span class="co"># next call the function that builds the animation frame</span></span>
<span id="cb138-6"><a href="ch-odes.html#cb138-6"></a>                               animator, </span>
<span id="cb138-7"><a href="ch-odes.html#cb138-7"></a><span class="co"># next tell which frames to pass to animator</span></span>
<span id="cb138-8"><a href="ch-odes.html#cb138-8"></a>                               frames<span class="op">=</span>PlotFrames, </span>
<span id="cb138-9"><a href="ch-odes.html#cb138-9"></a><span class="co"># lastly give the delay between frames                         </span></span>
<span id="cb138-10"><a href="ch-odes.html#cb138-10"></a>                               interval<span class="op">=</span><span class="dv">100</span> </span>
<span id="cb138-11"><a href="ch-odes.html#cb138-11"></a>                               ) </span></code></pre></div>
<p>Finally, we embed the animation into the Google Colab environment. Take note that if you are using a different Python IDE then you may need to experiment with how to show the resulting animation.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb139-1"><a href="ch-odes.html#cb139-1"></a>rc(<span class="st">&#39;animation&#39;</span>, html<span class="op">=</span><span class="st">&#39;jshtml&#39;</span>) <span class="co"># embed in the HTML for Google Colab</span></span>
<span id="cb139-2"><a href="ch-odes.html#cb139-2"></a>anim <span class="co"># show the animation</span></span></code></pre></div>
<p>A static snapshot of the resulting animation can be seen in Figure <a href="ch-odes.html#fig:mplanimationsnapshot">5.6</a>. The controls for the animation should be familiar from other media players.</p>
<div class="figure" style="text-align: center"><span id="fig:mplanimationsnapshot"></span>
<img src="images/Ch05_mplanimationsnapshot.png" alt="Snapshot of the ODE animation applet with matplotlib animation." width="55%" />
<p class="caption">
Figure 5.6: Snapshot of the ODE animation applet with matplotlib animation.
</p>
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-484" class="exercise"><strong>Exercise 5.46  </strong></span>Modify the code from the previous exercise to show faster and slower animations.
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-485" class="exercise"><strong>Exercise 5.47  </strong></span>Modify the <code>matplotlib.animation</code> code from Exercise <a href="ch-odes.html#exr:mplanimation">5.45</a> to use a different differential equation solver.
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-486" class="exercise"><strong>Exercise 5.48  </strong></span>Modify the <code>matplotlib.animation</code> code from Exericse <a href="ch-odes.html#exr:mplanimation">5.45</a> to show the Euler, Midpoint, and RK4 solutions to a differential equation on top of each other for a fixed value of <span class="math inline">\(\Delta t\)</span>.
</div>
<hr />
<div style="page-break-after: always;"></div>
</div>
</div>
<div id="the-backwards-euler-method" class="section level2" number="5.7">
<h2><span class="header-section-number">5.7</span> The Backwards Euler Method</h2>
<p>We have now built up a fairly large variety of numerical ODE solvers. All of the solvers that we have built thus far are called <strong>explicit</strong> numerical differential equation solvers since they try to advance the solution explicitly forward in time. Wouldn’t it be nice if we could literally just say, <em>what slope is going to work best in the future time steps … let’s use that</em>? Seems like an unrealistic hope, but that is exactly what the last method covered in this section does.</p>
<hr />

<div class="definition">
<p><span id="def:unnamed-chunk-487" class="definition"><strong>Definition 5.6  (Backward Euler Method)  </strong></span>We want to solve <span class="math inline">\(x&#39; = f(t,x)\)</span> so:</p>
<ul>
<li>Approximate the derivative by looking forward in time(!)
<span class="math display">\[\frac{x_{n+1} - x_n}{h} \approx f(t_{n+1}, x_{n+1})\]</span></li>
<li>Rearrange to get the difference equation
<span class="math display">\[x_{n+1} = x_n + h f(t_{n+1},x_{n+1}).\]</span></li>
<li>We will always know the value of <span class="math inline">\(t_{n+1}\)</span> and we will always know the value of <span class="math inline">\(x_n\)</span>, but we don’t know the value of <span class="math inline">\(x_{n+1}\)</span>. In fact, that is exactly what we want. The major trouble is that <span class="math inline">\(x_{n+1}\)</span> shows up on both sides of the equation. Can you think of a way to solve for it? …you have code that does this step!!!</li>
<li>This method is called the <strong>Backward Euler</strong> method and is known as an <strong>implicit method</strong> since you do not explicitly calculate <span class="math inline">\(x_{n+1}\)</span> but instead there is some intermediate calculation that needs to happen to solve for <span class="math inline">\(x_{n+1}\)</span>. The (usual) advantage to an implicit method such as Backward Euler is that you can take far fewer steps with reasonably little loss of accuracy. We’ll see that in the coming problems.</li>
</ul>
</div>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-488" class="exercise"><strong>Exercise 5.49  </strong></span>Let’s take a few steps through the backward Euler method on a problem
that we know well: <span class="math inline">\(x&#39; = -0.5x\)</span> with <span class="math inline">\(x(0) = 6\)</span>.<br />
Let’s take <span class="math inline">\(h=1\)</span> for simplicity, so the backward Euler iteration scheme
for this particular differential equation is
<span class="math display">\[x_{n+1} = x_n - \frac{1}{2} x_{n+1}.\]</span> Notice that <span class="math inline">\(x_{n+1}\)</span> shows up
on both sides of the equation. A little bit of rearranging gives
<span class="math display">\[\frac{3}{2} x_{n+1} = x_n \quad \implies \quad x_{n+1} = \frac{2}{3} x_n.\]</span></p>
<ol style="list-style-type: lower-alpha">
<li>Complete the following table.</li>
</ol>
<table>
<thead>
<tr class="header">
<th><span class="math inline">\(t\)</span></th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>10</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Euler Approx. of <span class="math inline">\(x\)</span></td>
<td>6</td>
<td>3</td>
<td>1.5</td>
<td>0.75</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>Back. Euler Approx.of <span class="math inline">\(x\)</span></td>
<td>6</td>
<td>4</td>
<td>2.667</td>
<td>1.778</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>Exact value of <span class="math inline">\(x\)</span></td>
<td>6</td>
<td>3.64</td>
<td>2.207</td>
<td>1.339</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ol start="2" style="list-style-type: lower-alpha">
<li>Compare now to what we found for the midpoint method on this problem as well.</li>
</ol>
</div>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-489" class="exercise"><strong>Exercise 5.50  </strong></span>The previous problem could potentially lead you to believe that the backward Euler method will always result in some other nice difference equation after some algebraic rearranging. That isn’t true! Let’s consider a slightly more complicated differential equation and see what happens
<span class="math display">\[x&#39; = -\frac{1}{2} x^2 \quad \text{with} \quad x(0) = 0.\]</span></p>
<ol style="list-style-type: lower-alpha">
<li><p>Recall that the backward Euler approximation is
<span class="math display">\[x_{n+1} = x_n + h f(t_{n+1},x_{n+1}).\]</span>
Let’s take <span class="math inline">\(h=1\)</span> for simplicity (we’ll make it smaller later). What is the backward Euler formula for this particular differential equation?</p></li>
<li><p>You should notice that your backward Euler formula is now a quadratic function in <span class="math inline">\(x_{n+1}\)</span>. That is to say, if you are given a value of <span class="math inline">\(x_n\)</span> then you need to solve a quadratic polynomial equation to get <span class="math inline">\(x_{n+1}\)</span>. Let’s be more explicit:<br />
We know that <span class="math inline">\(x(0) = 6\)</span> so in our numerical solutions, <span class="math inline">\(x_1 = 6\)</span>. In order to get <span class="math inline">\(x_2\)</span> we consider the equation <span class="math inline">\(x_2 = x_1 - \frac{1}{2} x_2^2\)</span>. Rearranging we see that we need to solve <span class="math inline">\(\frac{1}{2}x_2^2 + x_2 - 6 = 0\)</span> in order to get <span class="math inline">\(x_2\)</span>. Doing so gives us <span class="math inline">\(x_2 = \sqrt{13} - 1 \approx 2.606\)</span>.</p></li>
<li><p>Go two steps further with the backward Euler method on this problem. Then take the same number of steps with regular (forward) Euler’s method.</p></li>
<li><p>Work our the analytic solution for this differential equation (using separation of variables perhaps). Then compare the values that you found in parts (b) and (c) of this problem to values of the analytic solution and values that you would find form the regular (forward) Euler approximation. What do you notice?</p></li>
</ol>
</div>
<hr />
<p>The complications with the backward Euler’s method are that you have a
nonlinear equation to solve at every time step
<span class="math display">\[x_{n+1} = x_n + h f(t_{n+1},x_{n+1}).\]</span> Notice that this is the same
as solving the equation <span class="math display">\[x_{n+1} - hf(t_{n+1},x_{n+1}) - x_n = 0.\]</span> You
know the values of <span class="math inline">\(h=\Delta t\)</span>, <span class="math inline">\(t_{n+1}\)</span> and <span class="math inline">\(x_n\)</span>, and you know the function <span class="math inline">\(f\)</span>, so, in a practical sense, you should use some sort of Newton’s
method iteration to solve that equation – at each time step. More simply, we could call upon <code>scipy.optimize.fsolve()</code> to quickly implement a built in Python numerical root finding technique for us.</p>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-490" class="exercise"><strong>Exercise 5.51  </strong></span>Consider the function <code>backwardEuler1d()</code> below. How do you define the function <code>G</code> inside the <code>for</code> loop and what seed do you use to start the <code>fsolve()</code> command?
</div>
<div class="sourceCode" id="cb140"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb140-1"><a href="ch-odes.html#cb140-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb140-2"><a href="ch-odes.html#cb140-2"></a><span class="im">from</span> scipy <span class="im">import</span> optimize</span>
<span id="cb140-3"><a href="ch-odes.html#cb140-3"></a><span class="kw">def</span> backwardEuler1d(f,x0,t0,tmax,dt):</span>
<span id="cb140-4"><a href="ch-odes.html#cb140-4"></a>    t <span class="op">=</span> np.arange(t0,tmax<span class="op">+</span>dt,dt)</span>
<span id="cb140-5"><a href="ch-odes.html#cb140-5"></a>    x <span class="op">=</span> np.zeros_like(t)</span>
<span id="cb140-6"><a href="ch-odes.html#cb140-6"></a>    x[<span class="dv">0</span>] <span class="op">=</span> x0</span>
<span id="cb140-7"><a href="ch-odes.html#cb140-7"></a>    <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(t)<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb140-8"><a href="ch-odes.html#cb140-8"></a>        G <span class="op">=</span> <span class="kw">lambda</span> X: ??? <span class="co"># define this function</span></span>
<span id="cb140-9"><a href="ch-odes.html#cb140-9"></a>        <span class="co"># give the correct seed for the solver below</span></span>
<span id="cb140-10"><a href="ch-odes.html#cb140-10"></a>        x[n<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> optimize.fsolve(G, ??? )[<span class="dv">0</span>] </span>
<span id="cb140-11"><a href="ch-odes.html#cb140-11"></a>    <span class="cf">return</span> t, x</span></code></pre></div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-492" class="exercise"><strong>Exercise 5.52  </strong></span>Test the Backward Euler method from the previous problem on several differential equations where you know the solution.
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-493" class="exercise"><strong>Exercise 5.53  </strong></span>Write a script that outputs a log-log plot with the step size on the horizontal axis and the error in the numerical method on the vertical axis. Plot the errors for Euler, Midpoint, Runge Kutta, and Backward Euler measured against a differential equation with a known analytic solution. Use this plot to conjecture the convergence rates of the four methods. You can use the differential equation <span class="math inline">\(x&#39; = -\frac{1}{3} x + \sin(t)\)</span> with <span class="math inline">\(x(0) = 1\)</span> like we have for many of our past algorithm since we know that the solution is
<span class="math display">\[ x(t) = \frac{1}{10}\left( 19e^{-t/3} + 3\sin(t) - 9\cos(t) \right) \]</span>
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-494" class="exercise"><strong>Exercise 5.54  </strong></span>What is the order of the error on the Backward Euler method? Given this answer, what are the pros and cons of the Backward Euler method over the regular Euler method? What about compared to the Midpoint or Runge Kutta methods?
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-495" class="exercise"><strong>Exercise 5.55  </strong></span>It may not be obvious at the outset, but the Backward Euler method will actually behave better than our regular Euler’s method in some sense. Let’s take a look. Consider, for example, the really simply differential equation <span class="math inline">\(x&#39; = -x\)</span> with <span class="math inline">\(x(0) = 1\)</span> on the interval <span class="math inline">\(t \in [0,2]\)</span>. The analytic solution is <span class="math inline">\(x(t) = e^{-t}\)</span>. Write Python code that plots the analytic solution, the Euler approximation, and the Backward Euler approximation on top of each other. Use a time step that is larger than you normally would (such as <span class="math inline">\(\Delta t = 0.25\)</span> or <span class="math inline">\(\Delta t = 0.5\)</span> or larger). Try the same experiment on another differential equation where we know the exact solution and the solution has some regions of high curvature. What do you notice? What does Backward Euler do that is an improvement on regular Euler?
</div>
<hr />
<div style="page-break-after: always;"></div>
</div>
<div id="fitting-ode-models-to-data" class="section level2" number="5.8">
<h2><span class="header-section-number">5.8</span> Fitting ODE Models to Data</h2>
<p>To end this chapter we will examine a very common scientific situation:  We have data from an experiment and a (challenging to solve) differential equation modeling the data that has some parameter that controls the behavior. We want to find the value of the parameter that gives us the best fit between our numerical solution and the data. For example, say we have temperature data for a cooling liquid and we have a differential equation for temperature that depends on a parameter related to the thermal properties of the container. We would like to use the data and the differential equation to determine the parameter for the container. As another example, say we have the number of patients that become ill with a virus each day and we actually want to know the long-term impacts on the population. An SIR differential equation model might describe the dynamics of the situation well, and the data can be used to determine the transmission rate parameters in the model.</p>
<p>Data fitting has been examined a few times in this book (see the Least Squares section in Chapter <a href="ch-calculus.html#ch:calculus">3</a> and the Over determined Systems section in Chapter <a href="ch-linearalgebra.html#ch:linearalgebra">4</a>). The present situation is really not that much different than regular least squares curve fitting.</p>
<ul>
<li>Propose a model function: In this case our model function will be a numerical solution to a differential equation given some value for an unknown parameter.</li>
<li>Calculate the sum of the squared residuals: In this case, we need to match the times between the numerical solution and the data. There will likely be far more points in the numerical solution than there will be in the data so we will have to carefully select the points that closely match between the two. Then calculating the sum of the squared error is simple.</li>
<li>Use an optimization routine to find the value of the best parameter: In this case this is no different than regular least squares. We are trying to find the value of the parameter that minimizes the sum of the squared residuals.</li>
</ul>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-496" class="exercise"><strong>Exercise 5.56  (Newton’s Law of Cooling)  </strong></span>From Calculus you may recall Newton’s Law of Cooling:
<span class="math display">\[ \frac{dT}{dt} = -k(T - T_{ambient}) \]</span>
where <span class="math inline">\(T\)</span> is the temperature of some object (like a cup of coffee), <span class="math inline">\(T_{ambient}\)</span> is the temperature of the ambient environment, and <span class="math inline">\(k\)</span> is the proportionality constant that governs the rate of cooling. This is a classic differential equation with a well known solution.<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a> In the present situation we don’t want the analytic solution, but instead we will work with a numerical solution since we are thinking ahead to where the differential equation may be very hard to solve in future problems. We also don’t want to just look at the data and guess an algebraic form for the function that best fits the data. That would be a trap! (why?) Instead, we rely on our knowledge of the physics of the situation to give us the differential equation.</p>
<p>The following data table gives the temperature (degrees <span class="math inline">\(F\)</span>) at several times while a cup of tea cools on a table <span class="citation">[<a href="#ref-tea" role="doc-biblioref">7</a>]</span>. The ambient temperature of the room is <span class="math inline">\(65^\circ F\)</span>.</p>
<table>
<thead>
<tr class="header">
<th>Time (sec)</th>
<th>Temperature</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>160</td>
</tr>
<tr class="even">
<td>60</td>
<td>155</td>
</tr>
<tr class="odd">
<td>180</td>
<td>145</td>
</tr>
<tr class="even">
<td>210</td>
<td>142</td>
</tr>
<tr class="odd">
<td>600</td>
<td>120</td>
</tr>
</tbody>
</table>
Plot the data as a scatter plot.
</div>
<div class="sourceCode" id="cb141"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb141-1"><a href="ch-odes.html#cb141-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb141-2"><a href="ch-odes.html#cb141-2"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb141-3"><a href="ch-odes.html#cb141-3"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb141-4"><a href="ch-odes.html#cb141-4"></a>URL1 <span class="op">=</span> <span class="st">&#39;https://raw.githubusercontent.com/NumericalMethodsSullivan&#39;</span></span>
<span id="cb141-5"><a href="ch-odes.html#cb141-5"></a>URL2 <span class="op">=</span> <span class="st">&#39;/NumericalMethodsSullivan.github.io/master/data/&#39;</span></span>
<span id="cb141-6"><a href="ch-odes.html#cb141-6"></a>URL <span class="op">=</span> URL1<span class="op">+</span>URL2</span>
<span id="cb141-7"><a href="ch-odes.html#cb141-7"></a>data <span class="op">=</span> np.array( pd.read_csv(URL<span class="op">+</span><span class="st">&#39;Exercise5_newtoncooling.csv&#39;</span>) )</span>
<span id="cb141-8"><a href="ch-odes.html#cb141-8"></a><span class="co"># Exercise5_newtoncooling.csv</span></span>
<span id="cb141-9"><a href="ch-odes.html#cb141-9"></a><span class="co"># </span></span>
<span id="cb141-10"><a href="ch-odes.html#cb141-10"></a><span class="co"># or you can load the data directly with </span></span>
<span id="cb141-11"><a href="ch-odes.html#cb141-11"></a><span class="co"># data = np.array([[0,160],[60,155],[180,145],[210,142],[600,120]])</span></span>
<span id="cb141-12"><a href="ch-odes.html#cb141-12"></a>plt.plot(data[??? , ???] , data[??? , ???], <span class="st">&#39;b*&#39;</span>)</span>
<span id="cb141-13"><a href="ch-odes.html#cb141-13"></a>plt.grid()</span>
<span id="cb141-14"><a href="ch-odes.html#cb141-14"></a>plt.show()</span></code></pre></div>
<p>Now we will build several Python functions as well as several additional lines of code that are created specifically for this problem. Note that every parameter estimate problem of this type will take similar form, but there may be subtle differences depending on the data that you need to account for in each problem. You will need to taylor make parts of each parameter estimation script for each new problem.</p>
<ul>
<li>First we set the stage by defining <span class="math inline">\(\Delta t\)</span>, a collection of times that contains the data, the function <span class="math inline">\(f(t,x; k)\)</span> which depends on the parameter <span class="math inline">\(k\)</span>, and any other necessary parameters of our specific problem.</li>
</ul>
<div class="sourceCode" id="cb142"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb142-1"><a href="ch-odes.html#cb142-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb142-2"><a href="ch-odes.html#cb142-2"></a>Tambient <span class="op">=</span> ???</span>
<span id="cb142-3"><a href="ch-odes.html#cb142-3"></a><span class="co"># Next choose an appropriate value of dt.  </span></span>
<span id="cb142-4"><a href="ch-odes.html#cb142-4"></a><span class="co"># Choosing dt so that values of time in the data fall within</span></span>
<span id="cb142-5"><a href="ch-odes.html#cb142-5"></a><span class="co"># the times for the numerical solution is typically a good </span></span>
<span id="cb142-6"><a href="ch-odes.html#cb142-6"></a><span class="co"># practice (but is not always possible).</span></span>
<span id="cb142-7"><a href="ch-odes.html#cb142-7"></a>dt <span class="op">=</span> ??? </span>
<span id="cb142-8"><a href="ch-odes.html#cb142-8"></a>t0 <span class="op">=</span> <span class="dv">0</span> <span class="co"># time where the data starts</span></span>
<span id="cb142-9"><a href="ch-odes.html#cb142-9"></a>tmax <span class="op">=</span> ??? <span class="co"># just beyond where the data ends</span></span>
<span id="cb142-10"><a href="ch-odes.html#cb142-10"></a>t <span class="op">=</span> np.arange(t0,tmax<span class="op">+</span>dt,dt) <span class="co"># set up the times </span></span>
<span id="cb142-11"><a href="ch-odes.html#cb142-11"></a><span class="co"># nest we define our specific differential equation</span></span>
<span id="cb142-12"><a href="ch-odes.html#cb142-12"></a>f <span class="op">=</span> <span class="kw">lambda</span> t, x, k: <span class="op">-</span>k<span class="op">*</span>(x <span class="op">-</span> Tambient) </span>
<span id="cb142-13"><a href="ch-odes.html#cb142-13"></a>x0 <span class="op">=</span> ??? <span class="co"># initial condition pulled from the data</span></span></code></pre></div>
<ul>
<li>Now we build a Python function that will accept a value of the parameter <span class="math inline">\(k\)</span> as the only input and will return a high quality numerical solution to the proposed differential equation.</li>
</ul>
<div class="sourceCode" id="cb143"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb143-1"><a href="ch-odes.html#cb143-1"></a><span class="kw">def</span> numericalSolution(k):</span>
<span id="cb143-2"><a href="ch-odes.html#cb143-2"></a>    x <span class="op">=</span> np.zeros_like(t)</span>
<span id="cb143-3"><a href="ch-odes.html#cb143-3"></a>    x[<span class="dv">0</span>] <span class="op">=</span> x0</span>
<span id="cb143-4"><a href="ch-odes.html#cb143-4"></a>    <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(t)<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb143-5"><a href="ch-odes.html#cb143-5"></a>        <span class="co"># put the code necessary to build a good </span></span>
<span id="cb143-6"><a href="ch-odes.html#cb143-6"></a>        <span class="co"># numerical solver here be sure to account </span></span>
<span id="cb143-7"><a href="ch-odes.html#cb143-7"></a>        <span class="co"># for the parameter k in each of your function calls.</span></span>
<span id="cb143-8"><a href="ch-odes.html#cb143-8"></a>    <span class="cf">return</span> t, x</span></code></pre></div>
<ul>
<li><p>Spend a little time now playing with different parameters and plotting numerical solutions along with the data to determine the proper ballpark value of the parameter.</p></li>
<li><p>Now we need to write a short Python script that will find all of the indices where the value of time in the data closely match values of time in the numerical solution. There are many ways to do this, but the most readable is a pair of nested <code>for</code> loops. Outline what the following code does. Why are we using <code>dt/2</code> in the code below? You should work to find more efficient ways to code this for bigger problems since the nested <code>for</code> loops is potentially quite time consuming.</p></li>
</ul>
<div class="sourceCode" id="cb144"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb144-1"><a href="ch-odes.html#cb144-1"></a>indices <span class="op">=</span> []</span>
<span id="cb144-2"><a href="ch-odes.html#cb144-2"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(t)):</span>
<span id="cb144-3"><a href="ch-odes.html#cb144-3"></a>    <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data)):</span>
<span id="cb144-4"><a href="ch-odes.html#cb144-4"></a>        <span class="cf">if</span> <span class="co"># write a check to find where t is closest to data[:,1]</span></span>
<span id="cb144-5"><a href="ch-odes.html#cb144-5"></a>            indices.append(j)</span></code></pre></div>
<ul>
<li>Now we build a Python function <code>dataMatcher(k)</code> which accepts the parameter <span class="math inline">\(k\)</span> and outputs the sum of the squared residuals between the numerical solution associated with <span class="math inline">\(k\)</span> and our data. Carefully dissect the following code.</li>
</ul>
<div class="sourceCode" id="cb145"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb145-1"><a href="ch-odes.html#cb145-1"></a><span class="kw">def</span> dataMatcher(k):</span>
<span id="cb145-2"><a href="ch-odes.html#cb145-2"></a>    t, x <span class="op">=</span> numericalSolution(k)</span>
<span id="cb145-3"><a href="ch-odes.html#cb145-3"></a>    err <span class="op">=</span> []</span>
<span id="cb145-4"><a href="ch-odes.html#cb145-4"></a>    counter <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb145-5"><a href="ch-odes.html#cb145-5"></a>    <span class="cf">for</span> n <span class="kw">in</span> indices:</span>
<span id="cb145-6"><a href="ch-odes.html#cb145-6"></a>        err.append( (data[counter,<span class="dv">1</span>] <span class="op">-</span> x[<span class="bu">int</span>(n)])<span class="op">**</span><span class="dv">2</span> )</span>
<span id="cb145-7"><a href="ch-odes.html#cb145-7"></a>        counter <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb145-8"><a href="ch-odes.html#cb145-8"></a>    <span class="bu">print</span>(<span class="st">&quot;For k=&quot;</span>,k[<span class="dv">0</span>],<span class="st">&quot;,  SSRes=&quot;</span>,np.<span class="bu">sum</span>(err)) <span class="co"># optional</span></span>
<span id="cb145-9"><a href="ch-odes.html#cb145-9"></a>    <span class="cf">return</span> np.<span class="bu">sum</span>(err)</span></code></pre></div>
<ul>
<li><p>Test your <code>dataMatcher()</code> function to be sure that it is working properly on a value of <span class="math inline">\(k\)</span> which visually matches the data well.</p></li>
<li><p>Finally, we call upon the <code>scipy.optimize.minimize()</code> function to iteratively try different values of the parameter <span class="math inline">\(k\)</span> and to find the one that minimizes the sum of the squared residuals. Be sure to start <span class="math inline">\(k\)</span> at a value that gives a reasonably good visual match between the numerical solution and the data. Once the optimization routine is done you should plot your best solution on top of the data to verify that it indeed found a good solution. You’ll notice that there are several options that you can send to the <code>scipy.optimize.minimize()</code> command. Play with these options to see what they do and how they impact the quality of your solution.</p></li>
</ul>
<div class="sourceCode" id="cb146"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb146-1"><a href="ch-odes.html#cb146-1"></a><span class="im">import</span> scipy.optimize <span class="im">as</span> sp</span>
<span id="cb146-2"><a href="ch-odes.html#cb146-2"></a><span class="co"># Choose an initial value of k and put it into the following code </span></span>
<span id="cb146-3"><a href="ch-odes.html#cb146-3"></a><span class="co"># in place of the &quot;???&quot;.  Note that we are sending a few parameters </span></span>
<span id="cb146-4"><a href="ch-odes.html#cb146-4"></a><span class="co"># to the optimization tool.  Be sure to understand these options </span></span>
<span id="cb146-5"><a href="ch-odes.html#cb146-5"></a><span class="co"># and take care that these options problem dependent and you will </span></span>
<span id="cb146-6"><a href="ch-odes.html#cb146-6"></a><span class="co"># need to choose these again for the next new problem.</span></span>
<span id="cb146-7"><a href="ch-odes.html#cb146-7"></a>K <span class="op">=</span> sp.minimize(dataMatcher,???, options <span class="op">=</span> {<span class="st">&#39;maxiter&#39;</span>: <span class="dv">5</span>}, tol<span class="op">=</span><span class="fl">1e-2</span>)</span>
<span id="cb146-8"><a href="ch-odes.html#cb146-8"></a><span class="bu">print</span>(K)</span>
<span id="cb146-9"><a href="ch-odes.html#cb146-9"></a>t, x <span class="op">=</span> numericalSolution(K.x[<span class="dv">0</span>])</span>
<span id="cb146-10"><a href="ch-odes.html#cb146-10"></a>plt.plot(t,x,<span class="st">&#39;r--&#39;</span>,data[:,<span class="dv">0</span>],data[:,<span class="dv">1</span>],<span class="st">&#39;b*&#39;</span>)</span>
<span id="cb146-11"><a href="ch-odes.html#cb146-11"></a>plt.grid()</span>
<span id="cb146-12"><a href="ch-odes.html#cb146-12"></a>plt.show()</span></code></pre></div>
<ul>
<li>Note: If your optimization does not terminate successfully then you’ll need to go back to the point where you guess a few values for the parameter so that your initial guess for <code>scipy.optimize.minimize()</code> is <em>close</em> to what it should be. It is always helpful to think about the physical context of the problem to help guide your understanding of which value(s) to choose for your parameter.</li>
</ul>
<p>To recap:</p>
<ul>
<li>We have data and a proposed differential equation with an unknown parameter.</li>
<li>We matched numerical solutions to the differential equation to the data for various values of the parameter.</li>
<li>We used an optimization routine to find the value of the parameter that minimized the sum of the squared residuals between the data and the numerical solution.</li>
</ul>
<p>At this point you can now use the <em>best</em> numerical solution to answer questions about the scientific setup (e.g. extrapolation).</p>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-503" class="exercise"><strong>Exercise 5.57  </strong></span>In the paper <a href="https://www.simiode.org/resources/4192/download/1-094-S-SteepingTea-StudentVersion.pdf"><em>Steeping Tea: A differential equations approach to a great cup of fruit tea</em></a> <span class="citation">[<a href="#ref-tea" role="doc-biblioref">7</a>]</span>, the authors give color data from photographs of tea that is steeping in a clear mason jar. The temperature data from the previous exercise in this section were taken from this paper.</p>
<ol style="list-style-type: lower-alpha">
<li>Read the introduction, methods, and experimental setup in the paper.</li>
<li>Think carefully about the physics of the problem to propose a differential equation (NOT an algebraic function) which would best models the grayscale data found on page 3 of the paper. Your model will likely involve at least one unknown parameter.</li>
<li>Use the least squares data fitting routine outlined in the previous exercise to find the value(s) of your parameter(s) which will create a high quality match between the numerical solution to your ODE and the data.</li>
<li>Plot your solution curve along with the data.</li>
</ol>
</div>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-504" class="exercise"><strong>Exercise 5.58  (Village Epidemic)  </strong></span>(This exercise is modified from <span class="citation">[<a href="#ref-plague" role="doc-biblioref">8</a>]</span>)</p>
<p>In the mid seventeenth century in a small village in England a form of the Plague spread from July 3 through October 20 in one year. We note three classes of individuals: Susceptible, Infective, and Removed. The latter group consists of those who have died from the disease or who developed an immunity from the disease, having already had the disease. We keep track of the following:</p>
<ul>
<li><span class="math inline">\(S(t)=\)</span> the number of Susceptibles on day <span class="math inline">\(t\)</span> of the epidemic. <span class="math inline">\(S(0) = 235\)</span>.</li>
<li><span class="math inline">\(I(t)=\)</span> the number of Infectives on day <span class="math inline">\(t\)</span> of the epidemic. <span class="math inline">\(I(0)=14\)</span></li>
<li><span class="math inline">\(R(t)=\)</span> the number of Removeds on day <span class="math inline">\(t\)</span> of the epidemic. <span class="math inline">\(R(0)=0\)</span>.</li>
</ul>
<p>A standard <span class="math inline">\(SIR\)</span> model takes the form
<span class="math display">\[\begin{aligned}  
S&#39; &amp;= -\alpha SI \\ 
I&#39; &amp;= \alpha SI - \beta I \\
R&#39; &amp;= \beta I.
\end{aligned}\]</span></p>
<p>Data was gathered on the outbreak and is shown in the table below.</p>
<table>
<thead>
<tr class="header">
<th>Time (days)</th>
<th>Susceptibles</th>
<th>Infectives</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>235</td>
<td>14</td>
</tr>
<tr class="even">
<td>16</td>
<td>201</td>
<td>22</td>
</tr>
<tr class="odd">
<td>31</td>
<td>153.5</td>
<td>29</td>
</tr>
<tr class="even">
<td>47</td>
<td>121</td>
<td>21</td>
</tr>
<tr class="odd">
<td>62</td>
<td>108</td>
<td>8</td>
</tr>
<tr class="even">
<td>78</td>
<td>97</td>
<td>8</td>
</tr>
<tr class="odd">
<td>109</td>
<td>83</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>Use the least squares fitting technique discussed in this section to find the parameters <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> that minimize the sum of the squared residuals between a numerical solution of the <span class="math inline">\(SIR\)</span> model and the data. You can load the data directly with the code below.</p>
Note: The total population is fixed.
</div>
<div class="sourceCode" id="cb147"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb147-1"><a href="ch-odes.html#cb147-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb147-2"><a href="ch-odes.html#cb147-2"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb147-3"><a href="ch-odes.html#cb147-3"></a>URL1 <span class="op">=</span> <span class="st">&#39;https://raw.githubusercontent.com/NumericalMethodsSullivan&#39;</span></span>
<span id="cb147-4"><a href="ch-odes.html#cb147-4"></a>URL2 <span class="op">=</span> <span class="st">&#39;/NumericalMethodsSullivan.github.io/master/data/&#39;</span></span>
<span id="cb147-5"><a href="ch-odes.html#cb147-5"></a>URL <span class="op">=</span> URL1<span class="op">+</span>URL2</span>
<span id="cb147-6"><a href="ch-odes.html#cb147-6"></a>data <span class="op">=</span> np.array( pd.read_csv(URL<span class="op">+</span><span class="st">&#39;Exercise5_village.csv&#39;</span>) )</span>
<span id="cb147-7"><a href="ch-odes.html#cb147-7"></a><span class="co"># Exercise5_village.csv</span></span></code></pre></div>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-506" class="exercise"><strong>Exercise 5.59  (Bedridden Boys Problem)  </strong></span>(This problem is modified from <span class="citation">[<a href="#ref-bedridden" role="doc-biblioref">9</a>]</span>)</p>
<p>A boarding school is a relatively closed community in which all students live on campus, teachers tend to live on or near campus, and students do not regularly interact with people not in the boarding school community. The table below gives data for an influenza outbreak at a boarding school in England during which there were no fatalities. There were 763 boys at the English boarding school from which the data was obtained.</p>
<table>
<thead>
<tr class="header">
<th>Time (days)</th>
<th>Number of Bedridden Boys</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td>1</td>
<td>3</td>
</tr>
<tr class="odd">
<td>2</td>
<td>25</td>
</tr>
<tr class="even">
<td>3</td>
<td>72</td>
</tr>
<tr class="odd">
<td>4</td>
<td>222</td>
</tr>
<tr class="even">
<td>5</td>
<td>282</td>
</tr>
<tr class="odd">
<td>6</td>
<td>256</td>
</tr>
<tr class="even">
<td>7</td>
<td>233</td>
</tr>
<tr class="odd">
<td>8</td>
<td>189</td>
</tr>
<tr class="even">
<td>9</td>
<td>123</td>
</tr>
<tr class="odd">
<td>10</td>
<td>70</td>
</tr>
<tr class="even">
<td>11</td>
<td>25</td>
</tr>
<tr class="odd">
<td>12</td>
<td>11</td>
</tr>
<tr class="even">
<td>13</td>
<td>4</td>
</tr>
</tbody>
</table>
Propose a differential equation model that includes the number of bedridden (sick) boys. Your model will likely have one or more unknown parameters. Use the technique from this section to find the parameters. Complete the problem by showing a plot of the number of bedridden boys along with the data. You can load the data directly with the code below.
</div>
<div class="sourceCode" id="cb148"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb148-1"><a href="ch-odes.html#cb148-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb148-2"><a href="ch-odes.html#cb148-2"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb148-3"><a href="ch-odes.html#cb148-3"></a>URL1 <span class="op">=</span> <span class="st">&#39;https://raw.githubusercontent.com/NumericalMethodsSullivan&#39;</span></span>
<span id="cb148-4"><a href="ch-odes.html#cb148-4"></a>URL2 <span class="op">=</span> <span class="st">&#39;/NumericalMethodsSullivan.github.io/master/data/&#39;</span></span>
<span id="cb148-5"><a href="ch-odes.html#cb148-5"></a>URL <span class="op">=</span> URL1<span class="op">+</span>URL2</span>
<span id="cb148-6"><a href="ch-odes.html#cb148-6"></a>data <span class="op">=</span> np.array( pd.read_csv(URL<span class="op">+</span><span class="st">&#39;Exercise5_boys.csv&#39;</span>) )</span>
<span id="cb148-7"><a href="ch-odes.html#cb148-7"></a><span class="co"># Exercise5_boys.csv</span></span></code></pre></div>
<hr />
<div style="page-break-after: always;"></div>
</div>
<div id="exercises-4" class="section level2" number="5.9">
<h2><span class="header-section-number">5.9</span> Exercises</h2>
<div id="algorithm-summaries-3" class="section level3" number="5.9.1">
<h3><span class="header-section-number">5.9.1</span> Algorithm Summaries</h3>

<div class="exercise">
<span id="exr:unnamed-chunk-508" class="exercise"><strong>Exercise 5.60  </strong></span>Consider the first-order differential equation <span class="math inline">\(x&#39; = f(t,x)\)</span>. What is
Euler’s method for approximating the solution to this differential
equation? What is the order of accuracy of Euler’s method? Explain the
meaning of the order of the method in the context of solving a
differential equation.
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-509" class="exercise"><strong>Exercise 5.61  </strong></span>Explain in clear language what Euler’s method does geometrically.
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-510" class="exercise"><strong>Exercise 5.62  </strong></span>Consider the first-order differential equation <span class="math inline">\(x&#39; = f(t,x)\)</span>. What is
the Midpoint method for approximating the solution to this differential
equation? What is the order of accuracy of the Midpoint method? Explain
the meaning of the order of the method in the context of solving a
differential equation.
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-511" class="exercise"><strong>Exercise 5.63  </strong></span>Explain in clear language what the Midpoint method does geometrically.
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-512" class="exercise"><strong>Exercise 5.64  </strong></span>Consider the first-order differential equation <span class="math inline">\(x&#39; = f(t,x)\)</span>. What is
the Runge Kutta 4 method for approximating the solution to this
differential equation? What is the order of accuracy of the Runge Kutta 4
method? Explain the meaning of the order of the method in the context of
solving a differential equation.
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-513" class="exercise"><strong>Exercise 5.65  </strong></span>Explain in clear language what the Runge Kutta 4 method does
geometrically.
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-514" class="exercise"><strong>Exercise 5.66  </strong></span>Consider the first-order differential equation <span class="math inline">\(x&#39; = f(t,x)\)</span>. What is
the Backward Euler method for approximating the solution to this
differential equation? What is the order of accuracy of the Backward Euler
method? Explain the meaning of the order of the method in the context of
solving a differential equation.
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-515" class="exercise"><strong>Exercise 5.67  </strong></span>Explain in clear language what the Backward Euler method does
geometrically.
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-516" class="exercise"><strong>Exercise 5.68  </strong></span>Explain in clear language how to fit a numerical solution of and ODE model to a dataset.
</div>
<hr />
</div>
<div id="applying-what-youve-learned-4" class="section level3" number="5.9.2">
<h3><span class="header-section-number">5.9.2</span> Applying What You’ve Learned</h3>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-517" class="exercise"><strong>Exercise 5.69  </strong></span>Consider the differential equation <span class="math inline">\(x&#39;&#39; + x&#39; + x = 0\)</span> with initial conditions <span class="math inline">\(x(0) = 0\)</span> and <span class="math inline">\(x&#39;(0)=1\)</span>.</p>
<ol style="list-style-type: lower-alpha">
<li>Solve this differential equation by hand using any appropriate technique. Show your work.</li>
<li>Write code to demonstrate the first order convergence rate of Euler’s method, the second order convergence rate of the Midpoint method, and the fourth order convergence rate of the Runge-Kutta 4 method. Take note that this is a second order differential equation so you will need to start by converting it to a system of differential equations. Then take care that you are comparing the correct term from the numerical solution to your analytic solution in part (a).</li>
</ol>
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-518" class="exercise"><strong>Exercise 5.70  </strong></span>Test the Euler, Midpoint, and Runge Kutta methods on the differential
equation
<span class="math display">\[x&#39; = \lambda \left( x - \cos(t) \right) - \sin(t) \quad \text{with} \quad x(0) = 1.5.\]</span>
Find the exact solution by hand using the method of undetermined
coefficients and note that your exact solution will involve the
parameter <span class="math inline">\(\lambda\)</span>. Produce log-log plots for the error between your
numerical solution and the exact solution for <span class="math inline">\(\lambda =  -1\)</span>, <span class="math inline">\(\lambda = -10\)</span>, <span class="math inline">\(\lambda = -10^2\)</span>, …, <span class="math inline">\(\lambda = -10^6\)</span>. In
other words, create 7 plots (one for each <span class="math inline">\(\lambda\)</span>) showing how each of
the 3 methods performs for that value of <span class="math inline">\(\lambda\)</span> at different values
for <span class="math inline">\(\Delta t\)</span>.
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-519" class="exercise"><strong>Exercise 5.71  </strong></span>Two versions of Python code for one dimensional Euler’s method are given below. Compare and contrast the two implementations. What are the advantages / disadvantages to one over the other? Once you have made your pro/con list, devise an experiment to see which of the methods will actually perform faster when solving a differential equation with a very small <span class="math inline">\(\Delta t\)</span>. (You may want to look up how to time the execution of code in Python.)
</div>
<div class="sourceCode" id="cb149"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb149-1"><a href="ch-odes.html#cb149-1"></a><span class="kw">def</span> euler(f,x0,t0,tmax,dt):</span>
<span id="cb149-2"><a href="ch-odes.html#cb149-2"></a>    t <span class="op">=</span> [t0]</span>
<span id="cb149-3"><a href="ch-odes.html#cb149-3"></a>    x <span class="op">=</span> [x0]</span>
<span id="cb149-4"><a href="ch-odes.html#cb149-4"></a>    steps <span class="op">=</span> <span class="bu">int</span>(np.floor((tmax<span class="op">-</span>t0)<span class="op">/</span>dt))</span>
<span id="cb149-5"><a href="ch-odes.html#cb149-5"></a>    <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(steps):</span>
<span id="cb149-6"><a href="ch-odes.html#cb149-6"></a>        t.append(t[n] <span class="op">+</span> dt)</span>
<span id="cb149-7"><a href="ch-odes.html#cb149-7"></a>        x.append(x[n] <span class="op">+</span> dt<span class="op">*</span>f(t[n],x[n]))</span>
<span id="cb149-8"><a href="ch-odes.html#cb149-8"></a>    <span class="cf">return</span> t, x</span></code></pre></div>
<div class="sourceCode" id="cb150"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb150-1"><a href="ch-odes.html#cb150-1"></a><span class="kw">def</span> euler(f,x0,t0,tmax,dt):</span>
<span id="cb150-2"><a href="ch-odes.html#cb150-2"></a>    t <span class="op">=</span> np.arange(t0,tmax<span class="op">+</span>dt,dt)</span>
<span id="cb150-3"><a href="ch-odes.html#cb150-3"></a>    x <span class="op">=</span> np.zeros_like(t)</span>
<span id="cb150-4"><a href="ch-odes.html#cb150-4"></a>    x[<span class="dv">0</span>] <span class="op">=</span> x0</span>
<span id="cb150-5"><a href="ch-odes.html#cb150-5"></a>    <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(t)<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb150-6"><a href="ch-odes.html#cb150-6"></a>        x[n<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> x[n] <span class="op">+</span> dt<span class="op">*</span>f(t[n],x[n])</span>
<span id="cb150-7"><a href="ch-odes.html#cb150-7"></a>    <span class="cf">return</span> t, x</span></code></pre></div>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-522" class="exercise"><strong>Exercise 5.72  </strong></span>We wish to solve the boundary valued problem <span class="math inline">\(x&#39;&#39; + 4x = \sin(t)\)</span> with
initial condition <span class="math inline">\(x(0)=1\)</span> and boundary condition <span class="math inline">\(x(1)=2\)</span> on the domain <span class="math inline">\(t \in (0,1)\)</span>. Notice that
you do not have the initial position and initial velocity as you
normally would with a second order differential equation. Devise a
method for finding a numerical solution to this problem.</p>
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-523" class="exercise"><strong>Exercise 5.73  </strong></span>Write code to numerically solve the boundary valued differential equation
<span class="math display">\[x&#39;&#39; = \cos(t) x&#39; + \sin(t) x \quad \text{with} \quad x(0) = 0 \quad \text{and}
        \quad x(1) = 1.\]</span>
</div>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-524" class="exercise"><strong>Exercise 5.74  </strong></span>In this model there are two characters, Romeo and Juliet, whose
affection is quantified on the scale from <span class="math inline">\(-5\)</span> to <span class="math inline">\(5\)</span> described below:</p>
<ul>
<li><span class="math inline">\(-5\)</span>: Hysterical Hatred</li>
<li><span class="math inline">\(-2.5\)</span>: Disgust</li>
<li><span class="math inline">\(0\)</span>: Indifference</li>
<li><span class="math inline">\(2.5\)</span>: Sweet Affection</li>
<li><span class="math inline">\(5\)</span>: Ecstatic Love</li>
</ul>
<p>The characters struggle with frustrated love due to the lack of
reciprocity of their feelings. Mathematically,</p>
<ul>
<li><p>Romeo: “My feelings for Juliet decrease in proportion to her love
for me.”</p></li>
<li><p>Juliet: “My love for Romeo grows in proportion to his love for me.”</p></li>
<li><p>Juliet’s emotional swings lead to many sleepless nights, which
consequently dampens her emotions.</p></li>
</ul>
<p>This give rise to
<span class="math display">\[\left\{ \begin{array}{ll} \frac{dx}{dt} &amp;= -\alpha y \\ \frac{dy}{dt} &amp;= \beta x -
            \gamma y^2 \end{array} \right.\]</span> where <span class="math inline">\(x(t)\)</span> is Romeo’s
love for Juliet and <span class="math inline">\(y(t)\)</span> is Juliet’s love for Romeo at time <span class="math inline">\(t\)</span>.</p>
<p>Your tasks:</p>
<ol style="list-style-type: lower-alpha">
<li><p>First implement this 2D system with <span class="math inline">\(x(0) = 2\)</span>, <span class="math inline">\(y(0)=0\)</span>,
<span class="math inline">\(\alpha=0.2\)</span>, <span class="math inline">\(\beta=0.8\)</span>, and <span class="math inline">\(\gamma=0.1\)</span> for <span class="math inline">\(t \in [0,60]\)</span>. What
is the fate of this pair’s love under these assumptions?</p></li>
<li><p>Write code that approximates the parameter <span class="math inline">\(\gamma\)</span> that will result
in Juliet having a feeling of indifference at <span class="math inline">\(t=30\)</span>. Your code
should not need human supervision: you should be able to tell it
that you’re looking for <em>indifference</em> at <span class="math inline">\(t=30\)</span> and turn it loose
to find an approximation for <span class="math inline">\(\gamma\)</span>. Assume throughout this
problem that <span class="math inline">\(\alpha=0.2\)</span>, <span class="math inline">\(\beta=0.8\)</span>, <span class="math inline">\(x(0)=2\)</span>, and <span class="math inline">\(y(0)=0\)</span>.
Write a description for how your code works in your homework
document.</p></li>
</ol>
</div>
<hr />

<div class="exercise">
<p><span id="exr:celestial" class="exercise"><strong>Exercise 5.75  </strong></span>In this problem we’ll look at the orbit of a celestial body around the
sun. The body could be a satellite, comet, planet, or any other object
whose mass is negligible compared to the mass of the sun. We assume that
the motion takes place in a two dimensional plane so we can describe the
path of the orbit with two coordinates, <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> with the point
<span class="math inline">\((0,0)\)</span> being used as the reference point for the sun. According to
Newton’s law of universal gravitation the system of differential
equations that describes the motion is
<span class="math display">\[x&#39;&#39;(t) = \frac{-x}{\left( \sqrt{x^2 + y^2} \right)^3} \quad \text{and} \quad y&#39;&#39;(t)
    = \frac{-y}{\left( \sqrt{x^2 + y^2} \right)^3}.\]</span></p>
<ol style="list-style-type: lower-alpha">
<li><p>Define the two velocity functions <span class="math inline">\(v_x(t) = x&#39;(t)\)</span> and <span class="math inline">\(v_y(t) =  y&#39;(t)\)</span>. Using these functions we can now write the
system of two second-order differential equations as a system of
four first-order equations <span class="math display">\[\begin{aligned}
                x&#39; &amp;= \underline{\hspace{2in}} \\
                v_x &#39; &amp;= \underline{\hspace{2in}} \\
                y&#39; &amp;= \underline{\hspace{2in}} \\
                v_y&#39; &amp;= \underline{\hspace{2in}} 
            \end{aligned}\]</span></p></li>
<li><p>Solve the system of equations from part (a) using an appropriate
solver. Start with <span class="math inline">\(x(0) = 4\)</span>, <span class="math inline">\(y(0) = 0\)</span>, the initial <span class="math inline">\(x\)</span> velocity
as <span class="math inline">\(0\)</span>, and the initial <span class="math inline">\(y\)</span> velocity as <span class="math inline">\(0.5\)</span>. Create several plots
showing how the dynamics of the system change for various values of
the initial <span class="math inline">\(y\)</span> velocity in the interval <span class="math inline">\(t \in (0,100)\)</span>.</p></li>
<li><p>Give an animated plot showing <span class="math inline">\(x(t)\)</span> versus <span class="math inline">\(y(t)\)</span>.</p></li>
</ol>
</div>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-525" class="exercise"><strong>Exercise 5.76  </strong></span>In this problem we consider the pursuit and evasion problem where <span class="math inline">\(E(t)\)</span>
is the vector for an evader (e.g. a rabbit or a bank robber) and <span class="math inline">\(P(t)\)</span>
is the vector for a pursuer (e.g. a fox chasing the rabbit or the police
chasing the bank robber) <span class="math display">\[\begin{aligned}
        E(t) = \begin{pmatrix} x_e(t) \\ y_e(t) \end{pmatrix} \quad \text{and} \quad P(t)
        = \begin{pmatrix} x_p(t) \\ y_p(t) \end{pmatrix}.
    \end{aligned}\]</span> Let’s presume the following:</p>
<dl>
<dt>Assumption 1:</dt>
<dd><p>the evader has a predetermined path (known only to him/her),</p>
</dd>
<dt>Assumption 2:</dt>
<dd><p>the pursuer heads directly toward the evader at all times, and</p>
</dd>
<dt>Assumption 3:</dt>
<dd><p>the pursuer’s speed is directly proportional to the evader’s speed.</p>
</dd>
</dl>
<p>From the third assumption we have <span class="math display">\[\begin{aligned}
        \| P&#39;(t) \| = k \| E&#39;(t) \| 
        \label{eqn:pursuit_evasion_assumption3}
    \end{aligned}\]</span> and from the second assumption we have
<span class="math display">\[\begin{aligned}
        \frac{P&#39;(t)}{\|P&#39;(t)\|} = \frac{E(t) - P(t)}{\| E(t) - P(t)\|}.
    \end{aligned}\]</span> Solving for <span class="math inline">\(P&#39;(t)\)</span>
the differential equation
that we need to solve becomes <span class="math display">\[\begin{aligned}
        P&#39;(t) = k \| E&#39;(t) \| \frac{E(t) - P(t)}{\| E(t) - P(t)\|}.
    \end{aligned}\]</span> Your Tasks:</p>
<ol style="list-style-type: lower-alpha">
<li><p>Explain assumption #2 mathematically.</p></li>
<li><p>Explain assumption #3 physically. Why is this assumption necessary
mathematically?</p></li>
<li><p>Write code to find the path of the pursuer if the evader has the
parameterized path
<span class="math display">\[E(t) = \begin{pmatrix} 0 \\ 5t \end{pmatrix} \quad \text{for} \quad t \ge 0\]</span>
and the pursuer initially starts at the point
<span class="math inline">\(P(0) = \begin{pmatrix}  2\\3\end{pmatrix}\)</span>. Write your code so that it stops
when the pursuer is within 0.1 units of the evader. Run your code
for several values of <span class="math inline">\(k\)</span>. The resulting plot should be animated.</p></li>
<li><p>Modify your code from part (c) to find the path of the pursuer if
the evader has the parameterized path
<span class="math display">\[E(t) = \begin{pmatrix} 5 + \cos(2\pi t) + 2\sin(4\pi t) \\ 4 + 3\cos(3 \pi
                t) \end{pmatrix}  \quad \text{for} \quad t \ge 0\]</span>
and the pursuer initially starts at the point
<span class="math inline">\(P(0) = \begin{pmatrix} 0 \\ 50  \end{pmatrix}\)</span>. Write your code so that it stops when
the pursuer is within 0.1 units of the evader. Run your code for
several values of <span class="math inline">\(k\)</span>. The resulting plot should be animated.</p></li>
<li><p>Create your own smooth path for the evader that is <em>challenging</em> for
the pursuer to catch. Write your code so that it stops when the
pursuer is within 0.1 units of the evader. Run your code for several
values of <span class="math inline">\(k\)</span>.</p></li>
<li><p>(Challenge) If you extend this problem to three spatial dimensions
you can have the pursuer and the evader moving on a multivariable
surface (i.e. hilly terrain). Implement a path along an appropriate
surface but be sure that the velocities of both parties are
appropriately related to the gradient of the surface.</p></li>
</ol>
<p>Note: It may be easiest to build this code from scratch instead of using
one of our pre-written codes.</p>
</div>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-526" class="exercise"><strong>Exercise 5.77  </strong></span>(This problem is modified from <span class="citation">[<a href="#ref-meerschaert" role="doc-biblioref">6</a>]</span>)</p>
<p>One of the favorite foods of the blue whale is krill. Blue whales are
baleen whales and feed almost exclusively on krill. These tiny
shrimp-like creatures are devoured in massive amounts to provide the
principal food source for the huge whales. In the absence of predators,
in uncrowded conditions, the krill population density grows at a rate of
25% per year. The presence of 500 tons/acre of krill increases the blue
whale population growth rate by 2% per year, and the presence of 150,000
blue whales decreases krill growth rate by 10% per year. The population
of blue whales decreases at a rate of 5% per year in the absence of
krill.</p>
<p>These assumptions yield a pair of differential equations (a
Lotka-Volterra model) that describe the population of the blue whales
(<span class="math inline">\(B\)</span>) and the krill population density (<span class="math inline">\(K\)</span>) over time given by
<span class="math display">\[\begin{aligned}
        \frac{dB}{dt} &amp;= -0.05B + \left( \frac{0.02}{500} \right) BK \\
        \frac{dK}{dt} &amp;= 0.25K - \left( \frac{0.10}{150000} \right) BK.
    \end{aligned}\]</span></p>
<ol style="list-style-type: lower-alpha">
<li><p>What are the units of <span class="math inline">\(\frac{dB}{dt}\)</span> and <span class="math inline">\(\frac{dK}{dt}\)</span>?</p></li>
<li><p>Explain what each of the four terms on the right-hand sides of the
differential equations mean in the context of the problem. Include a
reason for why each term is positive or negative.</p></li>
<li><p>Find a numerical solution to the differential equation model using
<span class="math inline">\(B(0) = 75,000\)</span> whales and <span class="math inline">\(K(0) = 150\)</span> tons per acre.</p></li>
<li><p>Whaling is a huge concern in the oceans world wide. Implement a
<em>harvesting</em> term into the whale differential equation, defend your
mathematical choices and provide a thorough exploration of any
parameters that are introduced.</p></li>
</ol>
</div>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-527" class="exercise"><strong>Exercise 5.78  </strong></span>(This problem is modified from <span class="citation">[<a href="#ref-drone" role="doc-biblioref">10</a>]</span>)</p>
You just received a new long-range helicopter drone for your birthday!
After a little practice, you try a long-range test of it by having it
carry a small package to your home. A friend volunteers to take it 5
miles east of your home with the goal of flying directly back to your
home. So you program and guide the drone to always head directly toward
home at a speed of 6 miles per hour. However, a wind is blowing from the
south at a steady 4 miles per hour. The drone, though, always attempts
to head directly home. We will assume the drone always flies at the same
height. What is the drone’s flight path? Does it get the package to your
home? What happens if the speeds are different? What if the initial
distance is different? How much time does the drone’s battery have to
last to get home? When you make plots of your solution they must be animated.
</div>
<hr />

<div class="exercise">
<span id="exr:unnamed-chunk-528" class="exercise"><strong>Exercise 5.79  </strong></span>A trebuchet catapult throws a cow vertically into the air. The
differential equation describing its acceleration is
<span class="math display">\[\frac{d^2x}{dt^2} = -g - c \frac{dx}{dt} \left| \frac{dx}{dt} \right|\]</span>
where <span class="math inline">\(g \approx 9.8\)</span> m/s<span class="math inline">\(^2\)</span> and <span class="math inline">\(c \approx 0.02\)</span> m<span class="math inline">\(^{-1}\)</span> for a
typical cow. If the cow is launched at an initial upward velocity of 30
m/s, how high will it go, and when will it crash back into the ground?
Hint: Change this second order differential equation into a system of
first order differential equations.
</div>
<hr />

<div class="exercise">
<p><span id="exr:unnamed-chunk-529" class="exercise"><strong>Exercise 5.80  (Scipy ODEINT)  </strong></span>It should come as no surprise that the <code>scipy</code> library has some built-in tools to solve differential equations numerically. One such tool is <code>scipy.integrate.odeint()</code>. The code below shows how to use the <code>.odeint()</code> tool to solve the differential equation <span class="math inline">\(x&#39; = -\frac{1}{3}x + \sin(t)\)</span> with <span class="math inline">\(x(0) =1\)</span>. Take note that the <code>.odeint()</code> function expects a Python function (or <code>lambda</code> function), an initial condition, and an array of times.</p>
<p>Make careful note of the following:</p>
<ul>
<li>The function <code>scipy.integrate.odeint()</code> expects the function <span class="math inline">\(f\)</span> to have the arguments in the order <span class="math inline">\(x\)</span> (or <span class="math inline">\(y\)</span>) then <span class="math inline">\(t\)</span>. In other words, they expect you to define <span class="math inline">\(f\)</span> as <span class="math inline">\(f = f(x,t)\)</span>. This is opposite from our convention in this chapter where we have defined <span class="math inline">\(f\)</span> as <span class="math inline">\(f = f(t,x)\)</span>.<br />
</li>
<li>The output of <code>scipy.integrate.odeint()</code> is an array. This is designed so that <code>.odeint()</code> can handle systems of ODEs as well as scalar ODEs. In the code below notice that we plot <code>x[:,0]</code> instead of just <code>x</code>. This is overkill in the case of a scalar ODE, but in a system of ODEs this will be important.</li>
<li>You have to specify the array of time for the <code>scipy.integrate.odeint()</code> function. It is typically easiest to use <code>np.linspace()</code> to build the array of times.</li>
</ul>
</div>
<div class="sourceCode" id="cb151"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb151-1"><a href="ch-odes.html#cb151-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb151-2"><a href="ch-odes.html#cb151-2"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb151-3"><a href="ch-odes.html#cb151-3"></a><span class="im">import</span> scipy.integrate</span>
<span id="cb151-4"><a href="ch-odes.html#cb151-4"></a>f <span class="op">=</span> <span class="kw">lambda</span> x, t: <span class="op">-</span>(<span class="dv">1</span><span class="op">/</span><span class="fl">3.0</span>)<span class="op">*</span>x <span class="op">+</span> np.sin(t)</span>
<span id="cb151-5"><a href="ch-odes.html#cb151-5"></a>x0 <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb151-6"><a href="ch-odes.html#cb151-6"></a>t <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">1000</span>)</span>
<span id="cb151-7"><a href="ch-odes.html#cb151-7"></a>x <span class="op">=</span> scipy.integrate.odeint(f,x0,t)</span>
<span id="cb151-8"><a href="ch-odes.html#cb151-8"></a>plt.plot(t,x[:,<span class="dv">0</span>],<span class="st">&#39;b--&#39;</span>)</span>
<span id="cb151-9"><a href="ch-odes.html#cb151-9"></a>plt.grid()</span>
<span id="cb151-10"><a href="ch-odes.html#cb151-10"></a>plt.show()</span></code></pre></div>
<p>Now let’s consider the system of ODEs
<span class="math display">\[\begin{aligned}
x&#39; &amp;= y \\
y&#39; &amp;= -by - c \sin(x).
\end{aligned}\]</span>
In this ODE <span class="math inline">\(x(t)\)</span> is the angle from equilibrium of a pendulum, and <span class="math inline">\(y(t)\)</span> is the angular velocity of the pendulum. To solve this ODE with <code>scipy.integrate.odeint()</code> using the parameters <span class="math inline">\(b=0.25\)</span> and <span class="math inline">\(c=5\)</span> and the initial conditions <span class="math inline">\(x(0) = \pi-0.1\)</span> and <span class="math inline">\(y(0) = 0\)</span> we can use the code below. (The idea to use this ODE was taken from the <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.integrate.odeint.html">documentation page for <code>scipy.integrate.odeint()</code></a>.)</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb152-1"><a href="ch-odes.html#cb152-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb152-2"><a href="ch-odes.html#cb152-2"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb152-3"><a href="ch-odes.html#cb152-3"></a><span class="im">import</span> scipy.integrate</span>
<span id="cb152-4"><a href="ch-odes.html#cb152-4"></a>F <span class="op">=</span> <span class="kw">lambda</span> x, t, b, c: [x[<span class="dv">1</span>] , <span class="op">-</span>b<span class="op">*</span>x[<span class="dv">1</span>] <span class="op">-</span> c<span class="op">*</span>np.sin(x[<span class="dv">0</span>])]</span>
<span id="cb152-5"><a href="ch-odes.html#cb152-5"></a>x0 <span class="op">=</span> [np.pi <span class="op">-</span> <span class="fl">0.1</span> , <span class="dv">0</span>]</span>
<span id="cb152-6"><a href="ch-odes.html#cb152-6"></a>t <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">1000</span>)</span>
<span id="cb152-7"><a href="ch-odes.html#cb152-7"></a>b <span class="op">=</span> <span class="fl">0.25</span></span>
<span id="cb152-8"><a href="ch-odes.html#cb152-8"></a>c <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb152-9"><a href="ch-odes.html#cb152-9"></a>x <span class="op">=</span> scipy.integrate.odeint(F, x0, t, args<span class="op">=</span>(b, c))</span>
<span id="cb152-10"><a href="ch-odes.html#cb152-10"></a>plt.plot(t,x[:,<span class="dv">0</span>],<span class="st">&#39;b&#39;</span>,t,x[:,<span class="dv">1</span>],<span class="st">&#39;r&#39;</span>)</span>
<span id="cb152-11"><a href="ch-odes.html#cb152-11"></a>plt.grid()</span>
<span id="cb152-12"><a href="ch-odes.html#cb152-12"></a>plt.show()</span></code></pre></div>
<p><strong>Your Tasks:</strong></p>
<ol style="list-style-type: lower-alpha">
<li>First implement the two blocks of Python code given above. Be sure to understand what each line of code is doing. Fully comment your code, and then try the code with several different initial conditions.<br />
</li>
<li>For the pendulum system be sure to describe what your initial conditions mean in the physical setup.</li>
<li>Use <code>scipy.integrate.odeint()</code> to solve a nontrivial scalar ODE of your choosing. Clearly show your ODE and give plots of your solutions with several different initial conditions.</li>
<li>Build a numerical experiment to determine the relationship between your choice of <span class="math inline">\(\Delta t\)</span> and the absolute maximum error between the solution from <code>.odeint()</code> and a known analytic solution to a scalar ODE. Support your work with appropriate plots and discussion.</li>
<li>Solve the system of differential equations from Exercise <a href="ch-odes.html#exr:celestial">5.75</a> using <code>scipy.integrate.odeint()</code>. Show appropriate plots of your solution.</li>
</ol>
<hr />
<div style="page-break-after: always;"></div>
</div>
</div>
<div id="projects-3" class="section level2" number="5.10">
<h2><span class="header-section-number">5.10</span> Projects</h2>
<p>In this section we propose several ideas for projects related to
numerical ordinary differential equations. These projects are meant to
be open ended, to encourage creative mathematics, to push your coding
skills, and to require you to write and communicate your mathematics.
Take the time to read Appendix <a href="ch-writing.html#ch:writing">B</a> before you write your final solution.</p>
<div id="the-covid-19-pandemic" class="section level3" number="5.10.1">
<h3><span class="header-section-number">5.10.1</span> The COVID-19 Pandemic</h3>
<p>In the paper <a href="https://www.nature.com/articles/s41591-020-0883-7"><em>Modeling the COVID-19 epidemic and implementation of population-wide interventions in Italy</em>, by G. Giordana et al.</a>, the authors propose a robust extension to the SIR model, which they call the “<em>SIDARTHE</em>” model, to model the spread of the COVID-19 virus in Italy. The acronym stands for</p>
<ul>
<li><span class="math inline">\(S=\)</span> proportion of the population which is Susceptible.</li>
<li><span class="math inline">\(I=\)</span> proportion of the population which is presently Infected. Asymptomatic, infected, and undetected.</li>
<li><span class="math inline">\(D=\)</span> proportion of the population which has been Diagnosed. Asymptomatic, infected, and detected.</li>
<li><span class="math inline">\(A=\)</span> proportion of the population which is Ailing. Symptomatic, infected, and undetected.</li>
<li><span class="math inline">\(R=\)</span> proportion of the population which is Recognized. Symptomatic, infected, and detected.</li>
<li><span class="math inline">\(T=\)</span> proportion of the population which is Threatened. Acutely symptomatic, infected, and detected.</li>
<li><span class="math inline">\(H=\)</span> proportion of the population which is Healed.<br />
</li>
<li><span class="math inline">\(E=\)</span> proportion of the population which is Extinct.</li>
</ul>
<p>In the Methods section of the paper (in the paragraph that begins with “<em>In particular, …</em>”) the authors propose initial conditions and values for all of the parameters in the model. Using these values create a numerical solution to the system of differential equations and verify that the basic reproduction number for the model is <span class="math inline">\(R_0 = 2.38\)</span> as the authors say. In the subsequent paragraphs the authors propose ways to modify the parameters to account for social distancing, stay at home orders, and other such measures. Reproduce the authors’ results from these paragraphs and fully explain all of your work. Provide sufficient plots to show the dynamics of the situation.</p>
</div>
<div id="pain-management" class="section level3" number="5.10.2">
<h3><span class="header-section-number">5.10.2</span> Pain Management</h3>
<p>When a patient undergoing surgery is asked about their pain the doctors
often ask patients to rate their pain on a subjective 0 to 10 scale with
0 meaning no pain and 10 meaning excruciating pain. After surgery the
unmitigated pain level in a typical patient will be quite high and as
such doctors typically treat with narcotics. A mathematical model
(inspired by <a href="https://sinews.siam.org/Details-Page/data-driven-chronic-pain-management-using-hybrid-mathematical-methods">THIS
article</a>
and <a href="https://arxiv.org/pdf/1706.02366.pdf">THIS paper</a>) of a patient’s
subjective pain level as treated pharmaceutically by three drugs is
given as: <span class="math display">\[\begin{aligned}
    \frac{dP}{dt} &amp;= - \left( k_0 + k_1 D_1 + k_2 D_2 +k_3 D_3\right)P + k_0 u \\
    \frac{dD_1}{dt} &amp;= -k_{D_1} D_1 + \sum_{j=1}^{N_1} \delta (t-\tau_{1,j}) \\ 
    \frac{dD_2}{dt} &amp;= -k_{D_2} D_2 + \sum_{j=1}^{N_2} \delta (t-\tau_{2,j}) \\ 
    \frac{dD_3}{dt} &amp;= -k_{D_3} D_3 + \sum_{j=1}^{N_3} \delta (t-\tau_{3,j})  \end{aligned}\]</span>
where</p>
<ul>
<li><p><span class="math inline">\(P\)</span> is a patient’s subjective pain level on a 0 to 10 scale,</p></li>
<li><p><span class="math inline">\(D_i\)</span> is the amount of the <span class="math inline">\(i^{th}\)</span> drug in the patient’s
bloodstream,</p>
<ul>
<li><p><span class="math inline">\(D_1\)</span> is a long-acting opioid</p></li>
<li><p><span class="math inline">\(D_2\)</span> is a short-acting opioid</p></li>
<li><p><span class="math inline">\(D_3\)</span> is a non-opioid</p></li>
</ul></li>
<li><p><span class="math inline">\(k_0\)</span> is the relaxation rate to baseline pain without drugs,</p></li>
<li><p><span class="math inline">\(k_i\)</span> is the impact of the <span class="math inline">\(i^{th}\)</span> drug on the relaxation rate,</p></li>
<li><p><span class="math inline">\(u\)</span> is the patient’s baseline (unmitigated) pain,</p></li>
<li><p><span class="math inline">\(k_{D_i}\)</span> is the elimination rate of the <span class="math inline">\(i^{th}\)</span> drug from the
bloodstream,</p></li>
<li><p><span class="math inline">\(N_i\)</span> is the total number of the <span class="math inline">\(i^{th}\)</span> drug doses taken, and</p></li>
<li><p><span class="math inline">\(\tau_{i,j}\)</span> are the time times the patient takes the <span class="math inline">\(i^{th}\)</span> drug.</p></li>
<li><p><span class="math inline">\(\delta()\)</span> is the Dirac delta function.</p></li>
</ul>
<p>Implement this model with parameters <span class="math inline">\(u=8.01\)</span>, <span class="math inline">\(k_0 = \ln(2)/2\)</span>,
<span class="math inline">\(k_1 = 0.319\)</span>, <span class="math inline">\(k_2 = 0.184\)</span>, <span class="math inline">\(k_3 = 0.201\)</span>, <span class="math inline">\(k_{D_1} = \ln(0.5)/(-10)\)</span>, <span class="math inline">\(k_{D_2} = \ln(0.5)/(-4)\)</span>, and
<span class="math inline">\(k_{D_3} = \ln(0.5)/(-4)\)</span>. Take the initial pain level to be <span class="math inline">\(P(0) = 3\)</span>
with no drugs on board. Assume that the patient begins dosing the
long-acting opioid at hour 2 and takes 1 dose periodically every 24
hours. Assume that the patient begins dosing the short-acting opioid at
hour 0 and takes 1 dose periodically every 12 hours. Finally assume that
the patient takes 1 dose of the non-opioid drug every 48 hours starts at
hour 24. Of particular interest are how the pain level evolves over the
first week out of surgery and how the drug concentrations evolve over
this time.</p>
<p>Other questions:</p>
<ul>
<li><p>What does this medication schedule do to the patient’s pain level?</p></li>
<li><p>What happens to the patient’s pain level if he/she forgets the
non-opioid drug?</p></li>
<li><p>What happens to the patient’s pain level if he/she has a bad
reaction to opioids and only takes the non-opioid drug?</p></li>
<li><p>What happens to the dynamics of the system if the patient’s pain
starts at 9/10?</p></li>
<li><p>In reality, the unmitigated pain <span class="math inline">\(u\)</span> will decrease in time. Propose
a differential equation model for the unmitigated pain that will
have a stable equilibrium at 3 and has a value of 5 on day 5. Add
this fifth differential equation to the pain model and examine what
happens to the patient’s pain over the first week. In this model,
what happens after the first week if the narcotics are ceased?</p></li>
</ul>
</div>
<div id="the-h1n1-virus" class="section level3" number="5.10.3">
<h3><span class="header-section-number">5.10.3</span> The H1N1 Virus</h3>
<p>The H1N1 virus, also known as the “bird flu”, is a particularly virulent
bug but thankfully is also very predicable. Once a person is infected
they are infectious for 9 days. Assume that a closed population of
<span class="math inline">\(N = 1500\)</span> people (like a small college campus) starts with exactly 1
infected person and hence the remainder of the population is considered
susceptible to the virus. Furthermore, once a person is recovered they
have an immunity that typically lasts longer than the outbreak.
Mathematically we can model an H1N1 outbreak of this kind using 11
compartments: susceptible people (<span class="math inline">\(S\)</span>), 9 groups of infected people
(<span class="math inline">\(I_j\)</span> for <span class="math inline">\(j=1, 2, \cdots, 9\)</span>), and recovered people (<span class="math inline">\(R\)</span>). Write and
numerically solve a system of 11 differential equations modeling the
H1N1 outbreak assuming that susceptible people become infected at a rate
proportional to the product of the number of susceptible people and the
total number of infected people. You may assume that the initial
infected person is on the first day of their infection and determine and
unknown parameters using the fact that 1 week after the infection starts
there are 10 total people infected.</p>
<div style="page-break-after: always;"></div>
</div>
<div id="the-artillery-problem" class="section level3" number="5.10.4">
<h3><span class="header-section-number">5.10.4</span> The Artillery Problem</h3>
<p>The goal of artillery is to fire a shell (e.g. a cannon ball) so that it
lands on a specific target. If we ignore the effects of air resistance
the differential equations describing its acceleration are very simple:
<span class="math display">\[\begin{aligned}
    \frac{dv_x}{dt} = 0 \quad \text{and} \quad \frac{dv_z}{dt} = -g \label{eqn:no-air-res}\end{aligned}\]</span>
where <span class="math inline">\(v_x\)</span> and <span class="math inline">\(v_z\)</span> are the velocities in the <span class="math inline">\(x\)</span> and <span class="math inline">\(z\)</span> directions
respectively and <span class="math inline">\(g\)</span> is the acceleration due to gravity (<span class="math inline">\(g = 9.8\)</span>
m/s<span class="math inline">\(^2\)</span>). We can use these equations to <em>easily</em> show that the resulting
trajectory is parabolic. Once we know this we can easily<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a> calculate
the initial speed <span class="math inline">\(v_0\)</span> and angle <span class="math inline">\(\theta_0\)</span> above the horizontal
necessary for the shell to reach the target. We will undoubtedly find
that the maximum range will always result from an angle of
<span class="math inline">\(\theta_0 = 45^\circ\)</span>.</p>
<p>The effects of air resistance are significant when the shell must travel
a large distance or when the speed is large. If we modify
the equations to include a simple model of air resistance
the governing equations become <span class="math display">\[\begin{aligned}
    \frac{dv_x}{dt} = -c v_x \sqrt{ v_x^2 + v_z^2} \quad \text{and} \quad
    \frac{dv_z}{dt} = -g - cv_z \sqrt{ v_x^2 + v_z^2}
    \label{eqn:with-air-res}\end{aligned}\]</span> where the constant <span class="math inline">\(c\)</span>
depends on the shape and density of the shell and the density of air.
For this project assume that <span class="math inline">\(c = 10^{-3} m^{-1}\)</span>. To calculate the
components of the position vector recall that since the derivative of
position, <span class="math inline">\(s(t)\)</span>, is velocity we have <span class="math display">\[\begin{aligned}
    s_x(t) = \int_0^t v_x(\tau) d\tau \quad \text{and} \quad s_z(t) = \int_0^t v_z(\tau)
    d\tau.\end{aligned}\]</span></p>
<p>Now, imagine that you are living 200 years ago, acting as a consultant
to an artillery officer who will be going into battle (perhaps against
Napoleon – he was known for hiring mathematicians to help his war
efforts). Although computers have not yet been invented, given a few
hours or a few days to work, a person living in this time could project
trajectories using numerical methods (yes, numerical solutions to
differential equations were well known back then too). Using this, you
can try various initial speeds <span class="math inline">\(v_0\)</span> and angles <span class="math inline">\(\theta_0\)</span> until you
find a pair that reach any target. However, the artillery officer needs
a faster and simpler method. He can do math, but performing hundreds or
thousands of numerical calculations on the battlefield is simply not
practical. Suppose that our artillery piece will be firing at a target
that is a distance <span class="math inline">\(\Delta x\)</span> away, and that <span class="math inline">\(\Delta x\)</span> is approximately
half a mile away – not exactly half a mile, but in that general
neighborhood.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Develop a method for estimating <span class="math inline">\(v_0\)</span> and <span class="math inline">\(\theta_0\)</span> with reasonable
accuracy given the exact range to the target, <span class="math inline">\(\Delta x\)</span>. Your method needs to be simple enough
to use in real time on a historic (Napoleon-era) battle field
without the aid of a computer. (Be sure to persuade me that your
numerical solution is accurate enough.)</p></li>
<li><p>Discuss the sensitivity in your solutions to variations in the
constant <span class="math inline">\(c\)</span>.</p></li>
<li><p>Extend this problem to make it more realistic. A few possible
extensions are listed below but please do not restrict yourselves
just to this list and do not think that you need to do everything on
the list.</p>
<ul>
<li><p>You could consider the effects of targets at different altitudes
<span class="math inline">\(\Delta z\)</span>.</p></li>
<li><p>You could consider moving targets.</p></li>
<li><p>You could consider headwinds and/or tailwinds.</p></li>
<li><p>You could consider winds coming from an angle outside the
<span class="math inline">\(xz\)</span>-plane.</p></li>
<li><p>You could consider shooting the cannon from a boat with the
target on shore (the waves could be interesting!).</p></li>
<li><p>…You could consider any other physical situation which I
haven’t listed here, but you have to do some amount of extension
from the <em>basics</em>.</p></li>
</ul></li>
</ol>
<p>The final product of this project will be:</p>
<ul>
<li><p>a <strong>technical paper</strong> describing your method to a mathematically
sophisticated audience, and</p></li>
<li><p>a <strong>field manual</strong> instructing the artillery officer how to use your
method.</p></li>
</ul>
<p>You can put both products in one paper. Just use a section header to
start the field manual.</p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-meerschaert">
<p>[6] M. Meerschaert, <em>Mathematical modeling, 4ed</em>. Academic Press, 2013.</p>
</div>
<div id="ref-tea">
<p>[7] E. Sullivan, J. Bauer, and E. Wiens, “1-094-s-steepingtea.” Sep. 2017, [Online]. Available: <a href="https://www.simiode.org/resources/4190">https://www.simiode.org/resources/4190</a>.</p>
</div>
<div id="ref-plague">
<p>[8] B. Winkel, “6-004-s-villageepidemic.” Jul. 2016, [Online]. Available: <a href="https://simiode.org/resources/2372">https://simiode.org/resources/2372</a>.</p>
</div>
<div id="ref-bedridden">
<p>[9] S. Miller, “6-001-s-epidemic.” Jun. 2015, [Online]. Available: <a href="https://simiode.org/resources/572">https://simiode.org/resources/572</a>.</p>
</div>
<div id="ref-drone">
<p>[10] R. Spindler, “6-023-s-droneheadinghome.” Apr. 2017, [Online]. Available: <a href="https://www.simiode.org/resources/3476">https://www.simiode.org/resources/3476</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="11">
<li id="fn11"><p>If you don’t know the solution to Newton’s Law of Cooling then take a moment and do the separation of variables to solve for <span class="math inline">\(T(t)\)</span>.<a href="ch-odes.html#fnref11" class="footnote-back">↩︎</a></p></li>
<li id="fn12"><p>I’m showing you the algebra here, but it really isn’t necessary to
show this level of routine algebra in your papers. Only show the
algebra and other calculations that are necessary for the reader to
understand the work that you’re doing.<a href="ch-odes.html#fnref12" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ch-linearalgebra.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ch-pdes.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
